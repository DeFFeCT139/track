function initYMaps(){var e=[55.87880356884556,37.729987499999986],r="129347, г.Москва,<br />Ярославское ш., д. 146, корп. 2, помещение 305 / 1";switch(Global.TRANSPORT_REGION_SUBDOMAIN){case transportRegion.LO:e=[59.914281,30.396285],r="192019 г. Санкт-Петербург, Профессора Качалова, 7";break;case transportRegion.NO:e=[56.299895,44.012661],r="603098, г. Нижний Новгород, ул.Артельная, д.29, офис 207";break;case transportRegion.SO:e=[56.855743,60.65582],r="620137, г. Екатеринбург, улица Кулибина 1а"}var o=new ymaps.Map("map",{center:e,zoom:17,controls:[]});o.events.add("click",(function(e){o.balloon.close()}));var i=new ymaps.Placemark(e,{balloonContent:r},{balloonCloseButton:!1,iconLayout:"default#image",iconImageHref:"/Content/img/map-logo.webp",iconImageSize:[27,33],iconImageOffset:[-9,-33]});o.geoObjects.add(i)}function checkYMapsLoaded(){try{return!!ymaps}catch(e){}return!1}addYandexMaps();var ymapsInterval=setInterval((function(){checkYMapsLoaded()&&(setTimeout((function(){ymaps&&ymaps.ready(initYMaps)}),100),clearInterval(ymapsInterval))}),100);function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);r&&(i=i.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),o.push.apply(o,i)}return o}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(o),!0).forEach((function(r){_defineProperty(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}function _defineProperty(e,r,o){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function _toPropertyKey(e){var r=_toPrimitive(e,"string");return"symbol"===_typeof(r)?r:String(r)}function _toPrimitive(e,r){if("object"!==_typeof(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,r||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,r):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var o=0,i=new Array(r);o<r;o++)i[o]=e[o];return i}function ownKeys(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);r&&(i=i.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),o.push.apply(o,i)}return o}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(o),!0).forEach((function(r){_defineProperty(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}function _defineProperty(e,r,o){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function _toPropertyKey(e){var r=_toPrimitive(e,"string");return"symbol"===_typeof(r)?r:String(r)}function _toPrimitive(e,r){if("object"!==_typeof(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,r||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}myApp.controller("recallCtrl",["$scope","$filter","$timeout","$compile",function(e,r,o,i){e.loading=!0,e.phone="",e.sent=!1,e.isPhoneValid=!1,e.isPhoneFocused=!1,e.success=!1,e.emptyPhoneError="Мобильный телефон обязателен",e.wrongFormatPhoneError="Введен некорректный номер мобильного телефона",e.duplicationRequestError="Вы уже запрашивали обратный звонок с этого номера. Повторный запрос можно сделать через {0} {1}.",e.INTERVAL_IN_MINUTES=15,e.INTERVAL=60*e.INTERVAL_IN_MINUTES*1e3,e.cases=["минуту","минуты","минут"],e.oldPhones={},e.checkInterval=0,e.globalCheck=function(){if(validatePhone(e.phone)){var r=(new Date).getTime(),i=clearPhone(e.phone),n=e.oldPhones[i],s=parseInt(n);n&&Number.isInteger(s)&&o((function(){if(s+e.INTERVAL>r){var o=Math.ceil((s+e.INTERVAL-r)/ONE_MINUTE);e.phoneErrorMessage=e.duplicationRequestError.format(o,formatLabel(e.cases,o)),e.isPhoneFocused=!0,e.isPhoneValid=!1}else e.phoneErrorMessage="",e.isPhoneFocused=!1,e.isPhoneValid=!0,clearInterval(e.checkInterval)}),0)}},e.checkOldPhone=function(r){r=clearPhone(r);var o=!0,i=(new Date).getTime(),n=e.oldPhones[r],s=parseInt(n);if(n&&Number.isInteger(s))if(s+e.INTERVAL>i){var t=Math.ceil((s+e.INTERVAL-i)/ONE_MINUTE);e.phoneErrorMessage=e.duplicationRequestError.format(t,formatLabel(e.cases,t)),e.isPhoneFocused=!0,e.isPhoneValid=!1,o=!1,e.checkInterval=setInterval(e.globalCheck,1e3)}else e.oldPhones[r]=i;else e.oldPhones[r]=i;return localStorage.oldPhones=JSON.stringify(e.oldPhones),o},o((function(){if(e.recallPopup=modalWindow("#recall-popup","auth-popup customer-auth-popup register-driver-popup custom-close-btn"),localStorage.oldPhones)try{e.oldPhones=JSON.parse(localStorage.oldPhones)}catch(r){e.oldPhones={}}}),10),e.hideRecallPopup=function(){e.recallPopup.hide()},e.onPhoneChange=function(){o((function(){e.isPhoneValid=validatePhone(e.phone),clearInterval(e.checkInterval),e.isPhoneValid&&e.addYandexMetric(e.physicPage?"f_question_push_privet":"f_question_push")}),0)},e.onPhoneBlur=function(){o((function(){e.isPhoneValid=validatePhone(e.phone),e.isPhoneFocused=!1,e.phoneErrorMessage="",e.isPhoneValid?clearInterval(e.checkInterval):(e.isPhoneFocused=!0,""!=e.phone?e.phoneErrorMessage=e.wrongFormatPhoneError:e.phoneErrorMessage=e.emptyPhoneError)}),1)},e.afterSendFeedback=function(r){e.success=r,e.sent=!0,e.recallPopup.show()},e.sendFeedback=function(){o((function(){if(validatePhone(e.phone)&&e.checkOldPhone(e.phone)){e.addYandexMetric(e.physicPage?"f_question_send_privet":"f_question_send");var r=clearPhone(e.phone);client.invokeApi("FeedBack/Recall",{method:"POST",contentType:"application/json",data:JSON.stringify({phone:r,name:"",isBusiness:e.isBusiness,url:window.location.href,utms:getUTMS()})}).done((function(r){try{console.log("ga event recall"),dataLayer&&dataLayer.push({event:"gaevent",eventCategory:"callback",eventAction:"callback_success"})}catch(e){}var i="Неизвестно";e.currentUser&&(e.currentUser.type!=userTypes.Carrier&&e.currentUser.type!=userTypes.SuperCarrier||(i="Перевозчик"),e.currentUser.type!=userTypes.Customer&&e.currentUser.type!=userTypes.SuperCustomer||(i="Заказчик",e.currentCustomer&&(e.currentCustomer.type==customerType.Company?i+=" Бизнес":i+=" Физик"))),$.post("/FeedBack/Recall",{url:window.location.href,message:e.err_message,userType:i,phone:e.phone},(function(e){})),o((function(){e.afterSendFeedback(!0)}),1)})).fail((function(){o((function(){e.afterSendFeedback(!1)}),1)}))}}),10)}}]),myApp.controller("footerCtrl",["$scope","$filter","$q","$timeout",function(e,r,o,i){var n=$.Deferred(),s=$.Deferred();function t(){i((function(){e.leftGroup=a(e.leftItems.slice(),0),e.rightGroup=a(e.rightItems.slice(),1)}),0)}function a(r,o){var i,n=[],s=!1,t=4;if(window.innerWidth<=e.maxMobile&&(s=!0,e.rightItems.length||(t=2)),s){var a=e.leftItems.concat(e.rightItems);return o?[a.slice(Math.ceil(a.length/2))]:[a.slice(0,Math.ceil(a.length/2))]}return window.innerWidth<=e.maxTablet&&o?[r]:(r.length>t?(i=r.length%2==0?r.length/2:Math.ceil(r.length/2),n.push(r.slice(0,i),r.slice(i))):n.push(r),n)}e.leftGroup=[],e.rightGroup=[],e.leftItems=[],e.rightItems=[],e.url=window.location.pathname.toLowerCase(),e.forCarriers=e.url==loginUrls[loginTypes.Carrier]||e.url==loginUrls[loginTypes.CarrierCompany],e.onResize=function(){e.leftGroup=a(e.leftItems.slice(),0),e.rightGroup=a(e.rightItems.slice(),1),t()},$(window).resize(e.onResize),$.ajax({type:"GET",url:"/GetBottomMenuItemsLeft",contentType:!1,processData:!1,success:function(e){n.resolve(e)},error:function(e){console.log(e),n.reject(e)}}),$.ajax({type:"GET",url:"/GetBottomMenuItemsRight",contentType:!1,processData:!1,success:function(e){s.resolve(e)},error:function(e){console.log(e),s.reject(e)}}),$.when(n,s).done((function(r,o){e.leftItems=JSON.parse(r),e.handleTarrifsUrl(),e.rightItems=JSON.parse(o),e.leftItems=e.leftItems.map((function(e){return _objectSpread(_objectSpread({},e),{},{t:e.text})})),e.rightItems=e.rightItems.map((function(e){return _objectSpread(_objectSpread({},e),{},{t:e.text})})),t()})),e.handleTarrifsUrl=function(){for(var r=0;r<e.leftItems.length;r++)"tarify"==e.leftItems[r].url&&(e.leftItems[r].url=e.composeTariffsUrl().slice(1))},e.$on("customerLoaded",(function(){i((function(){if(e.isNDSCounted&&e.currentCustomer&&(e.currentCustomer.contractType==customerContractType.CompanyTEO||e.currentCustomer.contractType==customerContractType.DirectContractTEO))for(var r=0;r<e.leftItems.length;r++)"insurance"==e.leftItems[r].url&&(e.leftItems[r].url="insurance_teo")}),10)}))}]);var menuUrls,menuUrlsSecondLevel,header__onLoad,menuTypes={Physical:1,Business:2,Carrier:3,Admin:4,CarrierCompany:5,Business2:6,Carrier2:7,CarrierCompany2:8,Business3:9,Business4:10},currentUrl=window.location.pathname.toLowerCase();!function(){var e;e={gruzoperevozki:[{name:"Газелью",url:otherPageUrls[otherPageTypes.Gazelles]},{name:"Фурами",url:otherPageUrls[otherPageTypes.Trucks]},{name:"Рефрижераторные",url:otherPageUrls[otherPageTypes.Refrigirators]},{name:"С гидробортом",url:"/tarify-dlya-biznesa/gruzoperevozki-gidrobort"},{name:"Манипулятором",url:null},{name:"В торговые сети",url:otherPageUrls[otherPageTypes.TradeDelivery]}],"/tarify-dlya-biznesa":[{hidden:"true",url:"/tarify-dlya-biznesa"},{name:"1 т",url:"/tarify-dlya-biznesa/gruzoperevozki-1-tonna"},{name:"1,5 т",url:"/tarify-dlya-biznesa/gruzoperevozki-1.5-tonny"},{name:"3 т",url:"/tarify-dlya-biznesa/gruzoperevozki-3-tonny"},{name:"5 т",url:"/tarify-dlya-biznesa/gruzoperevozki-5-tonn"},{name:"10 т",url:"/tarify-dlya-biznesa/gruzoperevozki-10-tonn"},{name:"20 т",url:"/tarify-dlya-biznesa/gruzoperevozki-20-tonn"},{name:"с НДС",url:"/tarify-dlya-biznesa/gruzoperevozki-s-nds"}]},_defineProperty(e,otherPageUrls[otherPageTypes.Marketplaces],[{hidden:"true",url:otherPageUrls[otherPageTypes.Marketplaces]},{name:"Ozon",url:otherPageUrls[otherPageTypes.Ozon]},{name:"Wildberries",url:otherPageUrls[otherPageTypes.Wildberries]},{name:"СберМегаМаркет",url:otherPageUrls[otherPageTypes.Sber]},{name:"Яндекс Маркет",url:otherPageUrls[otherPageTypes.Yandeks]},{name:"Lamoda",url:otherPageUrls[otherPageTypes.Lamoda]},{name:"AliExpress",url:otherPageUrls[otherPageTypes.AliExpress]},{name:"Детский мир",url:otherPageUrls[otherPageTypes.DetskijMir]}]),_defineProperty(e,"moving",[{name:"Банка",url:otherPageUrls[otherPageTypes.Bank]},{name:"Склада",url:otherPageUrls[otherPageTypes.Warehouse]},{name:"Магазина",url:otherPageUrls[otherPageTypes.Store]},{name:"Переезд компании",url:otherPageUrls[otherPageTypes.Company]},{name:"Офисный переезд",url:otherPageUrls[otherPageTypes.Office]}]),_defineProperty(e,"shipping",[{name:"Станков",url:otherPageUrls[otherPageTypes.Machine]},{name:"Серверов",url:otherPageUrls[otherPageTypes.Server]},{name:"Банкоматов",url:otherPageUrls[otherPageTypes.ATM]},{name:"Оргтехники и офисной техники",url:otherPageUrls[otherPageTypes.OfficeEquipment]},{name:"Торгового оборудования",url:otherPageUrls[otherPageTypes.CommercialEquipment]},{name:"Полиграфического оборудования",url:otherPageUrls[otherPageTypes.PrintingEquipment]},{name:"Транспортировка архивных документов",url:otherPageUrls[otherPageTypes.Archive]}]),_defineProperty(e,"uslugi",[{name:"Экспедирование грузов",url:"/ekspedirovanie"},{name:"Услуги грузчиков",url:"/gruzchiki"}]),_defineProperty(e,loginUrls[loginTypes.Physical],[{hidden:"true",url:loginUrls[loginTypes.Physical]},{name:"Квартирый переезд",url:otherPageUrls[otherPageTypes.Apartment]},{name:"Дачный переезд",url:otherPageUrls[otherPageTypes.Cottage]},{name:"Перевозка вещей",url:otherPageUrls[otherPageTypes.Thing]},{name:"Кровати",url:otherPageUrls[otherPageTypes.Bed]},{name:"Дивана",url:otherPageUrls[otherPageTypes.Sofa]},{name:"Шкафа",url:otherPageUrls[otherPageTypes.Cabinet]},{name:"Мебели",url:otherPageUrls[otherPageTypes.Furniture]},{name:"Перевозка бытовой техники",url:otherPageUrls[otherPageTypes.Household]},{name:"Стиральной машины",url:otherPageUrls[otherPageTypes.WashingMachine]},{name:"Холодильника",url:otherPageUrls[otherPageTypes.RefrigeratorsPhysic]}]),_defineProperty(e,"/tarify-gruzovoe-taxi",[{hidden:"true",url:"/tarify-gruzovoe-taxi"},{name:"1 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-1-tonna"},{name:"1,5 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-1.5-tonny"},{name:"3 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-3-tonny"},{name:"5 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-5-tonn"}]),menuUrlsSecondLevel=e;var r=[];Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.MO?r=[{name:"По Москве и Московской области",url:"/moscow"}]:Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.LO?r=[{name:"По Санкт-Петербургу и Ленинградской области",url:"/spb"}]:Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.NO?r=[{name:"По Нижнему Новгороду и области",url:"/nn"}]:Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.SO&&(r=[{name:"По Екатеринбургу и области",url:"/ekb"}]),menuUrlsSecondLevel.gruzoperevozki=r.concat(menuUrlsSecondLevel.gruzoperevozki),(menuUrls=_objectSpread({},menuUrlsSecondLevel))[loginTypes.Company]=[loginUrls[loginTypes.Company]].concat(_toConsumableArray(menuUrls.gruzoperevozki.filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls["/tarify-dlya-biznesa"].filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls[otherPageUrls[otherPageTypes.Marketplaces]].filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls.moving.filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls.shipping.filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls.uslugi.filter((function(e){return null!=e.url})).map((function(e){return e.url})))),menuUrls[loginTypes.Physical]=[loginUrls[loginTypes.Physical]].concat(_toConsumableArray(menuUrls["/tarify-gruzovoe-taxi"].filter((function(e){return null!=e.url})).map((function(e){return e.url})))),menuUrls.carrierAndCompany=[loginUrls[loginTypes.Carrier],loginUrls[loginTypes.CarrierCompany]]}(),myApp.controller("menuCtrl",["$scope","$filter","$q","$timeout",function(e,r,o,i){e.url=window.location.pathname.toLowerCase(),e.isUserDropdownOpen=!1,e.isBurgerOpen=!1,e.menuUrls=menuUrls,e.forCarriers=e.url==loginUrls[menuTypes.Carrier]||e.url==loginUrls[menuTypes.CarrierCompany],e.notifyUrls=["/"].concat(_toConsumableArray(citiesAddresses),[otherPageUrls[otherPageTypes.TarrifsBusiness],otherPageUrls[otherPageTypes.Insurance],otherPageUrls[otherPageTypes.About],otherPageUrls[otherPageTypes.Contacts]]),e.notifyVisible=!1,e.closeHeaderNotify=function(){e.notifyVisible=!1},e.notifyDetails=function(){window.location.href=otherPageUrls[otherPageTypes.Refrigirators]},e.logoutWithTimeout=function(){i((function(){e.logout()}),0)},e.toggleUserDropdown=function(r,o){e.isUserDropdownOpen=r?!e.isUserDropdownOpen:o},e.getLkUrl=function(e){var r="";return e==loginTypes.Company||e==loginTypes.Physical?r="/CustomerOffice":e!=loginTypes.Carrier&&e!=loginTypes.CarrierCompany||(r="/CarrierOffice"),r},(header__onLoad=function(){"/user/forgotpassword"!=currentUrl&&"/user/verify"!=currentUrl||("true"==Global.Third.toLowerCase()?currentUrl=2==Global.Fourth?loginUrls[menuTypes.Carrier]:loginUrls[menuTypes.CarrierCompany]:"/user/verify"==currentUrl?2==Global.Fourth?(currentUrl=loginUrls[menuTypes.Physical],e.isBusiness=e.$parent.isBusiness=!1):(currentUrl=loginUrls[menuTypes.Business],e.isBusiness=e.$parent.isBusiness=!0):currentUrl=loginUrls[menuTypes.Business]),currentUrl==loginUrls[menuTypes.Business]||currentUrl==loginUrls[menuTypes.Business2]||currentUrl==loginUrls[menuTypes.Business3]||currentUrl==loginUrls[menuTypes.Business4]?(pageType=e.pageType=e.$parent.pageType=loginTypes.Company,e.isBusiness=e.$parent.isBusiness=!0):currentUrl==loginUrls[menuTypes.Carrier]||currentUrl==loginUrls[menuTypes.Carrier2]?(pageType=e.pageType=e.$parent.pageType=loginTypes.Carrier,currentUrl==loginUrls[menuTypes.Carrier2]&&(e.carrier2=e.$parent.carrier2=!0)):currentUrl==loginUrls[menuTypes.CarrierCompany]||currentUrl==loginUrls[menuTypes.CarrierCompany2]?(pageType=e.pageType=e.$parent.pageType=loginTypes.CarrierCompany,currentUrl==loginUrls[menuTypes.CarrierCompany2]&&(e.carrier2=e.$parent.carrier2=!0)):currentUrl==loginUrls[menuTypes.Admin]?pageType=e.pageType=e.$parent.pageType=loginTypes.Admin:currentUrl==loginUrls[menuTypes.Physical]&&(pageType=e.pageType=e.$parent.pageType=loginTypes.Physical)})(),e.isActive=function(e){return e===currentUrl},e.toggleSecondLevel=function(r){e[r]||(e.showMobileCompany=!1,e.showMobileCarrier=!1,e.showMobilePhysical=!1),e[r]=!e[r]},e.setActiveSubMenu=function(r){e.activeSubMenu=r},e.citiesMenuVisible=!1,e.showCities=function(){e.citiesMenuVisible=!0},e.toggleBurger=function(r){if(e.citiesMenuVisible=!1,e.isBurgerOpen=!e.isBurgerOpen,e.isBurgerOpen)for(var o in e.showMobileCompany=!1,e.showMobileCarrier=!1,e.showMobilePhysical=!1,e.showLoginOptions=!1,e.activeSubMenu=null,menuUrls[loginTypes.Company].indexOf(currentUrl)>-1&&(e.showMobileCompany=!0),menuUrls[loginTypes.Physical].indexOf(currentUrl)>-1&&(e.showMobilePhysical=!0),menuUrls.carrierAndCompany.indexOf(currentUrl)>-1&&(e.showMobileCarrier=!0),Object.keys(menuUrls).indexOf(currentUrl)>-1&&(e.activeSubMenu=currentUrl),menuUrlsSecondLevel){menuUrlsSecondLevel[o].filter((function(e){return null!=e.url})).map((function(e){return e.url})).indexOf(currentUrl)>-1&&(e.activeSubMenu=o)}else e.activeSubMenu=null},e.isActiveMenuItem=function(e,r){var o;return!!((o=r?menuUrls[e]:menuUrls[e].filter((function(e){return null!=e.url})).map((function(e){return e.url})))&&o.indexOf(currentUrl)>-1)}}]),function(){var e,r;myApp.controller("authorizationCtrl",["$scope","$filter","$timeout","$compile",function(o,i,n,s){o.debug=!1,o.isNullOrWhiteSpace=isNullOrWhiteSpace,o.smsTimeout=Global.SMSTimeout,o.emptyPhoneError="Введите номер мобильного телефона",o.wrongFormatPhoneError="Введен некорректный номер мобильного телефона",o.emptyEmailError=ErrorString.EmptyEmailError,o.wrongFormatEmailError=ErrorString.WrongFormatEmailError,o.emptyPasswordErrorLogin="Введите пароль",o.wrongFormatPasswordErrorLogin="Неверный формат пароля",o.registerBusinessError="",o.loginBusinessError="",o.recaptchaBusinessValid=!0,o.isPrivate=window.location.pathname.toLowerCase()!=o.loginUrls[o.loginTypes.Company],o.isRegistration=!0,o.phoneLoginPrivate="",o.isPhoneLoginPrivateValid=!1,o.isPhoneLoginPrivateFocused=!1,o.passwordLoginPrivate="",o.errorMessageLoginPrivate="",o.emailLoginBusiness="",o.isEmailLoginBusinessValid=!1,o.isEmailLoginBusinessFocused=!1,o.passwordLoginBusiness="",o.errorMessageLoginBusiness="",o.phoneRegistationPrivate="",o.isPhoneRegistationPrivateValid=!1,o.isPhoneRegistationPrivateFocused=!1,o.codeRegistationPrivate="",o.errorMessageRegistrationPrivate="",o.isSMSsentPrivate=!1,o.timeoutPrivate=0,o.emailRegistrationBusiness="",o.isEmailRegistrationBusinessValid=!1,o.isEmailRegistrationBusinessFocused=!1,o.phoneRegistrationBusiness="",o.isPhoneRegistrationBusinessValid=!1,o.isPhoneRegistrationBusinessFocused=!1,o.isSMSsentBusiness=!1,o.timeoutBusiness=0,o.fromShortForm=!1,o.debug&&(o.isPhoneRegistrationBusinessValid=!0,o.codeRegistrationBusinessInputEnabled=!0,o.isSMSsentBusiness=!0,o.codeRegistrationBusinessSent=!0,o.timeoutBusiness=29,o.phoneLoginPrivate="9779067856",o.codePrivateSent=!0,o.timeoutPrivate=29,o.isSMSsentPrivate=!0,o.codePrivateInputEnabled=!0),o.codeRegistrationBusiness="",o.errorMessageRegistrationBusiness="",o.createOrder=!1,o.url=window.location.pathname.toLowerCase(),o.pageType=loginUrls[o.url]||loginTypes.Physical,o.pageUrl="/",o.clearData=function(){o.codeRegistrationBusinessSent=!1,o.codeRegistrationBusinessInputEnabled=!1,o.phoneLoginPrivate="",o.isPhoneLoginPrivateValid=!1,o.passwordLoginPrivate="",o.emailLoginBusiness="",o.emailLoginErrorMessage="",o.isEmailLoginBusinessFocused=!1,o.isEmailLoginBusinessValid=!1,o.isPasswordLoginBusinessFocused=!1,o.isPasswordLoginBusinessValid=!1,o.passwordLoginBusiness="",o.passwordLoginBusinessErrorMessage="",o.loginBusinessError="",o.registerBusinessError="",o.codeRegistrationBusinessInputEnabled=!1,o.codePrivate="",o.codeRegistationPrivate="",o.isCodePrivateFocused=!1,o.isPhoneLoginPrivateFocused=!1,o.isPhoneRegistationPrivateValid=!1,o.phoneRegistationPrivate="",o.incorrectCodePrivate=!1,o.codeRegistrationBusiness="",o.codeRegistrationBusinessErrorMessage="",o.emailRegistrationBusiness="",o.emailRegistrationBusinessErrorMessage="",o.isCodeRegistrationBusinessValid=!1,o.isCodeRegistrationBusinessFocused=!1,o.isEmailRegistrationBusinessFocused=!1,o.isEmailRegistrationBusinessValid=!1,o.isPhoneRegistrationBusinessFocused=!1,o.isPhoneRegistrationBusinessValid=!1,o.phoneRegistrationBusiness="",o.phoneRegistrationBusinessErrorMessage="",o.clearErrors(),o.clearFocuses(),o.showSendMessage=!1,o.codePrivateSent=!1,o.phoneLoginPrivateErrorMessage="",o.timeoutPrivate=0,o.incorrectCodeBusiness=!1,o.recaptchaBusinessRendered=!1,o.recaptchaBusinessValid=!0,o.debug&&(o.isPhoneRegistrationBusinessValid=!0,o.codeRegistrationBusinessInputEnabled=!0,o.isSMSsentBusiness=!0,o.codeRegistrationBusinessSent=!0,o.timeoutBusiness=29,o.phoneLoginPrivate="9779067856",o.codePrivateSent=!0,o.timeoutPrivate=29,o.isSMSsentPrivate=!0,o.codePrivateInputEnabled=!0)},o.clearFocuses=function(){o.isPhoneLoginPrivateFocused=!1,o.isPhoneRegistrationBusinessFocused=!1,o.isPhoneRegistationPrivateFocused=!1,o.isEmailLoginBusinessFocused=!1,o.isEmailRegistrationBusinessFocused=!1},o.clearErrors=function(){o.errorMessageLoginPrivate="",o.errorMessageLoginBusiness="",o.errorMessageRegistrationPrivate="",o.errorMessageRegistrationBusiness=""},o.setRegistration=function(e){o.isRegistration=e,n((function(){o.isRegistration?(o.isPrivate?(o.phoneLoginPrivateInput.focus(),o.phoneLoginPrivate=o.phoneRegistationPrivate):(o.emailLoginBusinessInput.focus(),o.emailLoginBusiness=o.emailRegistrationBusiness),window.location.pathname.toLowerCase().indexOf("registration")<0&&!o.isPrivate&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/registration"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/registration"):history.pushState(null,null,"/registration"))):(o.isPrivate?(o.phoneRegistationPrivateInput.focus(),o.phoneRegistationPrivate=o.phoneLoginPrivate):(o.emailRegistrationBusinessInput.focus(),o.emailRegistrationBusiness=o.emailLoginBusiness),window.location.pathname.toLowerCase().indexOf("login")<0&&!o.isPrivate&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/login"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/login"):history.pushState(null,null,"/login"))),o.clearData()}),100)},o.showAuthorizationPopup=function(e){!o.authorizationPopup&&o.initAuthorizationPopup(),o.clearData(),e&&(o.isPrivate=e.isPrivate,o.fromShortForm=e.fromShortForm,o.isRegistration=e.isRegistration,o.createOrder=e.createOrder,o.runSubmitOrderCreate=e.runSubmitOrderCreate,o.showReview=e.showReview,o.orderNumber=e.orderNumber),addCaptcha(),o.authorizationPopup.show(),n((function(){!o.isPrivate&&e&&e.phone&&(o.phoneRegistrationBusiness=e.phone,o.onPhoneRegistrationBusinessChange()),o.isPrivate&&o.recaptchaPrivateRendered&&(o.recaptchaPrivateRendered=!1,o.recaptchaPrivate2Rendered=!1),o.isRegistration?o.isPrivate?o.phoneLoginPrivateInput.focus():o.emailLoginBusinessInput.focus():o.isPrivate?o.phoneRegistationPrivateInput.focus():o.emailRegistrationBusinessInput.focus()}),150)},o.hideAuthorizationPopup=function(){o.authorizationPopup.hide()},o.$on("showAuthorizationPopup",(function(e,r){o.showAuthorizationPopup(r)})),o.$on("hideAuthorizationPopup",(function(e,r){o.hideAuthorizationPopup(r)})),o.onPhoneLoginPrivateBlur=function(e){n((function(){o.phoneLoginPrivateErrorMessage="",o.isPhoneLoginPrivateFocused=!1,o.isPhoneLoginPrivateValid=validatePhone(o.phoneLoginPrivate),""!=o.phoneLoginPrivate&&(o.isPhoneLoginPrivateFocused=!o.isPhoneLoginPrivateValid),e&&!o.isPhoneLoginPrivateValid&&(""!=o.phoneLoginPrivate?o.phoneLoginPrivateErrorMessage=o.wrongFormatPhoneError:o.phoneLoginPrivateErrorMessage=o.emptyPhoneError),o.isPhoneLoginPrivateFocused=!o.isPhoneLoginPrivateValid}),1)},o.onEmailLoginBlur=function(e){n((function(){o.isEmailLoginBusinessFocused=!1,o.emailLoginErrorMessage="",o.isEmailLoginBusinessValid=validateEmail(o.emailLoginBusiness),e&&!o.isEmailLoginBusinessValid&&(""==o.emailLoginBusiness?o.emailLoginErrorMessage=o.emptyEmailError:o.emailLoginErrorMessage=o.wrongFormatEmailError),o.isEmailLoginBusinessFocused=!o.isEmailLoginBusinessValid}),1)},o.onPasswordLoginBusinessBlur=function(){n((function(){o.isPasswordLoginBusinessFocused=!1,o.passwordLoginBusinessErrorMessage="",o.passwordLoginBusiness=o.passwordLoginBusiness||"",o.isPasswordLoginBusinessValid=o.passwordLoginBusiness.length>4,o.isPasswordLoginBusinessValid||(""==o.passwordLoginBusiness?o.passwordLoginBusinessErrorMessage=o.emptyPasswordErrorLogin:o.passwordLoginBusinessErrorMessage=o.wrongFormatPasswordErrorLogin),o.isPasswordLoginBusinessFocused=!o.isPasswordLoginBusinessValid}),1)},o.onPhoneRegistrationPrivateChange=function(){n((function(){o.isPhoneRegistrationPrivateValid=validatePhone(o.phoneRegistrationPrivate)}),1)},o.onPhoneRegistationPrivateBlur=function(){n((function(){o.isPhoneRegistationPrivateFocused=!1,o.isPhoneRegistationPrivateValid=validatePhone(o.phoneRegistationPrivate),""!=o.phoneRegistationPrivate&&(o.isPhoneRegistationPrivateFocused=!o.isPhoneRegistationPrivateValid),o.isPhoneRegistationPrivateValid&&o.codeRegistationPrivateInput.focus()}),1)},o.onPhoneRegistrationBusinessChange=function(){n((function(){o.isPhoneRegistrationBusinessValid=validatePhone(o.phoneRegistrationBusiness)}),1)},o.onCodePrivateChange=function(){n((function(){o.codePrivate=clearNonNumeric(o.codePrivate),o.incorrectCodePrivate=!1}),1)},o.onCodePrivateBlur=function(e){n((function(){o.isCodePrivateValid=!0,o.isCodePrivateFocused=!1,o.errorMessageLoginPrivate="",(5!=o.codePrivate.length||o.incorrectCodePrivate)&&o.isPhoneLoginPrivateValid&&(o.isCodePrivateValid=!1,o.isCodePrivateFocused=!0,o.errorMessageLoginPrivate=o.incorrectCodePrivate?o.incorrectPasswordError:o.codePrivate?o.wrongFormatPasswordError:o.emptyPasswordError)}),1)},o.changeNumber=function(){o.codePrivateSent=!1,o.incorrectCodePrivate=!1,o.timeoutPrivate=0,o.isCodePrivateValid=!0,o.isCodePrivateFocused=!1,o.codePrivateSent=!1,o.codePrivate="",o.recaptchaPrivateRendered=!1,o.recaptchaPrivate2Rendered=!1},o.onCodeRegistrationBusinessChange=function(){n((function(){o.codeRegistrationBusiness=clearNonNumeric(o.codeRegistrationBusiness),o.incorrectCodeBusiness=!1}),1)},o.onCodeRegistrationBusinessBlur=function(){n((function(){o.isCodeRegistrationBusinessValid=!0,o.isCodeRegistrationBusinessFocused=!1,o.codeRegistrationBusinessErrorMessage="",!o.codeRegistrationBusinessInputEnabled&&o.isEmailRegistrationBusinessValid&&o.isPhoneRegistrationBusinessValid&&(o.codeRegistrationBusinessInputEnabled=!0),(5!=o.codeRegistrationBusiness.length||o.incorrectCodeBusiness)&&o.isPhoneRegistrationBusinessValid&&(o.isCodeRegistrationBusinessValid=!1,o.isCodeRegistrationBusinessFocused=!0,o.codeRegistrationBusinessErrorMessage=o.incorrectCodeBusiness?o.incorrectPasswordError:o.codeRegistrationBusiness?o.wrongFormatPasswordError:o.emptyPasswordError)}),1)},o.onPhoneRegistrationBusinessBlur=function(){n((function(){o.phoneRegistrationBusinessErrorMessage="",o.isPhoneRegistrationBusinessFocused=!1,o.isPhoneRegistrationBusinessValid=validatePhone(o.phoneRegistrationBusiness),o.isPhoneRegistrationBusinessValid&&o.codeRegistrationBusinessInput.focus(),""!=o.phoneRegistrationBusiness?o.phoneRegistrationBusinessErrorMessage=o.wrongFormatPhoneError:o.phoneRegistrationBusinessErrorMessage=o.emptyPhoneError,o.isPhoneRegistrationBusinessFocused=!o.isPhoneRegistrationBusinessValid}),1)},o.onEmailRegistrationBusinessBlur=function(e){n((function(){e=1==e,o.emailRegistrationBusinessErrorMessage="",o.isEmailRegistrationBusinessValid=!0,o.isEmailRegistrationBusinessFocused=!1,(o.emailRegistrationBusiness.indexOf("@@")>-1||e)&&(o.isEmailRegistrationBusinessValid=validateEmail(o.emailRegistrationBusiness),o.isEmailRegistrationBusinessValid||(o.isEmailRegistrationBusinessFocused=!0,""!=o.emailRegistrationBusiness?o.emailRegistrationBusinessErrorMessage=o.wrongFormatEmailError:o.emailRegistrationBusinessErrorMessage=o.emptyEmailError))}),1)},o.loginPrivate=function(e){if(console.log("loginPrivate"),o.onPhoneLoginPrivateBlur(!0),o.onCodePrivateBlur(!0),o.locked)return!1;o.locked=!0,n((function(){o.isPhoneLoginPrivateValid&&o.isCodePrivateValid?o.$emit("login",{login:clearPhone(o.phoneLoginPrivate),password:o.codePrivate,handleError:o.handleError,moveToPersonalArea:!0,createOrder:o.createOrder,pageType:loginTypes.Physical,onSuccess:o.onLoginSuccess.bind(null,!0)}):n((function(){o.isPhoneLoginPrivateFocused=!0,o.locked=!1}),10)}),10)},o.loginBusiness=function(e){console.log("loginBusiness"),o.onEmailLoginBlur(!0),o.onPasswordLoginBusinessBlur(),n((function(){o.isEmailLoginBusinessValid&&o.isPasswordLoginBusinessValid&&o.$emit("login",{login:o.emailLoginBusiness,password:o.passwordLoginBusiness,handleError:o.handleError,moveToPersonalArea:!0,createOrder:o.createOrder,runSubmitOrderCreate:o.runSubmitOrderCreate,showReview:o.showReview,orderNumber:o.orderNumber,pageType:loginTypes.Company})}),10)},o.onLoginSuccess=function(e){var r=e?"EnterRegPrivate":"BusinessGoRegisterForm",i=e?"RegPrivate":"BusinessGoRegister";o.addYandexMetric(o.fromShortForm?r:i)},o.registerBusiness=function(){o.onPhoneRegistrationBusinessChange(),o.onEmailRegistrationBusinessBlur(!0),o.onPhoneRegistrationBusinessBlur();var e=clearPhone(o.phoneRegistrationBusiness);o.isPhoneRegistrationBusinessValid&&o.isEmailRegistrationBusinessValid&&!o.codeRegistrationBusinessInputEnabled&&(o.showSendMessage=!0),o.codeRegistrationBusinessInputEnabled&&o.onCodeRegistrationBusinessBlur();var r={email:o.emailRegistrationBusiness,password:o.codeRegistrationBusiness,login:o.emailRegistrationBusiness,phone:e,PhoneConfirmationCode:o.codeRegistrationBusiness};validatePhone(e)||n((function(){o.isPhoneRegistrationBusinessFocused=!0}),10),validateEmail(o.emailRegistrationBusiness)||n((function(){o.isEmailRegistrationBusinessFocused=!0}),10),n((function(){o.isPhoneRegistrationBusinessValid&&o.isEmailRegistrationBusinessValid&&o.isCodeRegistrationBusinessValid&&o.register(r,customerType.Company,!0)}),100)},o.register=function(e,r,i,s){if(o.locked)return!1;o.locked=!0,o.showPreLoader=!0,n((function(){o.showPreLoader=!1}),1e4);var t="";try{ga.getAll().forEach((function(e){t=e.get("clientId"),console.log(t)}))}catch(e){}e=e||{};var a={addressJuridical:"",addressPhysical:"",addressPostal:"",bankAccount:"",bankBIK:"",bankCorrAccount:"",bankName:"",company:"",inn:"",innScan:"",kpp:"",ogrn:"",ogrnScan:"",rank:5,Type:r,UTMS:localStorage.utms,region:o.TRANSPORT_REGION_SUBDOMAIN};e.ga_Id=t,e.utms=getUTMS(),e.customerInfo=a,console.log(e),client.invokeApi("customer/create",{method:"post",contentType:"application/json",data:JSON.stringify(e)},!0).done((function(i){var s=i;e.id=s,localStorage.removeItem("utms");try{console.log("ga event registration customer"),dataLayer&&dataLayer.push({event:"gaevent",eventCategory:"login",eventAction:"registration_success"})}catch(e){}o.$emit("login",{login:e.login,password:e.password,handleError:o.handleError,moveToPersonalArea:!0,createOrder:o.createOrder,runSubmitOrderCreate:o.runSubmitOrderCreate,pageType:o.pageType,showReview:o.showReview,orderNumber:o.orderNumber,onSuccess:o.onLoginSuccess.bind(null,!1)}),r==customerType.Company&&o.hideAuthorizationPopup(),n((function(){o.locked=!1}),0)})).fail((function(r){if(client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},n((function(){o.showPreLoader=!1,o.locked=!1}),0),!s){var i=parseError(r);"Данный номер уже зарегистрирован"==i?n((function(){o.phoneLoginPrivate=e.login,o.onPhoneLoginPrivateBlur(),o.isPrivate=!0,o.isRegistration=!0,n((function(){o.passwordLoginPrivateInput.focus()}),200)}),1):"Выбранный почтовый ящик уже используется"==i?n((function(){o.emailLoginBusiness=e.login,o.onEmailLoginBlur(),o.isPrivate=!1,o.isRegistration=!0,n((function(){o.passwordLoginBusinessInput.focus()}),200)}),1):"Email уже используется"==i?n((function(){o.registerBusinessError=i,o.isEmailRegistrationBusinessValid=!1,o.isEmailRegistrationBusinessFocused=!0}),1):o.handleError(r)}}))},o.phoneIsEmpty=function(){return!(!o.isPrivate||!o.isRegistration||""!=o.phoneLoginPrivate)||(!(!o.isPrivate||o.isRegistration||""!=o.phoneRegistationPrivate)||!o.isPrivate&&!o.isRegistration&&""==o.phoneRegistrationBusiness)},o.sendCodeBusinessInternal=function(){n((function(){sendSMS({phone:o.phoneRegistrationBusiness,type:SMSType.Login},!0).done((function(){showToast({message:"На указанный номер телефона был отправлен смс-пароль",timeout:5e3}),n((function(){client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},o.recaptchaBusinessValid=!0,o.showSendMessage=!1,o.codeRegistrationBusinessSent=!0,o.codeRegistrationBusinessInputEnabled=!0,o.timeoutBusiness=o.smsTimeout,e&&clearInterval(e),r&&clearTimeout(r),e=setInterval((function(){n((function(){o.timeoutBusiness--}),0)}),1e3),r=setTimeout((function(){n((function(){o.codeRegistrationBusinessSent=!1}),0),clearInterval(e)}),1e3*o.smsTimeout)}),0)})).fail((function(){showError("При отправке сообщения произошла ошибка")}))}),0)},o.sendCodeRegistrationBusiness=function(){if(o.clearErrors(),o.phoneIsEmpty())return!1;if(!o.codeRegistrationBusinessSent&&o.isPhoneRegistrationBusinessValid){o.recaptchaBusinessRendered=!1,o.recaptchaBusinessValid=!1;var e=clearPhone(o.phoneRegistrationBusiness);o.addYandexMetric(o.fromShortForm?"CodeRequestForm":"CodeRequest"),client.invokeApi("User/CheckCodeRequest?phone="+e,{method:"post",contentType:"application/json"}).done((function(e){n((function(){e?o.sendCodeBusinessInternal():o.recaptchaBusinessRendered?grecaptcha.reset():(o.recaptchaBusinessRendered=!0,n((function(){grecaptcha.render("googleRecaptchaBusiness",{sitekey:Global.RecaptchaSiteKey,callback:o.sendCodeBusinessInternal,"error-callback":function(e){o.recaptchaBusinessValid=!1,console.log(e)}})}),1))}),1)}))}else o.onPhoneRegistrationBusinessBlur()},o.sendCodeInternal=function(){o.isSMSsentOC=!0,o.timeoutPrivate=o.smsTimeout,e&&clearInterval(e),r&&clearTimeout(r),sendSMS({phone:o.phoneLoginPrivate,type:SMSType.Login},!0).done((function(){n((function(){e=setInterval((function(){n((function(){o.timeoutPrivate--}),0)}),1e3),r=setTimeout((function(){n((function(){o.isSMSsentOC=!1,o.recaptchaPrivate2Rendered=!1}),0),clearInterval(e)}),1e3*o.smsTimeout),showToast({message:"На указанный номер телефона был отправлен смс-пароль",timeout:5e3}),client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},o.codePrivateSent=!0,o.codePrivateInputEnabled=!0}),1)})).fail((function(){showError("При отправке сообщения произошла ошибка")}))},o.sendCodePrivate=function(){o.onPhoneLoginPrivateBlur(!0),n((function(){if(o.isPhoneLoginPrivateValid){o.codePrivateSent?o.recaptchaPrivate2Rendered=!1:o.recaptchaPrivateRendered=!1;var e=clearPhone(o.phoneLoginPrivate);o.addYandexMetric(o.fromShortForm?"CodeSMSRequestPrivate":"CodeRequestPrivate"),client.invokeApi("User/CheckCodeRequest?phone="+e,{method:"post",contentType:"application/json"}).done((function(e){n((function(){e?o.sendCodeInternal():o.codePrivateSent?o.recaptchaPrivate2Rendered?grecaptcha.reset():(o.recaptchaPrivate2Rendered=!0,n((function(){grecaptcha.render("googleRecaptchaPrivate2",{sitekey:Global.RecaptchaSiteKey,callback:o.sendCodeInternal,"error-callback":function(e){console.log(e)}})}),1)):o.recaptchaPrivateRendered?grecaptcha.reset():(o.recaptchaPrivateRendered=!0,n((function(){grecaptcha.render("googleRecaptchaPrivate",{sitekey:Global.RecaptchaSiteKey,callback:o.sendCodeInternal,"error-callback":function(e){console.log(e)}})}),1))}),1)}))}}),100)},o.handleError=function(e){n((function(){if(o.showPreLoader=!1,o.locked=!1,o.clearErrors(),o.isPrivate)"Неправильный логин или пароль"==parseError(e)?(o.incorrectCodePrivate=!0,o.onCodePrivateBlur()):handleError(e);else if(o.isRegistration){"Неверный код подтверждения"==parseError(e)?(o.incorrectCodeBusiness=!0,o.onCodeRegistrationBusinessBlur()):handleError(e)}else o.isRegistration||(o.loginBusinessError=parseError(e),o.isPasswordLoginBusinessFocused=!0,o.isEmailLoginBusinessFocused=!0)}),1)},o.showForgotPasswordNewPopup=function(e){var r={isPrivate:e};r.login=e?clearPhone(o.phoneLoginPrivate):o.emailLoginBusiness,o.hideAuthorizationPopup(),o.$emit("mainShowForgotPasswordNewPopup",r)},o.authorizationPopup=void 0,o.initAuthorizationPopup=function(){o.authorizationPopup=modalWindow("#customer-auth-popup","auth-popup customer-auth-popup register-driver-popup",{clickBgClose:function(){return window.innerWidth>o.maxMobile},onShow:function(){o.isPrivate||(o.pageUrl=window.location.pathname,o.isRegistration?window.location.pathname.toLowerCase().indexOf("registration")<0&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/registration"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/registration"):history.pushState(null,null,"/registration")):window.location.pathname.toLowerCase().indexOf("login")<0&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/login"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/login"):history.pushState(null,null,"/login")))},onClose:function(){o.isPrivate||(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads"):history.pushState(null,null,"/")),o.$emit("mainAuthPopupClose")}})},o.initPopup=function(){n((function(){!o.authorizationPopup&&o.initAuthorizationPopup(),o.phoneLoginPrivateInput=$("#phoneLoginPrivate"),o.emailLoginBusinessInput=$("#emailLoginBusiness"),o.passwordBusinessInput=$("#passwordBusiness"),o.phoneRegistationPrivateInput=$("#phoneRegistationPrivate"),o.emailRegistrationBusinessInput=$("#emailRegistrationBusiness"),o.codeRegistationPrivateInput=$("#codeRegistationPrivate"),o.codeRegistrationBusinessInput=$("#codeRegistrationBusiness"),o.passwordLoginPrivateInput=$("#passwordLoginPrivate"),o.passwordLoginBusinessInput=$("#passwordLoginBusiness")}),200)},o.initPopup()}])}(),function(){var e,r;myApp.controller("registerDriverCtrl",["$scope","$filter","$timeout","$compile",function(o,i,n,s){o.isNullOrWhiteSpace=isNullOrWhiteSpace,o.smsTimeout=Global.SMSTimeout,o.isAuth=!1,o.remember=!0,o.emptyPhoneError="Введите номер мобильного телефона",o.wrongFormatPhoneError="Введен некорректный номер мобильного телефона",o.emptyEmailError=ErrorString.EmptyEmailError,o.wrongFormatEmailError=ErrorString.WrongFormatEmailError,o.incorrectCode=!1,o.connectionError="",o.email="",o.name="",o.phone="",o.code="",o.recaptchaCarrierValid=!0,o.timeoutP=0,o.emailLogin="",o.password="",o.isEmailValid=!1,o.isPhoneValid=!1,o.isEmailLoginValid=!1,o.isPasswordLoginValid=!1,o.isPasswordLoginFocused=!1,o.isCodeValid=!1,o.isEmailFocused=!1,o.isPhoneFocused=!1,o.isEmailLoginFocused=!1,o.isCodeFocused=!1,o.codeSent=!1,o.codeInputEnabled=!1,o.password="",o.errorMessage="",o.errorMessage="",o.emailErrorMessage="",o.emailLoginErrorMessage="",o.phoneErrorMessage="",o.codeErrorMessage="",o.url=window.location.pathname.toLowerCase(),o.pageType=loginUrls[o.url]||loginTypes.Company,o.clearData=function(){o.codeSent=!1,o.codeInputEnabled=!1,o.showSendMessage=!1,o.isAuth=!1,o.email="",o.name="",o.phone="",o.code="",o.emailLogin="",o.password="",o.isEmailValid=!1,o.isPhoneValid=!1,o.isEmailLoginValid=!1,o.isPasswordLoginValid=!1,o.isCodeValid=!1,o.isCodeFocused=!1,o.isEmailFocused=!1,o.isPhoneFocused=!1,o.isEmailLoginFocused=!1,o.isPasswordLoginFocused=!1,o.recaptchaCarrierRendered=!1,o.recaptchaBusinessRendered=!1,o.recaptchaCarrierValid=!0,o.recaptchaBusinessValid=!0,o.clearErrors()},o.clearErrors=function(){o.errorMessage="",o.connectionError="",o.emailErrorMessage="",o.phoneErrorMessage="",o.emailLoginErrorMessage="",o.codeErrorMessage="",o.incorrectCode=""},o.registerDriverPopup=void 0,o.initRegisterDriverElement=function(){o.registerDriverPopup=modalWindow("#regdriver-popup-cont","auth-popup register-driver-popup",{clickBgClose:function(){return window.innerWidth>o.maxMobile},onShow:function(){},onClose:function(){}})},n((function(){if(!o.registerDriverPopup&&o.initRegisterDriverElement(),isMobile){var e=document.getElementById("carrier-code"),r=document.querySelector(".register-driver-popup .mw-container");e.addEventListener("focus",(function(){var e=document.querySelector(".register-driver-popup  .mw-show .mws-content");null!=e&&setTimeout((function(){document.body.classList.add("input-number-pass-focus"),document.querySelector("html").classList.contains("ios")||(r.style.height=window.innerHeight+150+"px",e.scrollTop=150)}),150)})),e.addEventListener("blur",(function(){r.style.height="auto"})),document.addEventListener("click",(function(){"carrier-code"!=event.target.id&&e.blur()}))}}),200),o.showRegisterDriverPopup=function(e){!o.registerDriverPopup&&o.initRegisterDriverElement(),o.clearData(),addCaptcha(),e=e||{},o.isAuth=1==e.isAuth,o.pageType=e.pageType||o.pageType,o.registerDriverPopup.show()},o.hideRegisterDriverPopup=function(){o.registerDriverPopup.close()},o.$on("showRegisterDriverPopup",(function(e,r){o.showRegisterDriverPopup(r)})),o.setAuth=function(e){n((function(){var r=o.code,i=o.email;o.clearData(),o.isAuth=e,1==o.isAuth&&(o.emailLogin=i,o.password=r,o.emailLogin&&""!=o.emailLogin&&o.onEmailLoginBlur())}),0)},o.rememberclick=function(){o.remember=!o.remember},o.onPhoneChange=function(){n((function(){o.phoneErrorMessage="",o.isPhoneValid=validatePhone(o.phone),o.isPhoneFocused=!1,o.isPhoneValid||(o.isPhoneFocused=!0,""!=o.phone?o.phoneErrorMessage=o.wrongFormatPhoneError:o.phoneErrorMessage=o.emptyPhoneError)}),1)},o.checkFullPhone=function(){n((function(){o.isPhoneValid=validatePhone(o.phone)}),1)},o.onCodeChange=function(){o.code&&(o.code=o.code.replace(/[^0-9]/g,"")),o.incorrectCode=!1},o.onCodeBlur=function(){n((function(){o.isCodeValid=!0,o.isCodeFocused=!1,o.codeErrorMessage="",o.codeInputEnabled&&(5!=o.code.length||o.incorrectCode)&&o.isPhoneValid&&(o.isCodeValid=!1,o.isCodeFocused=!0,o.codeErrorMessage=o.incorrectCode?o.incorrectPasswordError:o.code?o.wrongFormatPasswordError:o.emptyPasswordError)}),1)},o.onEmailChange=function(e){n((function(){e=1==e,o.emailErrorMessage="",o.isEmailValid=!0,o.isEmailFocused=!1,(o.email.indexOf("@@")>-1||e)&&(o.isEmailValid=validateEmail(o.email),o.isEmailValid||(o.isEmailFocused=!0,""!=o.email?o.emailErrorMessage=o.wrongFormatEmailError:o.emailErrorMessage=o.emptyEmailError))}),1)},o.onEmailLoginChange=function(){n((function(){o.emailLoginErrorMessage="",o.isEmailLoginFocused=!1}),1)},o.onEmailLoginBlur=function(e){n((function(){o.emailLoginErrorMessage="",o.isEmailLoginFocused=!1,(o.emailLogin.indexOf("@@")>-1||e)&&(o.isEmailLoginValid=validateEmail(o.emailLogin),o.isEmailLoginValid||(o.isEmailLoginFocused=!0,""!=o.emailLogin?o.emailLoginErrorMessage=o.wrongFormatEmailError:o.emailLoginErrorMessage=o.emptyEmailError))}),1)},o.passwordLoginErrorMessage="",o.onPasswordLoginBlur=function(){n((function(){o.passwordLoginErrorMessage="",o.isPasswordLoginValid=!0,null!=o.password&&""!=o.password||(o.isPasswordLoginValid=!1,o.passwordLoginErrorMessage="Введите пароль"),o.isPasswordLoginFocused=!o.isPasswordLoginValid}),1)},o.registerDriver=function(){o.pageType==loginTypes.Carrier&&o.addYandexMetric("DriverRegStep0"),o.onEmailChange(!0),o.onPhoneChange(),o.isEmailValid&&o.isPhoneValid&&!o.codeInputEnabled&&(o.showSendMessage=!0),o.codeInputEnabled&&o.onCodeBlur(),n((function(){o.isEmailValid&&o.isPhoneValid&&o.isCodeValid&&o.register()}),100)},o.register=function(){if(o.locked)return!1;o.locked=!0;var e="";try{ga.getAll().forEach((function(r){e=r.get("clientId"),console.log(e)}))}catch(e){}var r=clearPhone(o.phone),i={email:o.email,password:o.code,name:"",login:o.email,phone:r,PhoneConfirmationCode:o.code};i=i||{};var s=transportRegion.MO;o.TRANSPORT_REGION_SUBDOMAIN==transportRegion.LO?s=transportRegion.LO:o.TRANSPORT_REGION_SUBDOMAIN==transportRegion.NO&&(s=transportRegion.NO);var t={addressJuridical:"",addressPhysical:"",addressPostal:"",bankAccount:"",bankBIK:"",bankCorrAccount:"",bankName:"",company:"",inn:"",innScan:"",kpp:"",ogrn:"",ogrnScan:"",rank:5,region:s,type:o.pageType==loginTypes.CarrierCompany?carrierType.Company:carrierType.Driver};i.ga_Id=e,i.driverInfo=i.carrierInfo=t,i.utms=getUTMS(),n((function(){o.isEmailValid&&o.isPhoneValid&&o.isCodeValid?client.invokeApi("carrier/Create",{method:"post",contentType:"application/json",data:JSON.stringify(i)},!0).done((function(e){o.emailLogin=o.email,o.password=o.code,o.isEmailLoginValid=!0,o.locked=!1;try{console.log("ga event registration carrier"),dataLayer&&dataLayer.push({event:"gaevent",eventCategory:"login",eventAction:"registration_success"})}catch(e){}o.login(),o.hideRegisterDriverPopup()})).fail((function(e){o.locked=!1,"Неверный код подтверждения"==parseError(e)?(o.incorrectCode=!0,o.onCodeBlur()):handleError(e)})):o.locked=!1}),100)},o.sendSmsCodeIntenal=function(){n((function(){o.recaptchaCarrierValid=!0,sendSMS({phone:o.phone,type:SMSType.Login}),client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},o.showSendMessage=!1,o.codeSent=!0,o.codeInputEnabled=!0,n((function(){$("#carrier-code").focus()}),200),e&&clearInterval(e),r&&clearTimeout(r),o.timeoutP=o.smsTimeout,e=setInterval((function(){n((function(){o.timeoutP--}),0)}),1e3),r=setTimeout((function(){n((function(){o.codeSent=!1}),0),clearInterval(e)}),1e3*o.smsTimeout)}),0)},o.sendCode=function(){if(o.pageType==loginTypes.Carrier&&o.addYandexMetric("CodeRequestDriver"),o.isPhoneValid){o.recaptchaCarrierRendered=!1,o.recaptchaCarrierValid=!1;var e=clearPhone(o.phone);client.invokeApi("User/CheckCodeRequest?phone="+e,{method:"post",contentType:"application/json"}).done((function(e){n((function(){e?o.sendSmsCodeIntenal():o.recaptchaCarrierRendered?grecaptcha.reset():(o.recaptchaCarrierRendered=!0,n((function(){grecaptcha.render("googleRecaptchaCarrier",{sitekey:Global.RecaptchaSiteKey,callback:o.sendSmsCodeIntenal,"error-callback":function(e){o.recaptchaCarrierValid=!1,console.log(e)}})}),1))}),1)}))}},o.showForgotPasswordNewPopup=function(){var e={login:o.emailLogin};o.hideRegisterDriverPopup(),o.$emit("mainShowForgotPasswordNewPopup",e)},o.login=function(){o.onEmailLoginBlur(!0),o.onPasswordLoginBlur(),n((function(){o.isEmailLoginValid&&o.isPasswordLoginValid&&o.$emit("login",{login:o.emailLogin,password:o.password,handleError:o.handleError,moveToPersonalArea:!0,pageType:o.pageType})}),100)},o.handleError=function(e){n((function(){o.connectionError=parseError(e),"5"!=e.status.toString()[0]&&("Email уже используется"==o.connectionError?(o.isEmailFocused=!0,o.isEmailValid=!1):(o.isPasswordLoginFocused=o.isEmailLoginFocused=o.isCodeFocused=!0,o.isPasswordLoginValid=o.isEmailLoginValid=o.isCodeValid=!1))}),1),n((function(){$(".popup-container-new.registration").css("height",634+$(".registration-error").height())}),100)}}])}(),myApp.controller("forgotPasswordNewCtrl",["$scope","$filter","$timeout","$compile",function(e,r,o,i){e.isNullOrWhiteSpace=isNullOrWhiteSpace,e.emptyEmailError=ErrorString.EmptyEmailError,e.wrongFormatEmailError=ErrorString.WrongFormatEmailError,e.sent=!1,e.email="",e.isEmailFocused=!1,e.isEmailValid=!1,e.brokenRepairPassLink=!1,e.errorMessage="",e.clearData=function(){e.email="",e.isEmailFocused=!1,e.isEmailValid=!1,e.sent=!1,e.errorMessage="",e.connectionError=""},o((function(){e.forgotPasswordNewPopup=modalWindow("#forgot-password-new","auth-popup forgot-password-popup",{clickBgClose:function(){return window.innerWidth>e.maxMobile},onClose:function(){e.brokenRepairPassLink&&(window.location.href=window.location.origin+"/",setTimeout((function(){document.location.href="/"}),20))}}),e.emailInput=$("#email-input-new")}),0),e.setAuthType=function(r){e.isPrivate=r},e.showForgotPasswordNewPopup=function(r){(r=r||{}).login=r.login||"",e.isStepsPage=r.steps,e.restoreText=e.isStepsPage?"аккаунта":"пароля",e.restoreButtonText=e.isStepsPage?"аккаунт":"пароль",1!=r.isPrivate&&(r.isPrivate=!1),e.brokenRepairPassLink=!0===r.brokenRepairPassLink,e.clearData(),o((function(){e.email=""+r.login,r.login&&e.onEmailChange()}),1),e.forgotPasswordNewPopup.show(),e.emailInput.focus(),console.log("forgot popup is visible")},e.hideForgotPasswordNewPopup=function(){e.forgotPasswordNewPopup.close()},e.$on("showForgotPasswordNewPopup",(function(r,o){e.clearData(),e.showForgotPasswordNewPopup(o)})),e.onEmailChange=function(){o((function(){e.errorMessage="",e.connectionError="",e.isEmailValid=validateEmail(e.email),e.isEmailValid||(""!=e.email?e.errorMessage=e.wrongFormatEmailError:e.errorMessage=e.emptyEmailError)}),1)},e.onEmailBlur=function(r){o((function(){e.errorMessage="",e.isEmailFocused=!1,(e.email.indexOf("@@")>-1||r)&&(e.isEmailValid=validateEmail(e.email),e.isEmailValid||(e.isEmailFocused=!0,""!=e.email?e.errorMessage=e.wrongFormatEmailError:e.errorMessage=e.emptyEmailError))}),1)},e.remembered=function(){e.hideForgotPasswordNewPopup(),e.$emit("rememberedCarrierPassword")},e.startTimer=function(){e.counter=30,e.showCounter=!0;var r=setInterval((function(){o((function(){e.counter--,0==e.counter&&(clearInterval(r),e.showCounter=!1)}),0)}),1e3)},e.forgot=function(){e.isEmailValid?(login=e.email,localStorage.third=btoa(login),client.invokeApi("User/ForgotUserPassword",{method:"post",parameters:{login:login}}).done((function(){o((function(){e.sent=!0,e.startTimer()}),1)})).fail((function(r){e.handleError(r)}))):(e.onEmailChange(),o((function(){e.isEmailFocused=!0}),10))},e.sendCode=function(){e.isPrivate&&(e.isPhoneValid?client.invokeApi("User/ForgotUserPassword",{method:"post",parameters:{login:clearPhone(e.phone)}}).done((function(){})).fail((function(r){e.errorMessage=parseError(r)})):e.errorMessage="Введен неверный номер телефона"),console.log("send code")},e.handleError=function(r){o((function(){e.connectionError=parseError(r),"5"!=r.status.toString()[0]?(e.isEmailFocused=!0,e.isEmailValid=!1):e.sentError=!0}),1)}}]);