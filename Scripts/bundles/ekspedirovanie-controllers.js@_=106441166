function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){_defineProperty(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}function _defineProperty(e,r,i){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function _toPropertyKey(e){var r=_toPrimitive(e,"string");return"symbol"===_typeof(r)?r:String(r)}function _toPrimitive(e,r){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,r||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,r):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var i=0,o=new Array(r);i<r;i++)o[i]=e[i];return o}function ownKeys(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){_defineProperty(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))}))}return e}function _defineProperty(e,r,i){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function _toPropertyKey(e){var r=_toPrimitive(e,"string");return"symbol"===_typeof(r)?r:String(r)}function _toPrimitive(e,r){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,r||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}myApp.controller("ekspedirovanieCtrl",["$scope","$filter","$timeout",function(e,r,i){e.showBreadCrumb.text="Экспедирование грузов",e.goToCreateOrder=function(){window.location.href="/createorder"}}]),myApp.controller("footerCtrl",["$scope","$filter","$q","$timeout",function(e,r,i,o){var n=$.Deferred(),s=$.Deferred();function t(){o((function(){e.leftGroup=a(e.leftItems.slice(),0),e.rightGroup=a(e.rightItems.slice(),1)}),0)}function a(r,i){var o,n=[],s=!1,t=4;if(window.innerWidth<=e.maxMobile&&(s=!0,e.rightItems.length||(t=2)),s){var a=e.leftItems.concat(e.rightItems);return i?[a.slice(Math.ceil(a.length/2))]:[a.slice(0,Math.ceil(a.length/2))]}return window.innerWidth<=e.maxTablet&&i?[r]:(r.length>t?(o=r.length%2==0?r.length/2:Math.ceil(r.length/2),n.push(r.slice(0,o),r.slice(o))):n.push(r),n)}e.leftGroup=[],e.rightGroup=[],e.leftItems=[],e.rightItems=[],e.url=window.location.pathname.toLowerCase(),e.forCarriers=e.url==loginUrls[loginTypes.Carrier]||e.url==loginUrls[loginTypes.CarrierCompany],e.onResize=function(){e.leftGroup=a(e.leftItems.slice(),0),e.rightGroup=a(e.rightItems.slice(),1),t()},$(window).resize(e.onResize),$.ajax({type:"GET",url:"/GetBottomMenuItemsLeft",contentType:!1,processData:!1,success:function(e){n.resolve(e)},error:function(e){console.log(e),n.reject(e)}}),$.ajax({type:"GET",url:"/GetBottomMenuItemsRight",contentType:!1,processData:!1,success:function(e){s.resolve(e)},error:function(e){console.log(e),s.reject(e)}}),$.when(n,s).done((function(r,i){e.leftItems=JSON.parse(r),e.handleTarrifsUrl(),e.rightItems=JSON.parse(i),e.leftItems=e.leftItems.map((function(e){return _objectSpread(_objectSpread({},e),{},{t:e.text})})),e.rightItems=e.rightItems.map((function(e){return _objectSpread(_objectSpread({},e),{},{t:e.text})})),t()})),e.handleTarrifsUrl=function(){for(var r=0;r<e.leftItems.length;r++)"tarify"==e.leftItems[r].url&&(e.leftItems[r].url=e.composeTariffsUrl().slice(1))},e.$on("customerLoaded",(function(){o((function(){if(e.isNDSCounted&&e.currentCustomer&&(e.currentCustomer.contractType==customerContractType.CompanyTEO||e.currentCustomer.contractType==customerContractType.DirectContractTEO))for(var r=0;r<e.leftItems.length;r++)"insurance"==e.leftItems[r].url&&(e.leftItems[r].url="insurance_teo")}),10)}))}]);var menuUrls,menuUrlsSecondLevel,header__onLoad,menuTypes={Physical:1,Business:2,Carrier:3,Admin:4,CarrierCompany:5,Business2:6,Carrier2:7,CarrierCompany2:8,Business3:9,Business4:10},currentUrl=window.location.pathname.toLowerCase();!function(){var e;e={gruzoperevozki:[{name:"Газелью",url:otherPageUrls[otherPageTypes.Gazelles]},{name:"Фурами",url:otherPageUrls[otherPageTypes.Trucks]},{name:"Рефрижераторные",url:otherPageUrls[otherPageTypes.Refrigirators]},{name:"С гидробортом",url:"/tarify-dlya-biznesa/gruzoperevozki-gidrobort"},{name:"Манипулятором",url:null},{name:"В торговые сети",url:otherPageUrls[otherPageTypes.TradeDelivery]}],"/tarify-dlya-biznesa":[{hidden:"true",url:"/tarify-dlya-biznesa"},{name:"1 т",url:"/tarify-dlya-biznesa/gruzoperevozki-1-tonna"},{name:"1,5 т",url:"/tarify-dlya-biznesa/gruzoperevozki-1.5-tonny"},{name:"3 т",url:"/tarify-dlya-biznesa/gruzoperevozki-3-tonny"},{name:"5 т",url:"/tarify-dlya-biznesa/gruzoperevozki-5-tonn"},{name:"10 т",url:"/tarify-dlya-biznesa/gruzoperevozki-10-tonn"},{name:"20 т",url:"/tarify-dlya-biznesa/gruzoperevozki-20-tonn"},{name:"с НДС",url:"/tarify-dlya-biznesa/gruzoperevozki-s-nds"}]},_defineProperty(e,otherPageUrls[otherPageTypes.Marketplaces],[{hidden:"true",url:otherPageUrls[otherPageTypes.Marketplaces]},{name:"Ozon",url:otherPageUrls[otherPageTypes.Ozon]},{name:"Wildberries",url:otherPageUrls[otherPageTypes.Wildberries]},{name:"СберМегаМаркет",url:otherPageUrls[otherPageTypes.Sber]},{name:"Яндекс Маркет",url:otherPageUrls[otherPageTypes.Yandeks]},{name:"Lamoda",url:otherPageUrls[otherPageTypes.Lamoda]},{name:"AliExpress",url:otherPageUrls[otherPageTypes.AliExpress]},{name:"Детский мир",url:otherPageUrls[otherPageTypes.DetskijMir]}]),_defineProperty(e,"moving",[{name:"Банка",url:otherPageUrls[otherPageTypes.Bank]},{name:"Склада",url:otherPageUrls[otherPageTypes.Warehouse]},{name:"Магазина",url:otherPageUrls[otherPageTypes.Store]},{name:"Переезд компании",url:otherPageUrls[otherPageTypes.Company]},{name:"Офисный переезд",url:otherPageUrls[otherPageTypes.Office]}]),_defineProperty(e,"shipping",[{name:"Станков",url:otherPageUrls[otherPageTypes.Machine]},{name:"Серверов",url:otherPageUrls[otherPageTypes.Server]},{name:"Банкоматов",url:otherPageUrls[otherPageTypes.ATM]},{name:"Оргтехники и офисной техники",url:otherPageUrls[otherPageTypes.OfficeEquipment]},{name:"Торгового оборудования",url:otherPageUrls[otherPageTypes.CommercialEquipment]},{name:"Полиграфического оборудования",url:otherPageUrls[otherPageTypes.PrintingEquipment]},{name:"Транспортировка архивных документов",url:otherPageUrls[otherPageTypes.Archive]}]),_defineProperty(e,"uslugi",[{name:"Экспедирование грузов",url:"/ekspedirovanie"},{name:"Услуги грузчиков",url:"/gruzchiki"}]),_defineProperty(e,loginUrls[loginTypes.Physical],[{hidden:"true",url:loginUrls[loginTypes.Physical]},{name:"Квартирый переезд",url:otherPageUrls[otherPageTypes.Apartment]},{name:"Дачный переезд",url:otherPageUrls[otherPageTypes.Cottage]},{name:"Перевозка вещей",url:otherPageUrls[otherPageTypes.Thing]},{name:"Кровати",url:otherPageUrls[otherPageTypes.Bed]},{name:"Дивана",url:otherPageUrls[otherPageTypes.Sofa]},{name:"Шкафа",url:otherPageUrls[otherPageTypes.Cabinet]},{name:"Мебели",url:otherPageUrls[otherPageTypes.Furniture]},{name:"Перевозка бытовой техники",url:otherPageUrls[otherPageTypes.Household]},{name:"Стиральной машины",url:otherPageUrls[otherPageTypes.WashingMachine]},{name:"Холодильника",url:otherPageUrls[otherPageTypes.RefrigeratorsPhysic]}]),_defineProperty(e,"/tarify-gruzovoe-taxi",[{hidden:"true",url:"/tarify-gruzovoe-taxi"},{name:"1 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-1-tonna"},{name:"1,5 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-1.5-tonny"},{name:"3 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-3-tonny"},{name:"5 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-5-tonn"}]),menuUrlsSecondLevel=e;var r=[];Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.MO?r=[{name:"По Москве и Московской области",url:"/moscow"}]:Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.LO?r=[{name:"По Санкт-Петербургу и Ленинградской области",url:"/spb"}]:Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.NO?r=[{name:"По Нижнему Новгороду и области",url:"/nn"}]:Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.SO&&(r=[{name:"По Екатеринбургу и области",url:"/ekb"}]),menuUrlsSecondLevel.gruzoperevozki=r.concat(menuUrlsSecondLevel.gruzoperevozki),(menuUrls=_objectSpread({},menuUrlsSecondLevel))[loginTypes.Company]=[loginUrls[loginTypes.Company]].concat(_toConsumableArray(menuUrls.gruzoperevozki.filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls["/tarify-dlya-biznesa"].filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls[otherPageUrls[otherPageTypes.Marketplaces]].filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls.moving.filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls.shipping.filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls.uslugi.filter((function(e){return null!=e.url})).map((function(e){return e.url})))),menuUrls[loginTypes.Physical]=[loginUrls[loginTypes.Physical]].concat(_toConsumableArray(menuUrls["/tarify-gruzovoe-taxi"].filter((function(e){return null!=e.url})).map((function(e){return e.url})))),menuUrls.carrierAndCompany=[loginUrls[loginTypes.Carrier],loginUrls[loginTypes.CarrierCompany]]}(),myApp.controller("menuCtrl",["$scope","$filter","$q","$timeout",function(e,r,i,o){e.url=window.location.pathname.toLowerCase(),e.isUserDropdownOpen=!1,e.isBurgerOpen=!1,e.menuUrls=menuUrls,e.forCarriers=e.url==loginUrls[menuTypes.Carrier]||e.url==loginUrls[menuTypes.CarrierCompany],e.notifyUrls=["/"].concat(_toConsumableArray(citiesAddresses),[otherPageUrls[otherPageTypes.TarrifsBusiness],otherPageUrls[otherPageTypes.Insurance],otherPageUrls[otherPageTypes.About],otherPageUrls[otherPageTypes.Contacts]]),e.notifyVisible=!1,e.closeHeaderNotify=function(){e.notifyVisible=!1},e.notifyDetails=function(){window.location.href=otherPageUrls[otherPageTypes.Refrigirators]},e.logoutWithTimeout=function(){o((function(){e.logout()}),0)},e.toggleUserDropdown=function(r,i){e.isUserDropdownOpen=r?!e.isUserDropdownOpen:i},e.getLkUrl=function(e){var r="";return e==loginTypes.Company||e==loginTypes.Physical?r="/CustomerOffice":e!=loginTypes.Carrier&&e!=loginTypes.CarrierCompany||(r="/CarrierOffice"),r},(header__onLoad=function(){"/user/forgotpassword"!=currentUrl&&"/user/verify"!=currentUrl||("true"==Global.Third.toLowerCase()?currentUrl=2==Global.Fourth?loginUrls[menuTypes.Carrier]:loginUrls[menuTypes.CarrierCompany]:"/user/verify"==currentUrl?2==Global.Fourth?(currentUrl=loginUrls[menuTypes.Physical],e.isBusiness=e.$parent.isBusiness=!1):(currentUrl=loginUrls[menuTypes.Business],e.isBusiness=e.$parent.isBusiness=!0):currentUrl=loginUrls[menuTypes.Business]),currentUrl==loginUrls[menuTypes.Business]||currentUrl==loginUrls[menuTypes.Business2]||currentUrl==loginUrls[menuTypes.Business3]||currentUrl==loginUrls[menuTypes.Business4]?(pageType=e.pageType=e.$parent.pageType=loginTypes.Company,e.isBusiness=e.$parent.isBusiness=!0):currentUrl==loginUrls[menuTypes.Carrier]||currentUrl==loginUrls[menuTypes.Carrier2]?(pageType=e.pageType=e.$parent.pageType=loginTypes.Carrier,currentUrl==loginUrls[menuTypes.Carrier2]&&(e.carrier2=e.$parent.carrier2=!0)):currentUrl==loginUrls[menuTypes.CarrierCompany]||currentUrl==loginUrls[menuTypes.CarrierCompany2]?(pageType=e.pageType=e.$parent.pageType=loginTypes.CarrierCompany,currentUrl==loginUrls[menuTypes.CarrierCompany2]&&(e.carrier2=e.$parent.carrier2=!0)):currentUrl==loginUrls[menuTypes.Admin]?pageType=e.pageType=e.$parent.pageType=loginTypes.Admin:currentUrl==loginUrls[menuTypes.Physical]&&(pageType=e.pageType=e.$parent.pageType=loginTypes.Physical)})(),e.isActive=function(e){return e===currentUrl},e.toggleSecondLevel=function(r){e[r]||(e.showMobileCompany=!1,e.showMobileCarrier=!1,e.showMobilePhysical=!1),e[r]=!e[r]},e.setActiveSubMenu=function(r){e.activeSubMenu=r},e.citiesMenuVisible=!1,e.showCities=function(){e.citiesMenuVisible=!0},e.toggleBurger=function(r){if(e.citiesMenuVisible=!1,e.isBurgerOpen=!e.isBurgerOpen,e.isBurgerOpen)for(var i in e.showMobileCompany=!1,e.showMobileCarrier=!1,e.showMobilePhysical=!1,e.showLoginOptions=!1,e.activeSubMenu=null,menuUrls[loginTypes.Company].indexOf(currentUrl)>-1&&(e.showMobileCompany=!0),menuUrls[loginTypes.Physical].indexOf(currentUrl)>-1&&(e.showMobilePhysical=!0),menuUrls.carrierAndCompany.indexOf(currentUrl)>-1&&(e.showMobileCarrier=!0),Object.keys(menuUrls).indexOf(currentUrl)>-1&&(e.activeSubMenu=currentUrl),menuUrlsSecondLevel){menuUrlsSecondLevel[i].filter((function(e){return null!=e.url})).map((function(e){return e.url})).indexOf(currentUrl)>-1&&(e.activeSubMenu=i)}else e.activeSubMenu=null},e.isActiveMenuItem=function(e,r){var i;return!!((i=r?menuUrls[e]:menuUrls[e].filter((function(e){return null!=e.url})).map((function(e){return e.url})))&&i.indexOf(currentUrl)>-1)}}]),function(){var e,r;myApp.controller("authorizationCtrl",["$scope","$filter","$timeout","$compile",function(i,o,n,s){i.debug=!1,i.isNullOrWhiteSpace=isNullOrWhiteSpace,i.smsTimeout=Global.SMSTimeout,i.emptyPhoneError="Введите номер мобильного телефона",i.wrongFormatPhoneError="Введен некорректный номер мобильного телефона",i.emptyEmailError=ErrorString.EmptyEmailError,i.wrongFormatEmailError=ErrorString.WrongFormatEmailError,i.emptyPasswordErrorLogin="Введите пароль",i.wrongFormatPasswordErrorLogin="Неверный формат пароля",i.registerBusinessError="",i.loginBusinessError="",i.recaptchaBusinessValid=!0,i.isPrivate=window.location.pathname.toLowerCase()!=i.loginUrls[i.loginTypes.Company],i.isRegistration=!0,i.phoneLoginPrivate="",i.isPhoneLoginPrivateValid=!1,i.isPhoneLoginPrivateFocused=!1,i.passwordLoginPrivate="",i.errorMessageLoginPrivate="",i.emailLoginBusiness="",i.isEmailLoginBusinessValid=!1,i.isEmailLoginBusinessFocused=!1,i.passwordLoginBusiness="",i.errorMessageLoginBusiness="",i.phoneRegistationPrivate="",i.isPhoneRegistationPrivateValid=!1,i.isPhoneRegistationPrivateFocused=!1,i.codeRegistationPrivate="",i.errorMessageRegistrationPrivate="",i.isSMSsentPrivate=!1,i.timeoutPrivate=0,i.emailRegistrationBusiness="",i.isEmailRegistrationBusinessValid=!1,i.isEmailRegistrationBusinessFocused=!1,i.phoneRegistrationBusiness="",i.isPhoneRegistrationBusinessValid=!1,i.isPhoneRegistrationBusinessFocused=!1,i.isSMSsentBusiness=!1,i.timeoutBusiness=0,i.fromShortForm=!1,i.debug&&(i.isPhoneRegistrationBusinessValid=!0,i.codeRegistrationBusinessInputEnabled=!0,i.isSMSsentBusiness=!0,i.codeRegistrationBusinessSent=!0,i.timeoutBusiness=29,i.phoneLoginPrivate="9779067856",i.codePrivateSent=!0,i.timeoutPrivate=29,i.isSMSsentPrivate=!0,i.codePrivateInputEnabled=!0),i.codeRegistrationBusiness="",i.errorMessageRegistrationBusiness="",i.createOrder=!1,i.url=window.location.pathname.toLowerCase(),i.pageType=loginUrls[i.url]||loginTypes.Physical,i.pageUrl="/",i.clearData=function(){i.codeRegistrationBusinessSent=!1,i.codeRegistrationBusinessInputEnabled=!1,i.phoneLoginPrivate="",i.isPhoneLoginPrivateValid=!1,i.passwordLoginPrivate="",i.emailLoginBusiness="",i.emailLoginErrorMessage="",i.isEmailLoginBusinessFocused=!1,i.isEmailLoginBusinessValid=!1,i.isPasswordLoginBusinessFocused=!1,i.isPasswordLoginBusinessValid=!1,i.passwordLoginBusiness="",i.passwordLoginBusinessErrorMessage="",i.loginBusinessError="",i.registerBusinessError="",i.codeRegistrationBusinessInputEnabled=!1,i.codePrivate="",i.codeRegistationPrivate="",i.isCodePrivateFocused=!1,i.isPhoneLoginPrivateFocused=!1,i.isPhoneRegistationPrivateValid=!1,i.phoneRegistationPrivate="",i.incorrectCodePrivate=!1,i.codeRegistrationBusiness="",i.codeRegistrationBusinessErrorMessage="",i.emailRegistrationBusiness="",i.emailRegistrationBusinessErrorMessage="",i.isCodeRegistrationBusinessValid=!1,i.isCodeRegistrationBusinessFocused=!1,i.isEmailRegistrationBusinessFocused=!1,i.isEmailRegistrationBusinessValid=!1,i.isPhoneRegistrationBusinessFocused=!1,i.isPhoneRegistrationBusinessValid=!1,i.phoneRegistrationBusiness="",i.phoneRegistrationBusinessErrorMessage="",i.clearErrors(),i.clearFocuses(),i.showSendMessage=!1,i.codePrivateSent=!1,i.phoneLoginPrivateErrorMessage="",i.timeoutPrivate=0,i.incorrectCodeBusiness=!1,i.recaptchaBusinessRendered=!1,i.recaptchaBusinessValid=!0,i.debug&&(i.isPhoneRegistrationBusinessValid=!0,i.codeRegistrationBusinessInputEnabled=!0,i.isSMSsentBusiness=!0,i.codeRegistrationBusinessSent=!0,i.timeoutBusiness=29,i.phoneLoginPrivate="9779067856",i.codePrivateSent=!0,i.timeoutPrivate=29,i.isSMSsentPrivate=!0,i.codePrivateInputEnabled=!0)},i.clearFocuses=function(){i.isPhoneLoginPrivateFocused=!1,i.isPhoneRegistrationBusinessFocused=!1,i.isPhoneRegistationPrivateFocused=!1,i.isEmailLoginBusinessFocused=!1,i.isEmailRegistrationBusinessFocused=!1},i.clearErrors=function(){i.errorMessageLoginPrivate="",i.errorMessageLoginBusiness="",i.errorMessageRegistrationPrivate="",i.errorMessageRegistrationBusiness=""},i.setRegistration=function(e){i.isRegistration=e,n((function(){i.isRegistration?(i.isPrivate?(i.phoneLoginPrivateInput.focus(),i.phoneLoginPrivate=i.phoneRegistationPrivate):(i.emailLoginBusinessInput.focus(),i.emailLoginBusiness=i.emailRegistrationBusiness),window.location.pathname.toLowerCase().indexOf("registration")<0&&!i.isPrivate&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/registration"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/registration"):history.pushState(null,null,"/registration"))):(i.isPrivate?(i.phoneRegistationPrivateInput.focus(),i.phoneRegistationPrivate=i.phoneLoginPrivate):(i.emailRegistrationBusinessInput.focus(),i.emailRegistrationBusiness=i.emailLoginBusiness),window.location.pathname.toLowerCase().indexOf("login")<0&&!i.isPrivate&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/login"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/login"):history.pushState(null,null,"/login"))),i.clearData()}),100)},i.showAuthorizationPopup=function(e){!i.authorizationPopup&&i.initAuthorizationPopup(),i.clearData(),e&&(i.isPrivate=e.isPrivate,i.fromShortForm=e.fromShortForm,i.isRegistration=e.isRegistration,i.createOrder=e.createOrder,i.runSubmitOrderCreate=e.runSubmitOrderCreate,i.showReview=e.showReview,i.orderNumber=e.orderNumber),addCaptcha(),i.authorizationPopup.show(),n((function(){!i.isPrivate&&e&&e.phone&&(i.phoneRegistrationBusiness=e.phone,i.onPhoneRegistrationBusinessChange()),i.isPrivate&&i.recaptchaPrivateRendered&&(i.recaptchaPrivateRendered=!1,i.recaptchaPrivate2Rendered=!1),i.isRegistration?i.isPrivate?i.phoneLoginPrivateInput.focus():i.emailLoginBusinessInput.focus():i.isPrivate?i.phoneRegistationPrivateInput.focus():i.emailRegistrationBusinessInput.focus()}),150)},i.hideAuthorizationPopup=function(){i.authorizationPopup.hide()},i.$on("showAuthorizationPopup",(function(e,r){i.showAuthorizationPopup(r)})),i.$on("hideAuthorizationPopup",(function(e,r){i.hideAuthorizationPopup(r)})),i.onPhoneLoginPrivateBlur=function(e){n((function(){i.phoneLoginPrivateErrorMessage="",i.isPhoneLoginPrivateFocused=!1,i.isPhoneLoginPrivateValid=validatePhone(i.phoneLoginPrivate),""!=i.phoneLoginPrivate&&(i.isPhoneLoginPrivateFocused=!i.isPhoneLoginPrivateValid),e&&!i.isPhoneLoginPrivateValid&&(""!=i.phoneLoginPrivate?i.phoneLoginPrivateErrorMessage=i.wrongFormatPhoneError:i.phoneLoginPrivateErrorMessage=i.emptyPhoneError),i.isPhoneLoginPrivateFocused=!i.isPhoneLoginPrivateValid}),1)},i.onEmailLoginBlur=function(e){n((function(){i.isEmailLoginBusinessFocused=!1,i.emailLoginErrorMessage="",i.isEmailLoginBusinessValid=validateEmail(i.emailLoginBusiness),e&&!i.isEmailLoginBusinessValid&&(""==i.emailLoginBusiness?i.emailLoginErrorMessage=i.emptyEmailError:i.emailLoginErrorMessage=i.wrongFormatEmailError),i.isEmailLoginBusinessFocused=!i.isEmailLoginBusinessValid}),1)},i.onPasswordLoginBusinessBlur=function(){n((function(){i.isPasswordLoginBusinessFocused=!1,i.passwordLoginBusinessErrorMessage="",i.passwordLoginBusiness=i.passwordLoginBusiness||"",i.isPasswordLoginBusinessValid=i.passwordLoginBusiness.length>4,i.isPasswordLoginBusinessValid||(""==i.passwordLoginBusiness?i.passwordLoginBusinessErrorMessage=i.emptyPasswordErrorLogin:i.passwordLoginBusinessErrorMessage=i.wrongFormatPasswordErrorLogin),i.isPasswordLoginBusinessFocused=!i.isPasswordLoginBusinessValid}),1)},i.onPhoneRegistrationPrivateChange=function(){n((function(){i.isPhoneRegistrationPrivateValid=validatePhone(i.phoneRegistrationPrivate)}),1)},i.onPhoneRegistationPrivateBlur=function(){n((function(){i.isPhoneRegistationPrivateFocused=!1,i.isPhoneRegistationPrivateValid=validatePhone(i.phoneRegistationPrivate),""!=i.phoneRegistationPrivate&&(i.isPhoneRegistationPrivateFocused=!i.isPhoneRegistationPrivateValid),i.isPhoneRegistationPrivateValid&&i.codeRegistationPrivateInput.focus()}),1)},i.onPhoneRegistrationBusinessChange=function(){n((function(){i.isPhoneRegistrationBusinessValid=validatePhone(i.phoneRegistrationBusiness)}),1)},i.onCodePrivateChange=function(){n((function(){i.codePrivate=clearNonNumeric(i.codePrivate),i.incorrectCodePrivate=!1}),1)},i.onCodePrivateBlur=function(e){n((function(){i.isCodePrivateValid=!0,i.isCodePrivateFocused=!1,i.errorMessageLoginPrivate="",(5!=i.codePrivate.length||i.incorrectCodePrivate)&&i.isPhoneLoginPrivateValid&&(i.isCodePrivateValid=!1,i.isCodePrivateFocused=!0,i.errorMessageLoginPrivate=i.incorrectCodePrivate?i.incorrectPasswordError:i.codePrivate?i.wrongFormatPasswordError:i.emptyPasswordError)}),1)},i.changeNumber=function(){i.codePrivateSent=!1,i.incorrectCodePrivate=!1,i.timeoutPrivate=0,i.isCodePrivateValid=!0,i.isCodePrivateFocused=!1,i.codePrivateSent=!1,i.codePrivate="",i.recaptchaPrivateRendered=!1,i.recaptchaPrivate2Rendered=!1},i.onCodeRegistrationBusinessChange=function(){n((function(){i.codeRegistrationBusiness=clearNonNumeric(i.codeRegistrationBusiness),i.incorrectCodeBusiness=!1}),1)},i.onCodeRegistrationBusinessBlur=function(){n((function(){i.isCodeRegistrationBusinessValid=!0,i.isCodeRegistrationBusinessFocused=!1,i.codeRegistrationBusinessErrorMessage="",!i.codeRegistrationBusinessInputEnabled&&i.isEmailRegistrationBusinessValid&&i.isPhoneRegistrationBusinessValid&&(i.codeRegistrationBusinessInputEnabled=!0),(5!=i.codeRegistrationBusiness.length||i.incorrectCodeBusiness)&&i.isPhoneRegistrationBusinessValid&&(i.isCodeRegistrationBusinessValid=!1,i.isCodeRegistrationBusinessFocused=!0,i.codeRegistrationBusinessErrorMessage=i.incorrectCodeBusiness?i.incorrectPasswordError:i.codeRegistrationBusiness?i.wrongFormatPasswordError:i.emptyPasswordError)}),1)},i.onPhoneRegistrationBusinessBlur=function(){n((function(){i.phoneRegistrationBusinessErrorMessage="",i.isPhoneRegistrationBusinessFocused=!1,i.isPhoneRegistrationBusinessValid=validatePhone(i.phoneRegistrationBusiness),i.isPhoneRegistrationBusinessValid&&i.codeRegistrationBusinessInput.focus(),""!=i.phoneRegistrationBusiness?i.phoneRegistrationBusinessErrorMessage=i.wrongFormatPhoneError:i.phoneRegistrationBusinessErrorMessage=i.emptyPhoneError,i.isPhoneRegistrationBusinessFocused=!i.isPhoneRegistrationBusinessValid}),1)},i.onEmailRegistrationBusinessBlur=function(e){n((function(){e=1==e,i.emailRegistrationBusinessErrorMessage="",i.isEmailRegistrationBusinessValid=!0,i.isEmailRegistrationBusinessFocused=!1,(i.emailRegistrationBusiness.indexOf("@@")>-1||e)&&(i.isEmailRegistrationBusinessValid=validateEmail(i.emailRegistrationBusiness),i.isEmailRegistrationBusinessValid||(i.isEmailRegistrationBusinessFocused=!0,""!=i.emailRegistrationBusiness?i.emailRegistrationBusinessErrorMessage=i.wrongFormatEmailError:i.emailRegistrationBusinessErrorMessage=i.emptyEmailError))}),1)},i.loginPrivate=function(e){if(console.log("loginPrivate"),i.onPhoneLoginPrivateBlur(!0),i.onCodePrivateBlur(!0),i.locked)return!1;i.locked=!0,n((function(){i.isPhoneLoginPrivateValid&&i.isCodePrivateValid?i.$emit("login",{login:clearPhone(i.phoneLoginPrivate),password:i.codePrivate,handleError:i.handleError,moveToPersonalArea:!0,createOrder:i.createOrder,pageType:loginTypes.Physical,onSuccess:i.onLoginSuccess.bind(null,!0)}):n((function(){i.isPhoneLoginPrivateFocused=!0,i.locked=!1}),10)}),10)},i.loginBusiness=function(e){console.log("loginBusiness"),i.onEmailLoginBlur(!0),i.onPasswordLoginBusinessBlur(),n((function(){i.isEmailLoginBusinessValid&&i.isPasswordLoginBusinessValid&&i.$emit("login",{login:i.emailLoginBusiness,password:i.passwordLoginBusiness,handleError:i.handleError,moveToPersonalArea:!0,createOrder:i.createOrder,runSubmitOrderCreate:i.runSubmitOrderCreate,showReview:i.showReview,orderNumber:i.orderNumber,pageType:loginTypes.Company})}),10)},i.onLoginSuccess=function(e){var r=e?"EnterRegPrivate":"BusinessGoRegisterForm",o=e?"RegPrivate":"BusinessGoRegister";i.addYandexMetric(i.fromShortForm?r:o)},i.registerBusiness=function(){i.onPhoneRegistrationBusinessChange(),i.onEmailRegistrationBusinessBlur(!0),i.onPhoneRegistrationBusinessBlur();var e=clearPhone(i.phoneRegistrationBusiness);i.isPhoneRegistrationBusinessValid&&i.isEmailRegistrationBusinessValid&&!i.codeRegistrationBusinessInputEnabled&&(i.showSendMessage=!0),i.codeRegistrationBusinessInputEnabled&&i.onCodeRegistrationBusinessBlur();var r={email:i.emailRegistrationBusiness,password:i.codeRegistrationBusiness,login:i.emailRegistrationBusiness,phone:e,PhoneConfirmationCode:i.codeRegistrationBusiness};validatePhone(e)||n((function(){i.isPhoneRegistrationBusinessFocused=!0}),10),validateEmail(i.emailRegistrationBusiness)||n((function(){i.isEmailRegistrationBusinessFocused=!0}),10),n((function(){i.isPhoneRegistrationBusinessValid&&i.isEmailRegistrationBusinessValid&&i.isCodeRegistrationBusinessValid&&i.register(r,customerType.Company,!0)}),100)},i.register=function(e,r,o,s){if(i.locked)return!1;i.locked=!0,i.showPreLoader=!0,n((function(){i.showPreLoader=!1}),1e4);var t="";try{ga.getAll().forEach((function(e){t=e.get("clientId"),console.log(t)}))}catch(e){}e=e||{};var a={addressJuridical:"",addressPhysical:"",addressPostal:"",bankAccount:"",bankBIK:"",bankCorrAccount:"",bankName:"",company:"",inn:"",innScan:"",kpp:"",ogrn:"",ogrnScan:"",rank:5,Type:r,UTMS:localStorage.utms,region:i.TRANSPORT_REGION_SUBDOMAIN};e.ga_Id=t,e.utms=getUTMS(),e.customerInfo=a,console.log(e),client.invokeApi("customer/create",{method:"post",contentType:"application/json",data:JSON.stringify(e)},!0).done((function(o){var s=o;e.id=s,localStorage.removeItem("utms");try{console.log("ga event registration customer"),dataLayer&&dataLayer.push({event:"gaevent",eventCategory:"login",eventAction:"registration_success"})}catch(e){}i.$emit("login",{login:e.login,password:e.password,handleError:i.handleError,moveToPersonalArea:!0,createOrder:i.createOrder,runSubmitOrderCreate:i.runSubmitOrderCreate,pageType:i.pageType,showReview:i.showReview,orderNumber:i.orderNumber,onSuccess:i.onLoginSuccess.bind(null,!1)}),r==customerType.Company&&i.hideAuthorizationPopup(),n((function(){i.locked=!1}),0)})).fail((function(r){if(client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},n((function(){i.showPreLoader=!1,i.locked=!1}),0),!s){var o=parseError(r);"Данный номер уже зарегистрирован"==o?n((function(){i.phoneLoginPrivate=e.login,i.onPhoneLoginPrivateBlur(),i.isPrivate=!0,i.isRegistration=!0,n((function(){i.passwordLoginPrivateInput.focus()}),200)}),1):"Выбранный почтовый ящик уже используется"==o?n((function(){i.emailLoginBusiness=e.login,i.onEmailLoginBlur(),i.isPrivate=!1,i.isRegistration=!0,n((function(){i.passwordLoginBusinessInput.focus()}),200)}),1):"Email уже используется"==o?n((function(){i.registerBusinessError=o,i.isEmailRegistrationBusinessValid=!1,i.isEmailRegistrationBusinessFocused=!0}),1):i.handleError(r)}}))},i.phoneIsEmpty=function(){return!(!i.isPrivate||!i.isRegistration||""!=i.phoneLoginPrivate)||(!(!i.isPrivate||i.isRegistration||""!=i.phoneRegistationPrivate)||!i.isPrivate&&!i.isRegistration&&""==i.phoneRegistrationBusiness)},i.sendCodeBusinessInternal=function(){n((function(){sendSMS({phone:i.phoneRegistrationBusiness,type:SMSType.Login},!0).done((function(){showToast({message:"На указанный номер телефона был отправлен смс-пароль",timeout:5e3}),n((function(){client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},i.recaptchaBusinessValid=!0,i.showSendMessage=!1,i.codeRegistrationBusinessSent=!0,i.codeRegistrationBusinessInputEnabled=!0,i.timeoutBusiness=i.smsTimeout,e&&clearInterval(e),r&&clearTimeout(r),e=setInterval((function(){n((function(){i.timeoutBusiness--}),0)}),1e3),r=setTimeout((function(){n((function(){i.codeRegistrationBusinessSent=!1}),0),clearInterval(e)}),1e3*i.smsTimeout)}),0)})).fail((function(){showError("При отправке сообщения произошла ошибка")}))}),0)},i.sendCodeRegistrationBusiness=function(){if(i.clearErrors(),i.phoneIsEmpty())return!1;if(!i.codeRegistrationBusinessSent&&i.isPhoneRegistrationBusinessValid){i.recaptchaBusinessRendered=!1,i.recaptchaBusinessValid=!1;var e=clearPhone(i.phoneRegistrationBusiness);i.addYandexMetric(i.fromShortForm?"CodeRequestForm":"CodeRequest"),client.invokeApi("User/CheckCodeRequest?phone="+e,{method:"post",contentType:"application/json"}).done((function(e){n((function(){e?i.sendCodeBusinessInternal():i.recaptchaBusinessRendered?grecaptcha.reset():(i.recaptchaBusinessRendered=!0,n((function(){grecaptcha.render("googleRecaptchaBusiness",{sitekey:Global.RecaptchaSiteKey,callback:i.sendCodeBusinessInternal,"error-callback":function(e){i.recaptchaBusinessValid=!1,console.log(e)}})}),1))}),1)}))}else i.onPhoneRegistrationBusinessBlur()},i.sendCodeInternal=function(){i.isSMSsentOC=!0,i.timeoutPrivate=i.smsTimeout,e&&clearInterval(e),r&&clearTimeout(r),sendSMS({phone:i.phoneLoginPrivate,type:SMSType.Login},!0).done((function(){n((function(){e=setInterval((function(){n((function(){i.timeoutPrivate--}),0)}),1e3),r=setTimeout((function(){n((function(){i.isSMSsentOC=!1,i.recaptchaPrivate2Rendered=!1}),0),clearInterval(e)}),1e3*i.smsTimeout),showToast({message:"На указанный номер телефона был отправлен смс-пароль",timeout:5e3}),client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},i.codePrivateSent=!0,i.codePrivateInputEnabled=!0}),1)})).fail((function(){showError("При отправке сообщения произошла ошибка")}))},i.sendCodePrivate=function(){i.onPhoneLoginPrivateBlur(!0),n((function(){if(i.isPhoneLoginPrivateValid){i.codePrivateSent?i.recaptchaPrivate2Rendered=!1:i.recaptchaPrivateRendered=!1;var e=clearPhone(i.phoneLoginPrivate);i.addYandexMetric(i.fromShortForm?"CodeSMSRequestPrivate":"CodeRequestPrivate"),client.invokeApi("User/CheckCodeRequest?phone="+e,{method:"post",contentType:"application/json"}).done((function(e){n((function(){e?i.sendCodeInternal():i.codePrivateSent?i.recaptchaPrivate2Rendered?grecaptcha.reset():(i.recaptchaPrivate2Rendered=!0,n((function(){grecaptcha.render("googleRecaptchaPrivate2",{sitekey:Global.RecaptchaSiteKey,callback:i.sendCodeInternal,"error-callback":function(e){console.log(e)}})}),1)):i.recaptchaPrivateRendered?grecaptcha.reset():(i.recaptchaPrivateRendered=!0,n((function(){grecaptcha.render("googleRecaptchaPrivate",{sitekey:Global.RecaptchaSiteKey,callback:i.sendCodeInternal,"error-callback":function(e){console.log(e)}})}),1))}),1)}))}}),100)},i.handleError=function(e){n((function(){if(i.showPreLoader=!1,i.locked=!1,i.clearErrors(),i.isPrivate)"Неправильный логин или пароль"==parseError(e)?(i.incorrectCodePrivate=!0,i.onCodePrivateBlur()):handleError(e);else if(i.isRegistration){"Неверный код подтверждения"==parseError(e)?(i.incorrectCodeBusiness=!0,i.onCodeRegistrationBusinessBlur()):handleError(e)}else i.isRegistration||(i.loginBusinessError=parseError(e),i.isPasswordLoginBusinessFocused=!0,i.isEmailLoginBusinessFocused=!0)}),1)},i.showForgotPasswordNewPopup=function(e){var r={isPrivate:e};r.login=e?clearPhone(i.phoneLoginPrivate):i.emailLoginBusiness,i.hideAuthorizationPopup(),i.$emit("mainShowForgotPasswordNewPopup",r)},i.authorizationPopup=void 0,i.initAuthorizationPopup=function(){i.authorizationPopup=modalWindow("#customer-auth-popup","auth-popup customer-auth-popup register-driver-popup",{clickBgClose:function(){return window.innerWidth>i.maxMobile},onShow:function(){i.isPrivate||(i.pageUrl=window.location.pathname,i.isRegistration?window.location.pathname.toLowerCase().indexOf("registration")<0&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/registration"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/registration"):history.pushState(null,null,"/registration")):window.location.pathname.toLowerCase().indexOf("login")<0&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/login"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/login"):history.pushState(null,null,"/login")))},onClose:function(){i.isPrivate||(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads"):history.pushState(null,null,"/")),i.$emit("mainAuthPopupClose")}})},i.initPopup=function(){n((function(){!i.authorizationPopup&&i.initAuthorizationPopup(),i.phoneLoginPrivateInput=$("#phoneLoginPrivate"),i.emailLoginBusinessInput=$("#emailLoginBusiness"),i.passwordBusinessInput=$("#passwordBusiness"),i.phoneRegistationPrivateInput=$("#phoneRegistationPrivate"),i.emailRegistrationBusinessInput=$("#emailRegistrationBusiness"),i.codeRegistationPrivateInput=$("#codeRegistationPrivate"),i.codeRegistrationBusinessInput=$("#codeRegistrationBusiness"),i.passwordLoginPrivateInput=$("#passwordLoginPrivate"),i.passwordLoginBusinessInput=$("#passwordLoginBusiness")}),200)},i.initPopup()}])}(),function(){var e,r;myApp.controller("registerDriverCtrl",["$scope","$filter","$timeout","$compile",function(i,o,n,s){i.isNullOrWhiteSpace=isNullOrWhiteSpace,i.smsTimeout=Global.SMSTimeout,i.isAuth=!1,i.remember=!0,i.emptyPhoneError="Введите номер мобильного телефона",i.wrongFormatPhoneError="Введен некорректный номер мобильного телефона",i.emptyEmailError=ErrorString.EmptyEmailError,i.wrongFormatEmailError=ErrorString.WrongFormatEmailError,i.incorrectCode=!1,i.connectionError="",i.email="",i.name="",i.phone="",i.code="",i.recaptchaCarrierValid=!0,i.timeoutP=0,i.emailLogin="",i.password="",i.isEmailValid=!1,i.isPhoneValid=!1,i.isEmailLoginValid=!1,i.isPasswordLoginValid=!1,i.isPasswordLoginFocused=!1,i.isCodeValid=!1,i.isEmailFocused=!1,i.isPhoneFocused=!1,i.isEmailLoginFocused=!1,i.isCodeFocused=!1,i.codeSent=!1,i.codeInputEnabled=!1,i.password="",i.errorMessage="",i.errorMessage="",i.emailErrorMessage="",i.emailLoginErrorMessage="",i.phoneErrorMessage="",i.codeErrorMessage="",i.url=window.location.pathname.toLowerCase(),i.pageType=loginUrls[i.url]||loginTypes.Company,i.clearData=function(){i.codeSent=!1,i.codeInputEnabled=!1,i.showSendMessage=!1,i.isAuth=!1,i.email="",i.name="",i.phone="",i.code="",i.emailLogin="",i.password="",i.isEmailValid=!1,i.isPhoneValid=!1,i.isEmailLoginValid=!1,i.isPasswordLoginValid=!1,i.isCodeValid=!1,i.isCodeFocused=!1,i.isEmailFocused=!1,i.isPhoneFocused=!1,i.isEmailLoginFocused=!1,i.isPasswordLoginFocused=!1,i.recaptchaCarrierRendered=!1,i.recaptchaBusinessRendered=!1,i.recaptchaCarrierValid=!0,i.recaptchaBusinessValid=!0,i.clearErrors()},i.clearErrors=function(){i.errorMessage="",i.connectionError="",i.emailErrorMessage="",i.phoneErrorMessage="",i.emailLoginErrorMessage="",i.codeErrorMessage="",i.incorrectCode=""},i.registerDriverPopup=void 0,i.initRegisterDriverElement=function(){i.registerDriverPopup=modalWindow("#regdriver-popup-cont","auth-popup register-driver-popup",{clickBgClose:function(){return window.innerWidth>i.maxMobile},onShow:function(){},onClose:function(){}})},n((function(){if(!i.registerDriverPopup&&i.initRegisterDriverElement(),isMobile){var e=document.getElementById("carrier-code"),r=document.querySelector(".register-driver-popup .mw-container");e.addEventListener("focus",(function(){var e=document.querySelector(".register-driver-popup  .mw-show .mws-content");null!=e&&setTimeout((function(){document.body.classList.add("input-number-pass-focus"),document.querySelector("html").classList.contains("ios")||(r.style.height=window.innerHeight+150+"px",e.scrollTop=150)}),150)})),e.addEventListener("blur",(function(){r.style.height="auto"})),document.addEventListener("click",(function(){"carrier-code"!=event.target.id&&e.blur()}))}}),200),i.showRegisterDriverPopup=function(e){!i.registerDriverPopup&&i.initRegisterDriverElement(),i.clearData(),addCaptcha(),e=e||{},i.isAuth=1==e.isAuth,i.pageType=e.pageType||i.pageType,i.registerDriverPopup.show()},i.hideRegisterDriverPopup=function(){i.registerDriverPopup.close()},i.$on("showRegisterDriverPopup",(function(e,r){i.showRegisterDriverPopup(r)})),i.setAuth=function(e){n((function(){var r=i.code,o=i.email;i.clearData(),i.isAuth=e,1==i.isAuth&&(i.emailLogin=o,i.password=r,i.emailLogin&&""!=i.emailLogin&&i.onEmailLoginBlur())}),0)},i.rememberclick=function(){i.remember=!i.remember},i.onPhoneChange=function(){n((function(){i.phoneErrorMessage="",i.isPhoneValid=validatePhone(i.phone),i.isPhoneFocused=!1,i.isPhoneValid||(i.isPhoneFocused=!0,""!=i.phone?i.phoneErrorMessage=i.wrongFormatPhoneError:i.phoneErrorMessage=i.emptyPhoneError)}),1)},i.checkFullPhone=function(){n((function(){i.isPhoneValid=validatePhone(i.phone)}),1)},i.onCodeChange=function(){i.code&&(i.code=i.code.replace(/[^0-9]/g,"")),i.incorrectCode=!1},i.onCodeBlur=function(){n((function(){i.isCodeValid=!0,i.isCodeFocused=!1,i.codeErrorMessage="",i.codeInputEnabled&&(5!=i.code.length||i.incorrectCode)&&i.isPhoneValid&&(i.isCodeValid=!1,i.isCodeFocused=!0,i.codeErrorMessage=i.incorrectCode?i.incorrectPasswordError:i.code?i.wrongFormatPasswordError:i.emptyPasswordError)}),1)},i.onEmailChange=function(e){n((function(){e=1==e,i.emailErrorMessage="",i.isEmailValid=!0,i.isEmailFocused=!1,(i.email.indexOf("@@")>-1||e)&&(i.isEmailValid=validateEmail(i.email),i.isEmailValid||(i.isEmailFocused=!0,""!=i.email?i.emailErrorMessage=i.wrongFormatEmailError:i.emailErrorMessage=i.emptyEmailError))}),1)},i.onEmailLoginChange=function(){n((function(){i.emailLoginErrorMessage="",i.isEmailLoginFocused=!1}),1)},i.onEmailLoginBlur=function(e){n((function(){i.emailLoginErrorMessage="",i.isEmailLoginFocused=!1,(i.emailLogin.indexOf("@@")>-1||e)&&(i.isEmailLoginValid=validateEmail(i.emailLogin),i.isEmailLoginValid||(i.isEmailLoginFocused=!0,""!=i.emailLogin?i.emailLoginErrorMessage=i.wrongFormatEmailError:i.emailLoginErrorMessage=i.emptyEmailError))}),1)},i.passwordLoginErrorMessage="",i.onPasswordLoginBlur=function(){n((function(){i.passwordLoginErrorMessage="",i.isPasswordLoginValid=!0,null!=i.password&&""!=i.password||(i.isPasswordLoginValid=!1,i.passwordLoginErrorMessage="Введите пароль"),i.isPasswordLoginFocused=!i.isPasswordLoginValid}),1)},i.registerDriver=function(){i.pageType==loginTypes.Carrier&&i.addYandexMetric("DriverRegStep0"),i.onEmailChange(!0),i.onPhoneChange(),i.isEmailValid&&i.isPhoneValid&&!i.codeInputEnabled&&(i.showSendMessage=!0),i.codeInputEnabled&&i.onCodeBlur(),n((function(){i.isEmailValid&&i.isPhoneValid&&i.isCodeValid&&i.register()}),100)},i.register=function(){if(i.locked)return!1;i.locked=!0;var e="";try{ga.getAll().forEach((function(r){e=r.get("clientId"),console.log(e)}))}catch(e){}var r=clearPhone(i.phone),o={email:i.email,password:i.code,name:"",login:i.email,phone:r,PhoneConfirmationCode:i.code};o=o||{};var s=transportRegion.MO;i.TRANSPORT_REGION_SUBDOMAIN==transportRegion.LO?s=transportRegion.LO:i.TRANSPORT_REGION_SUBDOMAIN==transportRegion.NO&&(s=transportRegion.NO);var t={addressJuridical:"",addressPhysical:"",addressPostal:"",bankAccount:"",bankBIK:"",bankCorrAccount:"",bankName:"",company:"",inn:"",innScan:"",kpp:"",ogrn:"",ogrnScan:"",rank:5,region:s,type:i.pageType==loginTypes.CarrierCompany?carrierType.Company:carrierType.Driver};o.ga_Id=e,o.driverInfo=o.carrierInfo=t,o.utms=getUTMS(),n((function(){i.isEmailValid&&i.isPhoneValid&&i.isCodeValid?client.invokeApi("carrier/Create",{method:"post",contentType:"application/json",data:JSON.stringify(o)},!0).done((function(e){i.emailLogin=i.email,i.password=i.code,i.isEmailLoginValid=!0,i.locked=!1;try{console.log("ga event registration carrier"),dataLayer&&dataLayer.push({event:"gaevent",eventCategory:"login",eventAction:"registration_success"})}catch(e){}i.login(),i.hideRegisterDriverPopup()})).fail((function(e){i.locked=!1,"Неверный код подтверждения"==parseError(e)?(i.incorrectCode=!0,i.onCodeBlur()):handleError(e)})):i.locked=!1}),100)},i.sendSmsCodeIntenal=function(){n((function(){i.recaptchaCarrierValid=!0,sendSMS({phone:i.phone,type:SMSType.Login}),client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},i.showSendMessage=!1,i.codeSent=!0,i.codeInputEnabled=!0,n((function(){$("#carrier-code").focus()}),200),e&&clearInterval(e),r&&clearTimeout(r),i.timeoutP=i.smsTimeout,e=setInterval((function(){n((function(){i.timeoutP--}),0)}),1e3),r=setTimeout((function(){n((function(){i.codeSent=!1}),0),clearInterval(e)}),1e3*i.smsTimeout)}),0)},i.sendCode=function(){if(i.pageType==loginTypes.Carrier&&i.addYandexMetric("CodeRequestDriver"),i.isPhoneValid){i.recaptchaCarrierRendered=!1,i.recaptchaCarrierValid=!1;var e=clearPhone(i.phone);client.invokeApi("User/CheckCodeRequest?phone="+e,{method:"post",contentType:"application/json"}).done((function(e){n((function(){e?i.sendSmsCodeIntenal():i.recaptchaCarrierRendered?grecaptcha.reset():(i.recaptchaCarrierRendered=!0,n((function(){grecaptcha.render("googleRecaptchaCarrier",{sitekey:Global.RecaptchaSiteKey,callback:i.sendSmsCodeIntenal,"error-callback":function(e){i.recaptchaCarrierValid=!1,console.log(e)}})}),1))}),1)}))}},i.showForgotPasswordNewPopup=function(){var e={login:i.emailLogin};i.hideRegisterDriverPopup(),i.$emit("mainShowForgotPasswordNewPopup",e)},i.login=function(){i.onEmailLoginBlur(!0),i.onPasswordLoginBlur(),n((function(){i.isEmailLoginValid&&i.isPasswordLoginValid&&i.$emit("login",{login:i.emailLogin,password:i.password,handleError:i.handleError,moveToPersonalArea:!0,pageType:i.pageType})}),100)},i.handleError=function(e){n((function(){i.connectionError=parseError(e),"5"!=e.status.toString()[0]&&("Email уже используется"==i.connectionError?(i.isEmailFocused=!0,i.isEmailValid=!1):(i.isPasswordLoginFocused=i.isEmailLoginFocused=i.isCodeFocused=!0,i.isPasswordLoginValid=i.isEmailLoginValid=i.isCodeValid=!1))}),1),n((function(){$(".popup-container-new.registration").css("height",634+$(".registration-error").height())}),100)}}])}(),myApp.controller("forgotPasswordNewCtrl",["$scope","$filter","$timeout","$compile",function(e,r,i,o){e.isNullOrWhiteSpace=isNullOrWhiteSpace,e.emptyEmailError=ErrorString.EmptyEmailError,e.wrongFormatEmailError=ErrorString.WrongFormatEmailError,e.sent=!1,e.email="",e.isEmailFocused=!1,e.isEmailValid=!1,e.brokenRepairPassLink=!1,e.errorMessage="",e.clearData=function(){e.email="",e.isEmailFocused=!1,e.isEmailValid=!1,e.sent=!1,e.errorMessage="",e.connectionError=""},i((function(){e.forgotPasswordNewPopup=modalWindow("#forgot-password-new","auth-popup forgot-password-popup",{clickBgClose:function(){return window.innerWidth>e.maxMobile},onClose:function(){e.brokenRepairPassLink&&(window.location.href=window.location.origin+"/",setTimeout((function(){document.location.href="/"}),20))}}),e.emailInput=$("#email-input-new")}),0),e.setAuthType=function(r){e.isPrivate=r},e.showForgotPasswordNewPopup=function(r){(r=r||{}).login=r.login||"",e.isStepsPage=r.steps,e.restoreText=e.isStepsPage?"аккаунта":"пароля",e.restoreButtonText=e.isStepsPage?"аккаунт":"пароль",1!=r.isPrivate&&(r.isPrivate=!1),e.brokenRepairPassLink=!0===r.brokenRepairPassLink,e.clearData(),i((function(){e.email=""+r.login,r.login&&e.onEmailChange()}),1),e.forgotPasswordNewPopup.show(),e.emailInput.focus(),console.log("forgot popup is visible")},e.hideForgotPasswordNewPopup=function(){e.forgotPasswordNewPopup.close()},e.$on("showForgotPasswordNewPopup",(function(r,i){e.clearData(),e.showForgotPasswordNewPopup(i)})),e.onEmailChange=function(){i((function(){e.errorMessage="",e.connectionError="",e.isEmailValid=validateEmail(e.email),e.isEmailValid||(""!=e.email?e.errorMessage=e.wrongFormatEmailError:e.errorMessage=e.emptyEmailError)}),1)},e.onEmailBlur=function(r){i((function(){e.errorMessage="",e.isEmailFocused=!1,(e.email.indexOf("@@")>-1||r)&&(e.isEmailValid=validateEmail(e.email),e.isEmailValid||(e.isEmailFocused=!0,""!=e.email?e.errorMessage=e.wrongFormatEmailError:e.errorMessage=e.emptyEmailError))}),1)},e.remembered=function(){e.hideForgotPasswordNewPopup(),e.$emit("rememberedCarrierPassword")},e.startTimer=function(){e.counter=30,e.showCounter=!0;var r=setInterval((function(){i((function(){e.counter--,0==e.counter&&(clearInterval(r),e.showCounter=!1)}),0)}),1e3)},e.forgot=function(){e.isEmailValid?(login=e.email,localStorage.third=btoa(login),client.invokeApi("User/ForgotUserPassword",{method:"post",parameters:{login:login}}).done((function(){i((function(){e.sent=!0,e.startTimer()}),1)})).fail((function(r){e.handleError(r)}))):(e.onEmailChange(),i((function(){e.isEmailFocused=!0}),10))},e.sendCode=function(){e.isPrivate&&(e.isPhoneValid?client.invokeApi("User/ForgotUserPassword",{method:"post",parameters:{login:clearPhone(e.phone)}}).done((function(){})).fail((function(r){e.errorMessage=parseError(r)})):e.errorMessage="Введен неверный номер телефона"),console.log("send code")},e.handleError=function(r){i((function(){e.connectionError=parseError(r),"5"!=r.status.toString()[0]?(e.isEmailFocused=!0,e.isEmailValid=!1):e.sentError=!0}),1)}}]);