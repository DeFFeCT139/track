var setTime,showDeficitPopup,showDiscountPopup,showRecallPopup,getOrderTime,showUrgentPopup;function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);r&&(i=i.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),o.push.apply(o,i)}return o}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(o),!0).forEach((function(r){_defineProperty(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}function _defineProperty(e,r,o){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function _toPropertyKey(e){var r=_toPrimitive(e,"string");return"symbol"===_typeof(r)?r:String(r)}function _toPrimitive(e,r){if("object"!==_typeof(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,r||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,r):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var o=0,i=new Array(r);o<r;o++)i[o]=e[o];return i}function ownKeys(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);r&&(i=i.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),o.push.apply(o,i)}return o}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(o),!0).forEach((function(r){_defineProperty(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}function _defineProperty(e,r,o){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function _toPropertyKey(e){var r=_toPrimitive(e,"string");return"symbol"===_typeof(r)?r:String(r)}function _toPrimitive(e,r){if("object"!==_typeof(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,r||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}$("html").addClass("companies personal-page"),myApp.controller("companiesPhysicCtrl",["$scope","$filter","$timeout","$compile",function(e,r,o,i){e.currentOrder={isNight:isNight(),status:orderStatus.Search,loaders:0,forwardingPrice:0,forwarding:!1,roadPrice:0,passengers:0},e.bodyTypesFilters=bodyTypesFilters,e.bodyTypes=bodyTypes,e.registrationStageTypes=registrationStageTypes,e.parentalInfo={},e.physicPage=!0,e.Math=Math,e.parentalInfo.selectedTruckModelIndex=0,e.showBreadCrumb.text="Грузовое такси",e.transportRegion=transportRegion,e.tariffType=tariffType,e.selectedTariffTypeValue=e.tariffType.NoNDS,e.formatMinPrice=formatMinPrice,e.formatMinutePrice=formatMinutePrice,e.tonsCasesArray=["тонна","тонны","тонн"],e.formatLabel=formatLabel,e.tariffChoices=tariffChoices,e.selectedSection=e.tariffChoices.Small,e.tariffChoicesMobileArray=[{value:tariffChoices.Small,name:"до 3 т"},{value:tariffChoices.Big,name:"от 5 до 20 т"},{value:tariffChoices.Gidro,name:"Гидроборт"},{value:tariffChoices.Refrigerator,name:"Рефрижератор"}],e.myTariffItems=[],e.tariffTruckMessages=["Подходит для перевозки вещей, велосипеда, бытовой техники или автозапчастей.","Подходит для перевозки бытовой техники, кресла, небольшого дивана и полуторного матраса.","Перевезет крупногабаритную мебель, шкаф, диван, двухспальную кровать и холодильник.","Подходит для перевозки вещей, бытовой техники, небольшого дивана и полуторного матраса.","Классический вариант для переезда 1-комнатной квартиры и перевозки холодильника.","Для переезда 2-комнатной квартиры и перевозки крупногабаритной мебели.","Подходит для перевозки дверей, напольных покрытий, сухих смесей, канистр, плитки, радиаторов.","Подходит для перевозки листовых материалов, столярных изделий и других среднегабаритных грузов.","Подходит для длинномерных грузов и строительных блоков с возможностью боковой и верхней загрузки."],e.previewPopularConfig={arrows:!1,infinite:!1,dots:!0,slidesToShow:3,slidesToScroll:3,variableWidth:!0,responsive:[{breakpoint:750,settings:{slidesToShow:1,centerMode:!0}}]},e.previewPopularConfigNew={arrows:!1,infinite:!1,dots:!0,slidesToShow:4,slidesToScroll:4,variableWidth:!0,responsive:[{breakpoint:1e3,settings:{slidesToShow:3,slidesToScroll:1}},{breakpoint:750,settings:{slidesToShow:1,centerMode:!0}}]},e.isTabletSize=!1,e.isMobileSize=!1,$(window).resize((function(){$(window).trigger("window:resize")})),e.onResize=function(r){e.isMobileSize=window.innerWidth<=e.maxMobile,e.isTabletSize=window.innerWidth<=e.maxTablet},e.onResize(),$(window).on("window:resize",(function(r){e.onResize()})),e.showTariffTrucks=function(r){e.showGallery=!1,o((function(){e.showGallery=!0}),0),e.selectedSection=r,e.selectedSectionText=0,e.selectedSection==tariffChoices.Flat&&(e.selectedSectionText=1),e.selectedSection==tariffChoices.Materials&&(e.selectedSectionText=2),e.updateTariffCarousel(r)},e.updateTariffCarousel=function(r){e.showGallery=!1,e.myTariffItems=[];var i=e.TRANSPORT_REGION_SUBDOMAIN,t=r==tariffChoices.Refrigerator;$.each(e.truckModels,(function(o,n){(n.section&r)==r&&n.region==i&&t==n.isRefrigerator&&e.myTariffItems.push({tariff:e.allTariffs.filter((function(r){return r.truckModel_Id==n.id&&r.type==e.tariffType.NoNDS}))[0],truckModel:n,picIndex:n.picIndex})})),e.myTariffItems.sort((function(e,r){return e.truckModel.capacity>r.truckModel.capacity?1:e.truckModel.capacity<r.truckModel.capacity?-1:e.truckModel.volumeMin>=r.truckModel.volumeMin?1:-1})),o((function(){e.showGallery=!0}),1)},e.isNight=isNight(),e.getMinPrice=function(r){switch(e.selectedSection){case e.tariffChoices.Gidro:return formatMinPrice(r.tariff.minTime,r,e.isNight)+r.tariff.cargoLiftCost;case e.tariffChoices.Refrigerator:return formatMinPrice(r.tariff.minTime,r,e.isNight)+r.tariff.refrigeratorCost;default:return formatMinPrice(r.tariff.minTime,r,e.isNight)}},e.selectPhysicTruckTariffs=function(){e.tariffItemsDrop=[],$.each(e.truckModelsDrop,(function(r,o){o.bodyHeightMin=Math.round(100*o.bodyHeightMin)/100,o.bodyLengthMin=Math.round(100*o.bodyLengthMin)/100,o.bodyWidthMin=Math.round(100*o.bodyWidthMin)/100,e.tariffItemsDrop.push({tariff:e.allTariffs.filter((function(r){return r.truckModel_Id==o.id&&r.type==e.selectedTariffTypeValue}))[0],truckModel:o,index:r})})),e.truckModel=e.tariffItemsDrop[e.parentalInfo.selectedTruckModelIndex],e.currentOrder.time=e.truckModel.tariff.minTime,console.log("gruzovoe-taxi")},e.scrollToCreateOrder=function(r){r&&(r.tariff.cargoLiftCost=0,e.$broadcast("selectTruck",r)),e.isMobileSize?e.$broadcast("toggleMobileCalc",!0):($("html, body").animate({scrollTop:0},500),e.$broadcast("toggleRightPart"))},e.orderTruckTariffs=function(r){e.companyRegistrationState==registrationStageTypes.none?e.scrollToCreateOrder(r):e.headerAuthClick({toCreateOrderPage:!0,isRegistration:!0,isPrivate:!0})},$.when.apply($,[Controller.GetTruckModels("isFiltered=false"),Controller.GetAllTariffs()]).then((function(r,i){var t=e.TRANSPORT_REGION_SUBDOMAIN;e.allTariffs=i,e.truckModels=r.filter((function(e){return e.capacity<=5&&e.volumeMin<=35})),e.truckModelsDrop=r.filter((function(e){return e.region==t&&e.capacity<=5&&e.volumeMin<=35})).sort((function(e,r){return e.capacity>r.capacity?1:e.capacity<r.capacity?-1:e.volumeMin>r.volumeMin?1:e.volumeMin<r.volumeMin?-1:e.isRefrigerator&&!r.isRefrigerator?1:!e.isRefrigerator&&r.isRefrigerator?-1:void 0})),e.selectPhysicTruckTariffs(),e.myTariffItems=[],"/gruzovoe-taxi"==location.pathname.toLowerCase()?e.showTariffTrucks(e.tariffChoices.Furniture):e.showTariffTrucks(e.tariffChoices.Small),e.$broadcast("selectTruck",e.truckModel),o((function(){e.showGallery=!0}),0)}))}]),myApp.controller("companiesNewCalcController",["$scope","$filter","$timeout","$compile",function(e,r,o,i){var t,n,a="HighDemand",s="HighDemandRef";e.highDemand={enabled:!1},e.timeOffset=Global.DefaultTimezoneBias,e.serverTime=new Date,e.orderStatus=orderStatus,e.getAprEqualSign=getAprEqualSign,e.tariffType=tariffType,e.fc=formatWithCoefficient,e.emptyPhoneError="Введите номер мобильного телефона",e.wrongFormatPhoneError="Введен некорректный номер мобильного телефона",e.previousSentPhone="",e.addonsSettings={},e.preActiveBodyType=e.activeBodyType=bodyTypes.AnyCovered,e.isHoliday=!1,e.priceFirstTime=!1,e.prrTime=0,e.region=e.TRANSPORT_REGION_SUBDOMAIN,e.needToUpdatePrice=!0,e.minTime=0,e.maxPointsCount=e.mpc=10,e.currentOrder={isNight:isNight(),status:orderStatus.Search,forwardingPrice:0,forwarding:!1,roadPrice:0,insideMKADDistanceCounted:!0},e.notNeededText="Не требуются",e.formatLabel=formatLabel,e.addressesCasesArray=["адрес","адреса","адресов"],e.truckBodyTypesArray=[{Value:9,Name:"Любой крытый"},{Value:2,Name:"Фургон"},{Value:1,Name:"Тент"},{Value:4,Name:"Изотерм"},{Value:5,Name:"Рефрижератор"},{Value:7,Name:"Борт"}],e.isTEO=function(){return e.currentCustomer&&!e.physicPage&&(e.currentCustomer.contractType==customerContractType.CompanyTEO||e.currentCustomer.contractType==customerContractType.DirectContractTEO)},e.setOrderParams=function(r,o){r=setOrderDefaultParams(r);for(var i=[],t=0;t<e.parentalInfo.points.length;t++)e.parentalInfo.points[t].address&&i.push({address:e.parentalInfo.points[t].address,fullAddress:e.parentalInfo.points[t].fullAddress,contactName:e.parentalInfo.points[t].name,contactPhone:"",drivingDirection:null,storageDrivingDirection:null,latitude:e.parentalInfo.points[t].latitude||0,longitude:e.parentalInfo.points[t].longitude||0,num:t+1,type:t==e.parentalInfo.points.length-1?pointType.Load:pointType.UnLoad,id:newGuid(),templateRoutePoint_Id:null});r.routePoints=i,r.loaders=e.currentOrder.loaders,r.plannedPrice=e.route.price,r.startTimePlan=e.getOrderTime(),r.status=e.currentOrder.status,r.isReturn=!1,r.time=e.currentOrder.time,r.paymentMethod=paymentMethod.PrivateAccount,e.physicPage&&(r.paymentMethod=paymentMethod.Cash),r.photo=null,r.customer_Id=r.customerUser_Id=newGuid(),r.nds=e.tariffType.NoNDS,r.shippingDocumentsState=e.currentOrder.shippingDocumentsState,r.hasInsurance=e.currentOrder.insuranceAcceptance,r.mailReturnAddress="",r.mailReturnName="",r.mailReturnPhone="",r.declaredValue="",r.mailReturnAdditionalPhone="",r.minTime=e.minTime,r.isRentalMode=!1;var n=e.shortTruckModelsArray[e.truckModel.truckModel.id];return r.cargoLift=n.cargoLift,r.cargoVolume="",r.cargoWeight="",r.temperatureMin="",r.temperatureMax="",r.bodyType=bodyTypes.AnyCovered,e.isAuthorized&&e.currentCustomer&&e.currentCustomer.type==customerType.Company&&(r.mailReturnAddress="".concat(e.currentCustomer.returnPostalCode?e.currentCustomer.returnPostalCode+", ":"").concat(e.currentCustomer.returnAddress||""),r.mailReturnName=e.currentCustomer.returnName,r.mailReturnPhone=e.currentCustomer.returnPhone,r.mailReturnAdditionalPhone=e.currentCustomer.returnPhoneExtension),e.isAuthorized&&e.currentCustomer&&e.currentCustomer.type==customerType.Physical&&(r.paymentMethod=paymentMethod.Cash),o&&(r.forwarding=e.addonsSettings.forwarding,r.tariff_Id=e.truckModel.tariff.id,e.physicPage||(r.bodyType=e.truckBodyTypesArray[e.parentalInfo.selectedTruckBodyIndex].Value),r.cargoVolume=n.volume,r.cargoWeight=1e3*n.capacity),r.source=orderSource.WebMainPage,r.passengers=e.currentOrder.passengers,r.highDemandCoefficient=e.currentOrder.highDemandCoefficient,r},e.$on("submitOrderCreate",(function(r,o){e.submit(o)})),e.submit=function(r){e.checkFields()&&(r=r||e.setOrderParams({}),e.physicPage?(e.o=e.order=r,!e.currentCustomer||e.currentCustomer.type==customerType.Company&&e.physicPage?(localStorage.savedOrder=JSON.stringify(r),e.addYandexMetric("ClickZakazAvto"),e.headerAuthClick({isPrivate:!0,isRegistration:!0,createOrder:!0,runSubmitOrderCreate:!1,fromShortForm:!0})):e.createOrder(r)):e.businessPage&&(null==e.currentCustomer||null==e.currentUser||e.currentCarrier||e.currentCustomer.confirmStatus==customerConfirmStatus.New||(e.currentUser.type==userTypes.SuperCustomer||e.currentUser.type==userTypes.Customer)&&e.currentCustomer.type!=customerType.Company?(localStorage.savedOrder=JSON.stringify(r),e.addYandexMetric("ClickOrderBusinessForm"),e.headerAuthClick({isPrivate:!1,isRegistration:!0,createOrder:!0,runSubmitOrderCreate:!1,fromShortForm:!0})):e.createOrder(r)))},e.onPhoneChange=function(r){o((function(){e.isPhoneValid=e.phone&&validatePhone(e.phone),r&&(e.isPhoneFocused=!e.isPhoneValid,e.phoneErrorMessage=e.isPhoneValid?"":""!=e.phone?e.wrongFormatPhoneError:e.emptyPhoneError)}),0)},e.shortTruckModelsArray={0:{capacity:1,cargoLift:!1,volume:7,bodyType:bodyTypes.AnyCovered,bodyTypeString:" любой крытый"},1:{capacity:1.5,cargoLift:!1,volume:10,bodyType:bodyTypes.AnyCovered,bodyTypeString:" любой крытый"},2:{capacity:2,cargoLift:!1,volume:16,bodyType:bodyTypes.AnyCovered,bodyTypeString:" любой крытый"},3:{capacity:3,cargoLift:!1,volume:20,bodyType:bodyTypes.AnyCovered,bodyTypeString:" любой крытый"},4:{capacity:5,cargoLift:!1,volume:25,bodyType:bodyTypes.AnyCovered,bodyTypeString:" любой крытый"},5:{capacity:5,cargoLift:!1,volume:35,bodyType:bodyTypes.AnyCovered,bodyTypeString:" любой крытый"},6:{capacity:10,cargoLift:!1,volume:45,bodyType:bodyTypes.AnyCovered,bodyTypeString:" любой крытый"},7:{capacity:20,cargoLift:!1,volume:92,bodyType:bodyTypes.AnyCovered,bodyTypeString:" любой крытый"}},e.parentalInfo.selectedTruckModelIndex=0,e.parentalInfo.selectedTruckBodyIndex=0,e.parentalInfo.calcRightPartClosed=!e.tariffsPage,e.endAnimation=e.tariffsPage,e.moment=moment,e.timeElement=$("#start-time"),e.dateElement=$("#start-date"),e.initTimeSelects=function(r){Controller.GetServerTime().done((function(r){o((function(){var i=new Date(r);e.serverTime=r,e.todayDate=moment(i),e.tomorrowDate=moment(i).add(1,"day"),e.rawDate=moment(i).add(2,"day"),e.time="09:00",o((function(){e.order&&(e.time=e.order.startTimePlan.formatTime("HH:mm"))}),100)}),10)}))},e.clearFields=function(r){e.currentOrder.loaders=0,e.currentOrder.passengers=0,e.previousValuesLength=0,e.activeCategory=0,e.currentOrder.insuranceAcceptance=e.businessPage,e.selectedTariffType=e.tariffType.NoNDS,e.phone=e.phoneErrorMessage="",e.route={};for(var o=0;o<e.parentalInfo.points.length;o++)e.parentalInfo.points[o].address="",e.parentalInfo.points[o].originalAddress="",e.parentalInfo.points[o].fullAddress="",e.parentalInfo.points[o].longitude=0,e.parentalInfo.points[o].latitude=0,e.parentalInfo.points[o].error=!1;!r&&e.businessPage&&e.onForwardingChange(!1),e.initTimeSelects(r)},e.parentalInfo.points=[{address:"",fullAddress:"",type:pointType.Load,id:newGuid(),longitude:0,latitude:0},{address:"",fullAddress:"",type:pointType.UnLoad,id:newGuid(),longitude:0,latitude:0}],e.clearFields(!0),e.toggleRightPart=function(r){if(addYandexMaps(),e.currentCustomer&&e.currentOrder.loadersHourPriceRaw&&e.isTEO()&&(e.currentOrder.loadersHourPrice=formatWithCoefficient(e.currentOrder.loadersHourPriceRaw,e.currentCustomer.ktz)),!e.tariffsPage&&r&&e.makeBodyFixed(!1),e.tariffsPage&&r)return e.clearFields(),void e.$emit("closeNewCalcPopup");if((r||!r&&e.parentalInfo.calcRightPartClosed)&&(e.parentalInfo.calcRightPartClosed=r,e.endAnimation=!1,o((function(){e.endAnimation=!0}),300)),!r)try{e.createSuggestViews()}catch(e){console.log("yandex maps are not downloaded")}},e.createSuggestViews=function(){e.ymapsInterval=setInterval((function(){e.checkYMapsLoaded()&&(o((function(){ymaps&&ymaps.ready((function(){e.createSuggestViewShortForm(e.parentalInfo.points[0].id),e.createSuggestViewShortForm(e.parentalInfo.points[1].id)}))}),100),clearInterval(e.ymapsInterval))}),100)},e.checkYMapsLoaded=function(){try{return!!ymaps}catch(e){}return!1},e.setLoaders=function(r){o((function(){e.currentOrder.loaders=r,e.updatePriceShortForm()}),0)},e.addPoint=function(r){if(e.parentalInfo.points.length<e.maxPointsCount){var i={address:"",fullAddress:"",id:newGuid(),type:pointType.UnLoad};if(e.parentalInfo.points.push(i),e.parentalInfo.points.length>2){for(var t=-1,n=0;n<e.parentalInfo.points.length;n++)if(""==e.parentalInfo.points[n].address){t=n;break}e.addPointIndex=t}o((function(){e.createSuggestViewShortForm(i.id)}),10)}},e.deletePoint=function(r){e.parentalInfo.points.length>2?e.parentalInfo.points.splice(r,1):(e.parentalInfo.points[r].address="",e.parentalInfo.points[r].originalAddress="",e.parentalInfo.points[r].fullAddress="",e.parentalInfo.points[r].latitude=0,e.parentalInfo.points[r].longitude=0,e.parentalInfo.points[r].isValid=!1,e.parentalInfo.points[r].error=!1,e.parentalInfo.points[r].allowError=!1);for(var o=0;o<e.parentalInfo.points.length;o++)e.parentalInfo.points[o].num=o+1,e.checkPhysicalIntercity(o);e.route.price=0,e.updatePriceShortForm()},e.clearPoints=function(){o((function(){e.parentalInfo.points.splice(2),e.route={};for(var r=0;r<e.parentalInfo.points.length;r++)e.parentalInfo.points[r].address="",e.parentalInfo.points[r].originalAddress="",e.parentalInfo.points[r].fullAddress="",e.parentalInfo.points[r].latitude=0,e.parentalInfo.points[r].longitude=0,e.parentalInfo.points[r].allowError=!1,e.parentalInfo.points[r].error=!1,e.parentalInfo.points[r].isValid=!1}),0)},e.checkIfPointsHaveInput=function(){if(e.parentalInfo.points.length>2)return!0;for(var r=0;r<e.parentalInfo.points.length;r++)if(e.parentalInfo.points[r].address.length>0)return!0;return!1},e.toggleMobileCalc=function(r){e.tariffsPage&&e.$emit("closeNewCalcPopup"),e.newCalcIsVisible=r,e.makeBodyFixed(r),e.makeBodyActive(r),e.toggleRightPart()},e.makeBodyFixed=function(e){$("body").css({overflow:e?"hidden":"auto",position:e?"fixed":"static"})},e.makeBodyActive=function(e){$("body").toggleClass("active",e)},e.changePoints=function(r){if(r>0&&r<e.parentalInfo.points.length){var o=e.parentalInfo.points[r-1].num,i=e.parentalInfo.points[r].num,t=$.extend({},e.parentalInfo.points[r-1]);e.parentalInfo.points[r-1]=$.extend({},e.parentalInfo.points[r]),e.parentalInfo.points[r]=$.extend({},t),e.parentalInfo.points[r-1].num=o,e.parentalInfo.points[r].num=i,e.checkFieldsValidation(),e.updatePriceShortForm()}},e.isTabletSize=!1,e.isMobileSize=!1,e.onResize=function(r){var o=window.outerWidth>300?Math.min(window.innerWidth,window.outerWidth):window.innerWidth;console.log("width:"+[o,window.innerWidth,window.outerWidth]),e.isMobileSize=o<=e.maxMobile,e.isTabletSize=o<=e.maxTablet,!e.isMobileSize&&e.newCalcIsVisible&&e.toggleMobileCalc(!1),e.checkWidth(o)},e.checkWidth=function(r){o((function(){e.isSmallScreen=r<SMALL_SCREEN_WIDTH,e.isMobile=r<MAX_MOBILE_WIDTH}),0)},e.onResize(),$(window).on("window:resize",(function(r){e.onResize()})),e.Math=Math,e.registrationStageTypes=registrationStageTypes,e.suggestViewArray={},e.updateHourPrice=function(){e.hourAddonPrice=0,o((function(){e.route&&(e.currentOrder.isNight?e.hourAddonPrice+=e.truckModel.tariff.nightHourRate:e.hourAddonPrice+=e.truckModel.tariff.hourRate),e.currentOrder.loaders>0&&(e.hourAddonPrice+=e.settingsDict[loadersSettingsName+e.region]*e.currentOrder.loaders)}),1)},getCargoSettings().done((function(r){e.settingsDict=jQuery.extend({},r),e.currentOrder.loadersHourPrice=parseInt(r[loadersSettingsName]),e.currentOrder.loadersHourPriceRaw=parseInt(r[loadersSettingsName]),e.isTEO()&&(e.currentOrder.loadersHourPrice=formatWithCoefficient(e.currentOrder.loadersHourPriceRaw,e.currentCustomer.ktz))})),getOrderTime=e.getOrderTime=function(){if(!e.rawDate||!e.time)return"";var r=e.rawDate.format("YYYY-MM-DD")+" "+e.time;return moment(r).toJSON()},e.recalcMinPrice=function(){e.route=e.route||{},o((function(){e.route.minPrice=e.formatMinPrice(e.truckModel.tariff.minTime,e.truckModel,e.currentOrder.isNight,e.route.coefficient),e.formattedTime=e.currentOrder.formattedTime=formatDateFromFloat(e.truckModel.tariff.minTime,!0),e.formattedTimeShort=e.currentOrder.formattedTimeShort=formatDateFromFloat(e.truckModel.tariff.minTime+e.truckModel.tariff.preOrderTime/60),e.businessPage&&(e.route.loadersCount=e.currentOrder.loaders,e.route.loadersHourPrice=e.currentOrder.loadersHourPrice,e.route.loadersTime=e.truckModel.tariff.minTime),e.updateHourPrice()}),0)},e.pointChange=function(r){e.pointChangeStarted||(e.pointChangeStarted=!0,e.addYandexMetric(e.physicPage?"StartRoutePrivet":"StartRouteEntered")),r.latitude=0,r.longitude=0,r.isValid=!1},e.checkFieldsValidation=function(r){for(var o=[],i=e.parentalInfo.points.length,t=0;t<i;t++){var n=!1;(e.parentalInfo.points[t].allowError||r)&&(r||(e.parentalInfo.points[t].error=!0),e.parentalInfo.points[t].isValid?r||(e.parentalInfo.points[t].error=!1,n=!0):o.push(t)),t!=i-1&&(e.checkFieldsEquality(t)&&(e.parentalInfo.points[t].allowError||r)?(r||(e.parentalInfo.points[t].error=e.parentalInfo.points[t+1].error=!0),o.push("repeat"),t++):r||(e.parentalInfo.points[t].isValid&&(e.parentalInfo.points[t].allowError=!1,e.parentalInfo.points[t].error=!1),e.parentalInfo.points[t+1].isValid&&(e.parentalInfo.points[t+1].error=!1))),n&&(e.parentalInfo.points[t].allowError=!1)}return e.repeatedAddresses=o.length&&o.indexOf("repeat")>-1,e.showAddressError=e.repeatedAddresses||Boolean(o.length),e.showAddressError},e.checkPhysicalIntercity=function(r){if(e.intercityForPhysical=!1,!e.businessPage){var o=e.parentalInfo.points.filter((function(e){return e.latitude&&e.longitude}));if(o.length!=e.parentalInfo.points.length)return!1;var i=useReduceSet(o.map((function(e){return e.region})));e.intercityForPhysical=i.length>1}if(null!=r)if(e.intercityForPhysical)e.parentalInfo.points[r].error=!0,e.parentalInfo.points[r].allowError=!0,e.parentalInfo.points[r].isValid=!1;else if(!e.repeatedaddresses)for(var t=0;t<e.parentalInfo.points.length;t++){var n=e.parentalInfo.points[t];n.latitude&&n.longitude&&(n.error=!1,n.allowError=!1,n.isValid=!0)}},e.assignErrorAllowance=function(){for(var r=0;r<e.parentalInfo.points.length;r++)e.parentalInfo.points[r].allowError=!0},e.checkFields=function(){return e.assignErrorAllowance(),e.checkFieldsValidation(),e.physicPage?(e.isMobileSize&&e.showAddressError&&$(".new-calc-short-form-sub-container").scrollTop(0),e.onPhoneChange(!0),e.physicalRegistrationState,registrationStageTypes.auth,!e.showAddressError):e.businessPage?(e.isMobileSize&&e.showAddressError&&$(".new-calc-short-form-sub-container").scrollTop(0),!e.showAddressError):void 0},e.checkPointsErrors=function(r){if(null==e.parentalInfo.points)return!1;for(var o=666,i=0,t=0;t<e.parentalInfo.points.length;t++)""!=e.parentalInfo.points[t].address&&e.parentalInfo.points[t].address==e.parentalInfo.points[t].originalAddress&&e.parentalInfo.points[t].isValid?t>i&&(i=t):t<o&&(o=t);return o<i},e.onlyFilledPoints=function(e){return e.address||e.latitude&&e.longitude},e.checkFirstFields=function(){return e.parentalInfo.points.length>2||e.parentalInfo.points[0].isValid&&e.parentalInfo.points[1].isValid},e.checkFieldsEquality=function(r){return""!=e.parentalInfo.points[r].address&&e.parentalInfo.points[r].address==e.parentalInfo.points[r+1].address},e.updatePriceShortForm=function(){if(!e.needToUpdatePrice)return!1;if(e.checkFieldsValidation(!0),e.checkPointsErrors()||e.checkFieldsEquality(0)||e.repeatedAddresses)return!1;if(e.truckModel){var r,i,t=e.isTEO()&&e.currentCustomer.ktz||e.fp&&e.fp.nds&&e.ktz||1,n={tariffId:e.truckModel.tariff.id,loadersCount:e.currentOrder.loaders||0,loadersTime:0,time:e.getOrderTime(),forwarding:e.addonsSettings.forwarding,hasInsurance:e.currentOrder.insuranceAcceptance,cargoLift:e.fp&&e.fp.cargoLift,checkHighDemand:e.highDemand.enabled,highDemandCoefficient:e.getCoefficient(),setHighDemand:e.highDemand.enabled,cargoLiftCost:!(!e.fp||!e.fp.cargoLift)&&e.truckModel.tariff.cargoLiftCost,coefficient:t,izoterm:e.truckBodyTypesArray[e.parentalInfo.selectedTruckBodyIndex].Value==bodyTypes.Isothermal,openSide:e.truckBodyTypesArray[e.parentalInfo.selectedTruckBodyIndex].Value==bodyTypes.OpenSide,customerComissionSize:null==e.currentCustomer?0:e.currentCustomer.customerComissionSize||0,minTime:e.minTime,isRentalMode:e.isRentalMode,isTEO:e.isTEO()||e.fp&&e.fp.nds,freeForwarding:null===(r=e.currentCustomer)||void 0===r?void 0:r.freeForwarding,insuranceNDSCompanyTEO:(null===(i=e.currentCustomer)||void 0===i?void 0:i.contractType)==customerContractType.CompanyTEO||e.fp&&e.fp.nds,assumedTimeOffset:e.timeOffset},a=e.parentalInfo.points.filter(e.onlyFilledPoints);n.refrigerator=e.truckBodyTypesArray[e.parentalInfo.selectedTruckBodyIndex].Value==bodyTypes.Refrigerator,a&&a.length>1&&e.checkFirstFields()&&(e.priceLoading=!0,o((function(){e.priceLoading=!1}),7500),e.recalcMinPrice(),calculateOrderRoute(e.parentalInfo.points.filter(e.onlyFilledPoints),n).done((function(r){o((function(){var o,i,t=r.duration,n=parseFloat(r.prrTime)||0;if(e.route=r,e.prrTime=n,e.timeOffset=r.timeOffset,e.region!=e.route.region)return e.region=e.route.region,e.needToUpdatePrice=!1,void e.getHighDemandSettings(!0);e.highDemandStart=moment(r.highDemandStart).utc().add(e.timeOffset,"minutes").format("DD.MM.YY"),e.highDemandFinish=moment(r.highDemandFinish).utc().add(e.timeOffset,"minutes").format("DD.MM.YY"),e.route.intersections=!1,e.route.fee=0,e.route.outsideMKADLength=Math.round(100*(parseFloat(e.route.outsideMKADDistance)||0))/100,e.route.totalLength=Math.round(100*(parseFloat(e.route.distance)||0))/100,e.orderTime=parseFloat(t/3600),e.orderTime+e.prrTime<e.truckModel.tariff.minTime&&(e.prrTime=0),e.orderTime+e.prrTime<e.truckModel.tariff.minTime&&(e.orderTime=e.truckModel.tariff.minTime),e.formattedTime=formatDateFromFloat(e.orderTime+n,!0),e.formattedTimeShort=formatDateFromFloat(e.orderTime+n+e.truckModel.tariff.preOrderTime/60),e.route.entryTTK&&(e.route.fee=e.truckModel.tariff.ttkFee,e.route.intersections=!0),e.currentOrder.time=parseFloat(t/3600),e.currentOrder.time<e.truckModel.tariff.minTime&&(e.currentOrder.time=e.truckModel.tariff.minTime),e.currentOrder.izotermCost=e.route.izotermCost||0,e.currentOrder.highDemandPrice=r.highDemandPrice,e.currentOrder.highDemandCoefficient=r.highDemandCoefficient,e.currentOrder.cargoLiftCost=r.cargoLiftCost,e.currentOrder.formattedTime=formatDateFromFloat(e.currentOrder.time,!0),e.currentOrder.formattedTimeShort=formatDateFromFloat(e.currentOrder.time+e.truckModel.tariff.preOrderTime/60),e.currentOrder.nds=e.tariffType.NoNDS,e.businessPage?(e.route.price+=e.route.customerComission,e.route.price+=e.route.insurancePrice,e.route.ndsCountedLogic&&((null===(o=e.currentCustomer)||void 0===o?void 0:o.contractType)==customerContractType.CompanyTEO||(null===(i=e.currentCustomer)||void 0===i?void 0:i.contractType)==customerContractType.DirectContractTEO||e.fp&&e.fp.nds)&&(e.route.price+=e.route.insuranceNDSCost),e.currentOrder.customerComission=e.route.customerComission,e.currentOrder.insurancePrice=e.route.insurancePrice,e.currentOrder.insuranceCounted=e.route.insurancePrice>0):(e.route.customerComission=0,e.route.insurancePrice=0,e.route.insuranceNDSCost=0,e.route.ndsValue=0),e.currentOrder.plannedPrice=e.route.price,e.updateHourPrice(),e.priceLoading=!1,e.currentOrder.forwardingPrice=e.route.forwardingPrice,e.priceDetails=e.currentOrder,e.route.isIntercity||e.priceFirstTime||(e.priceFirstTime=!0,e.addYandexMetric(e.physicPage?"CustomerShortRoutePrice":"GetPrice")),console.log("route",e.route)}),1)})).fail((function(){o((function(){e.priceLoading=!1,e.route={}}),0)})))}},e.createSuggestViewShortForm=function(r){null==e.suggestViewArray[r]&&(e.suggestViewArray[r]=new ymaps.SuggestView("input"+r,{provider:e.businessPage?gettruckProviderRussia:gettruckProvider}),e.suggestViewArray[r].events.add("select",(function(i){var t=getArrayIndex({id:r},e.parentalInfo.points,"id");$("#input"+r).val(i.originalEvent.item.value),t>-1&&(e.parentalInfo.points[t].address=i.originalEvent.item.value,e.parentalInfo.points[t].originalAddress=i.originalEvent.item.value,e.parentalInfo.points[t].fullAddress=i.originalEvent.item.displayName);var n=new $.Deferred;i.originalEvent.item.latitude&&i.originalEvent.item.longitude?(i.originalEvent.item.fullAddress=i.originalEvent.item.displayName,n.resolve(i.originalEvent.item)):n=geocodePoint(i.originalEvent.item.displayName,t),n.done((function(r){o((function(){e.parentalInfo.points[t].latitude=r.latitude,e.parentalInfo.points[t].longitude=r.longitude,e.parentalInfo.points[t].isValid=!0,e.parentalInfo.points[t].fullAddress=r.fullAddress,setPointRegion(e.parentalInfo.points[t]),e.businessPage||e.checkPhysicalIntercity(t),e.updatePriceShortForm()}),0)})).fail((function(){e.points[t].isValid=!1})),e.suggestViewArray[r].state.set("open",!1)})),e.yandexClass=getYandexMapsMainClass(),$("#input"+r).on("keyup",(function(o){if(13==o.keyCode){null!=e.yandexClass&&""!=e.yandexClass||(e.yandexClass=getYandexMapsMainClass());var i=$("#"+r).parent();i.find("."+e.yandexClass+"suggest-item").length>0&&$(i.find("."+e.yandexClass+"suggest-item")[0]).find("."+e.yandexClass+"search__suggest-item").click(),e.suggestViewArray[r].state.set("open",!1)}}))),e.setAutocompleteNewPassword()},e.setAutocompleteNewPassword=function(){o((function(){$("input").attr("autocomplete","new-password")}),100)},e.toggleSelect=function(r){r.stopPropagation(),e.openCustomerSelect=!e.openCustomerSelect,e.toggleRightPart()},e.toggleSelectWeight=function(r){r.stopPropagation(),e.openCustomerSelectWeight=!e.openCustomerSelectWeight,e.openCustomerSelectBody=!1,e.toggleRightPart()},e.toggleSelectBody=function(r){r.stopPropagation(),e.openCustomerSelectBody=!e.openCustomerSelectBody,e.openCustomerSelectWeight=!1,e.toggleRightPart()},e.gm=function(r,o){if(null==r||null==r.truckModel)return"1т, 7 м³, 3 паллеты";var i=e.shortTruckModelsArray[r.truckModel.id];return null==i&&(i={capacity:r.truckModel.capacity||1,volume:r.truckModel.volumeMin||7,bodyType:r.truckModel.bodyType,bodyTypeString:" "+(truckBodyTypes[r.truckModel.bodyType]||"любой крытый"),length:r.truckModel.bodyLengthMin,width:r.truckModel.bodyWidthMin,pallets:r.truckModel.pallets,cargoLift:!1},e.shortTruckModelsArray[r.truckModel.id]=i),i?i.bodyType==bodyTypes.OpenSide?"{0}т, {1} x {2} м".format(i.capacity,i.length,i.width):"".concat(i.capacity,"т, ").concat(i.volume," м³, ").concat(i.pallets," ").concat(formatLabel(["паллета","паллеты","паллет"],i.pallets)):"1т, 7 м³, 3 паллеты"},e.generateTruckName=function(r,o){if(null==r||null==r.truckModel)return" любой крытый";var i=e.shortTruckModelsArray[r.truckModel.id];return i?i.bodyTypeString:" любой крытый"},e.findTruckById=function(r){for(var o=0;o<e.tariffItemsDrop.length;o++)if(r==e.tariffItemsDrop[o].truckModel.id)return o;return-1},e.selectTruck=function(r,o){r=r||e.findTruckById(o.truckModel.id),o=o||e.tariffItemsDrop[r],e.parentalInfo.selectedTruckModelIndex=r.toString(),e.truckModel=e.tariffItem=o,e.businessPage&&(e.insurancePriceValue=e.currentOrder.insurancePrice=e.truckModel.truckModel.insurancePrice),e.updatePriceShortForm(),(e.isMobile||e.isTablet)&&$(".customer-native-select").blur(),e.createSuggestViews()},e.selectBodyType=function(r,o){e.parentalInfo.selectedTruckBodyIndex=r.toString(),(e.isMobile||e.isTablet)&&$(".customer-native-select").blur(),o&&(e.preActiveBodyType=e.activeBodyType,e.activeBodyType=o.Value,e.preActiveBodyType!=e.activeBodyType&&(e.selectTruckTariffs(),e.updatePriceShortForm()))},e.formatMinPrice=formatMinPrice,e.u=formatMinutePrice,$(document).click((function(r){o((function(){e.openCustomerSelect=!1,e.openCustomerSelectWeight=!1,e.openCustomerSelectBody=!1}),0)})),e.slidePriceWidget=function(){var e=$("#priceFoot").offset().top,r=window.innerHeight,o=$("#priceFixed").height();e-30<r-o?$("#priceFixed").animate({bottom:-o+"px"},200):$("#priceFixed").animate({bottom:"0px"},200)},$(".new-calc-short-form-sub-container").scroll((function(r){clearTimeout(n),n=setTimeout((function(){e.slidePriceWidget()}),30)})),window.addEventListener("resize",(function(){clearTimeout(n),e.slidePriceWidget()})),e.selectTruckTariffs=function(){e.tariffItemsDrop=[];var r=e.activeBodyType==bodyTypes.Refrigerator,i=e.TRANSPORT_REGION_SUBDOMAIN;$.each(e.truckModelsDrop,(function(o,t){t.isRefrigerator==r&&t.region==i&&e.tariffItemsDrop.push({tariff:e.allTariffs.filter((function(r){return r.truckModel_Id==t.id&&r.type==e.tariffType.NoNDS}))[0],truckModel:t})})),e.truckModel=e.tariffItemsDrop[e.parentalInfo.selectedTruckModelIndex],e.currentOrder.time=e.truckModel.tariff.minTime,e.minTime=e.truckModel.tariff.minTime,e.truckModel&&e.truckModel.truckModel&&e.oldIsRefrigerator!=r&&(e.oldIsRefrigerator=r,e.getHighDemandSettings(!0),e.needToUpdatePrice=!1),o((function(){e.needToUpdatePrice&&e.updatePriceShortForm()}),300)},e.insurancePriceValue=e.currentOrder.insurancePrice=0,e.popupOptions={showScroll:!1,closeTimeout:0,overflowModal:e.tariffsPage,onShow:function(){o((function(){$(".mw-wrapper").addClass("shown")}),0)},onClose:function(){o((function(){$(".mw-wrapper").removeClass("shown")}),0)}},o((function(){e.businessPage&&(e.cargoContainer=$("#newOrder-cargoCategory"),e.recallPopup=modalWindow("#recall-popup-2","auth-popup customer-auth-popup register-driver-popup custom-close-btn",{overflowModal:e.tariffsPage}),e.discountPopup=modalWindow("#discount-popup","auth-popup customer-auth-popup register-driver-popup custom-close-btn",{overflowModal:e.tariffsPage})),e.physicPage&&$("#physical-phone").inputmask({mask:"+7 (999) 999-99-99"}),e.priceDetailsPopup=modalWindow("#price-details-popup","price-details-popup margin-top20 from-bottom-popup-mobile",e.popupOptions),e.urgentOrderPopup=modalWindow("#urgent-order-popup","my-popup from-bottom-popup-mobile  hide-mobile-close-btn",{closeTimeout:700,showScroll:!1,onBeforeClose:function(){$(".mw-wrapper").removeClass("shown")},onShow:function(){o((function(){$(".mw-wrapper").addClass("shown")}),100)}}),e.hideUrgentPopup=function(){$(".mw-wrapper").removeClass("shown"),o((function(){e.urgentOrderPopup.hide()}),700)},showUrgentPopup=e.showUrgentPopup=function(){e.urgentOrderPopup.show()}}),10),e.$on("selectTruck",(function(r,i,t){o((function(){var r,o=(r=i.truckModel.isRefrigerator?e.truckBodyTypesArray.findIndex((function(e){return e.Value===bodyTypes.Refrigerator})):e.truckBodyTypesArray.findIndex((function(e){return e.Value===i.truckModel.bodyType})))>-1?r:0;e.selectBodyType(o,e.truckBodyTypesArray[o]);var t={capacity:i.truckModel.capacity||1,volume:i.truckModel.volumeMin||7,bodyType:i.truckModel.bodyType,bodyTypeString:" "+(truckBodyTypes[i.truckModel.bodyType]||"любой крытый"),length:i.truckModel.bodyLengthMin,width:i.truckModel.bodyWidthMin,pallets:i.truckModel.pallets,cargoLift:!1};" Любой"==t.bodyTypeString&&(t.bodyTypeString=" любой крытый"),e.shortTruckModelsArray[i.truckModel.id]=t,e.tariffsPage&&(e.tariffItemsDrop=[i]),e.selectTruck(void 0,i)}),0)})),e.$on("selectBodyType",(function(r,o){var i=e.truckBodyTypesArray.findIndex((function(e){return e.Value===o.Value}));e.selectBodyType(i||0,o)})),e.$on("clearFields",(function(r,o){e.clearFields()})),e.$on("toggleMobileCalc",(function(r,o){e.toggleMobileCalc(o)})),e.$on("toggleRightPart",(function(r){e.toggleRightPart()})),e.showPriceDetailsPopup=function(){e.physicPage&&!e.checkFirstFields()||(e.o=e.order=copyObject(e.route),e.order.plannedPrice=e.route.price,e.order.ndsValue=e.route.ndsValue,e.order.ndsCountedLogic=e.route.ndsCountedLogic,e.order.ndsCountedLogic&&(e.currentCustomer?(e.order.customerContractType=e.currentCustomer.contractType,e.currentCustomer.type!=customerType.Physical||e.physicPage||(e.order.customerContractType=customerContractType.Company)):e.physicPage?e.order.customerContractType=customerContractType.NoType:e.fp&&e.fp.nds?e.order.customerContractType=customerContractType.CompanyTEO:e.order.customerContractType=customerContractType.Company),e.priceDetailsPopup.show())},e.onForwardingChange=function(r){e.addonsSettings.forwarding=void 0!==r?r:!e.addonsSettings.forwarding,e.updatePriceShortForm()},Controller.GetServerTime().done((function(r){o((function(){e.serverTime=r}),0)})),setTime=function(r){e.time=r,$(e.timeElement).timepicker("setTime",e.time)},e.getForwardingCost=function(){var r;if(null!==(r=e.currentCustomer)&&void 0!==r&&r.freeForwarding)return 0;if(e.route&&e.route.forwardingPrice)return e.route.forwardingPrice;var o=e.isTEO()&&e.currentCustomer.ktz||e.fp&&e.fp.nds&&e.ktz||1;return e.truckModel&&e.truckModel.tariff?formatWithCoefficient(e.truckModel.tariff.forwarding,o):null},e.ie=function(){return null==e.currentCustomer||e.currentCustomer.confirmStatus==customerConfirmStatus.New||e.currentCustomer.type==customerType.Company&&e.physicPage||e.currentCustomer.type==customerType.Physical&&e.businessPage},e.hideRecallPopup=function(){e.recallPopup.hide()},showRecallPopup=e.showRecallPopup=function(){e.recallPopup.show()},e.hideDiscountPopup=function(){e.discountPopup.hide()},showDiscountPopup=e.showDiscountPopup=function(){e.discountName="",e.discountPhone="",e.discountPopup.show()},e.onDiscountNameChange=function(){e.discountName&&e.discountName.length>30&&(e.discountName=e.discountName.substr(0,30))},e.onDiscountNameBlur=function(){e.isDiscountNameValid=!0,e.isDiscountNameFocused=!1,e.discountNameErrorMessage="",""!=e.discountName&&null!=e.discountName||(e.isDiscountNameValid=!1),e.isDiscountNameFocused=!e.isDiscountNameValid,e.isDiscountNameFocused&&(e.discountNameErrorMessage="Укажите контактное лицо")},e.onDiscountPhoneBlur=function(){e.isDiscountPhoneFocused=!1,e.isDiscountPhoneValid=validatePhone(e.discountPhone),e.discountPhoneErrorMessage="",e.isDiscountPhoneFocused=!e.isDiscountPhoneValid,e.isDiscountPhoneFocused&&(e.discountPhone?e.discountPhoneErrorMessage=e.wrongFormatPhoneError:e.discountPhoneErrorMessage=e.emptyPhoneError)},e.createOrderRequest=function(r){e.checkFields()&&(r?e.addYandexMetric("BusinessSkidka"):e.addYandexMetric("BusinessDrGorodRaschet"),e.showDiscountPopup())},e.sendRequest=function(){if(e.onDiscountNameBlur(),e.onDiscountPhoneBlur(),!e.isDiscountPhoneFocused&&!e.isDiscountNameFocused){var r=e.setOrderParams({},!0),o={cargoVolume:r.cargoVolume,cargoWeight:r.cargoWeight/1e3,bodyType:r.bodyType,plannedPrice:e.route.price,forwarding:r.forwarding,isBusiness:e.businessPage,contactName:e.discountName,contactPhone:clearPhone(e.discountPhone),isIntercity:e.route.isIntercity,routePoints:r.routePoints,url:window.location.href,utms:getUTMS()};client.invokeApi("Order/CreateOrderRequest",{method:"post",contentType:"application/json",data:JSON.stringify(o)}).done((function(r){e.addYandexMetric(e.route.isIntercity?"BusinessDrGorodZayavka":"BusinessSkidkaZayavka"),e.hideDiscountPopup(),e.showRecallPopup()})).fail((function(e){showToast({message:e.message,type:"warning"})}))}},$.when.apply($,[Controller.GetTruckModels("isFiltered=false"),Controller.GetAllTariffs(null===(t=e.currentCustomer)||void 0===t?void 0:t.id)]).then((function(r,o){e.allTariffs=o,e.physicPage?e.truckModelsDrop=r.filter(e.filterByVolumeDrop).sort((function(e,r){return e.capacity-r.capacity})):e.truckModelsDrop=r.sort((function(e,r){return e.capacity-r.capacity})),e.selectTruckTariffs()})),e.filterByVolumeDrop=function(e){return e.volumeMax<=35},e.getKTZ=function(){return e.isTEO()?e.currentCustomer.ktz:1},e.isTodayHoliday=function(){e.isHoliday=!1,client.invokeApi("Calendar/IsTodayHoliday?_="+(new Date).getTime(),{method:"get"}).done((function(r){o((function(){e.isHoliday=r}),0)})).fail((function(e){console.log(e)}))},e.isTodayHoliday(),e.getFieldsError=function(){return e.intercityForPhysical?"Междугородние перевозки для физических лиц не осуществляются. Проверьте корректность адресов, отмеченных красной рамкой. Оформить заказ/применить изменения нельзя":"Не удалось построить маршрут. Проверьте корректность адресов, отмеченных красной рамкой."},e.getHighDemandSettings=function(r){var i,t=a;e.truckModel&&null!==(i=e.truckModel.truckModel)&&void 0!==i&&i.isRefrigerator&&(t=s),Controller.GetSettings(t,e.region).done((function(i){o((function(){e.highDemandSetting=i,e.highDemandSetting&&(e.highDemand=JSON.parse(e.highDemandSetting.value),e.highDemand.enabled=e.highDemand.Enabled,e.highDemand.startTime=new Date(e.highDemand.StartTime),e.highDemand.finishTime=new Date(e.highDemand.FinishTime),e.highDemand.coefficientCapacity1T=e.highDemand.CoefficientCapacity1T,e.highDemand.coefficientCapacity1_5T=e.highDemand.CoefficientCapacity1_5T,e.highDemand.coefficientCapacity2T=e.highDemand.CoefficientCapacity2T,e.highDemand.coefficientCapacity2_5T=e.highDemand.CoefficientCapacity2_5T,e.highDemand.coefficientCapacity3T=e.highDemand.CoefficientCapacity3T,e.highDemand.coefficientCapacity5TSmallVolume=e.highDemand.CoefficientCapacity5TSmallVolume,e.highDemand.coefficientCapacity5TBigVolume=e.highDemand.CoefficientCapacity5TBigVolume,e.highDemand.coefficientCapacity10T=e.highDemand.CoefficientCapacity10T,e.highDemand.coefficientCapacity20T=e.highDemand.CoefficientCapacity20T,e.needToUpdatePrice=!0,r&&e.updatePriceShortForm())}),0)}))},e.getCoefficient=function(){if(e.truckModel&&e.truckModel.truckModel&&e.highDemand.enabled){var r=moment(e.getOrderTime());return r<moment(e.highDemand.startTime)||r>moment(e.highDemand.finishTime)?1:e.truckModel.truckModel.capacity<=HIGH_DEMAND_CAPACITY_1?e.highDemand.coefficientCapacity1T:e.truckModel.truckModel.capacity<=HIGH_DEMAND_CAPACITY_1_5?e.highDemand.coefficientCapacity1_5T:e.truckModel.truckModel.capacity<=HIGH_DEMAND_CAPACITY_2?e.highDemand.coefficientCapacity2T:e.truckModel.truckModel.capacity<=HIGH_DEMAND_CAPACITY_2_5?e.highDemand.coefficientCapacity2_5T:e.truckModel.truckModel.capacity<=HIGH_DEMAND_CAPACITY_3?e.highDemand.coefficientCapacity3T:e.truckModel.truckModel.capacity<=HIGH_DEMAND_CAPACITY_5&&e.truckModel.truckModel.volumeMax<=HIGH_DEMAND_CAPACITY_5_SMALL_VOLUME?e.highDemand.coefficientCapacity5TSmallVolume:e.truckModel.truckModel.capacity<=HIGH_DEMAND_CAPACITY_5?e.highDemand.coefficientCapacity5TBigVolume:e.truckModel.truckModel.capacity<=HIGH_DEMAND_CAPACITY_10?e.highDemand.coefficientCapacity10T:e.highDemand.coefficientCapacity20T}return 1},e.getHighDemandSettings()}]),myApp.controller("recallCtrl",["$scope","$filter","$timeout","$compile",function(e,r,o,i){e.loading=!0,e.phone="",e.sent=!1,e.isPhoneValid=!1,e.isPhoneFocused=!1,e.success=!1,e.emptyPhoneError="Мобильный телефон обязателен",e.wrongFormatPhoneError="Введен некорректный номер мобильного телефона",e.duplicationRequestError="Вы уже запрашивали обратный звонок с этого номера. Повторный запрос можно сделать через {0} {1}.",e.INTERVAL_IN_MINUTES=15,e.INTERVAL=60*e.INTERVAL_IN_MINUTES*1e3,e.cases=["минуту","минуты","минут"],e.oldPhones={},e.checkInterval=0,e.globalCheck=function(){if(validatePhone(e.phone)){var r=(new Date).getTime(),i=clearPhone(e.phone),t=e.oldPhones[i],n=parseInt(t);t&&Number.isInteger(n)&&o((function(){if(n+e.INTERVAL>r){var o=Math.ceil((n+e.INTERVAL-r)/ONE_MINUTE);e.phoneErrorMessage=e.duplicationRequestError.format(o,formatLabel(e.cases,o)),e.isPhoneFocused=!0,e.isPhoneValid=!1}else e.phoneErrorMessage="",e.isPhoneFocused=!1,e.isPhoneValid=!0,clearInterval(e.checkInterval)}),0)}},e.checkOldPhone=function(r){r=clearPhone(r);var o=!0,i=(new Date).getTime(),t=e.oldPhones[r],n=parseInt(t);if(t&&Number.isInteger(n))if(n+e.INTERVAL>i){var a=Math.ceil((n+e.INTERVAL-i)/ONE_MINUTE);e.phoneErrorMessage=e.duplicationRequestError.format(a,formatLabel(e.cases,a)),e.isPhoneFocused=!0,e.isPhoneValid=!1,o=!1,e.checkInterval=setInterval(e.globalCheck,1e3)}else e.oldPhones[r]=i;else e.oldPhones[r]=i;return localStorage.oldPhones=JSON.stringify(e.oldPhones),o},o((function(){if(e.recallPopup=modalWindow("#recall-popup","auth-popup customer-auth-popup register-driver-popup custom-close-btn"),localStorage.oldPhones)try{e.oldPhones=JSON.parse(localStorage.oldPhones)}catch(r){e.oldPhones={}}}),10),e.hideRecallPopup=function(){e.recallPopup.hide()},e.onPhoneChange=function(){o((function(){e.isPhoneValid=validatePhone(e.phone),clearInterval(e.checkInterval),e.isPhoneValid&&e.addYandexMetric(e.physicPage?"f_question_push_privet":"f_question_push")}),0)},e.onPhoneBlur=function(){o((function(){e.isPhoneValid=validatePhone(e.phone),e.isPhoneFocused=!1,e.phoneErrorMessage="",e.isPhoneValid?clearInterval(e.checkInterval):(e.isPhoneFocused=!0,""!=e.phone?e.phoneErrorMessage=e.wrongFormatPhoneError:e.phoneErrorMessage=e.emptyPhoneError)}),1)},e.afterSendFeedback=function(r){e.success=r,e.sent=!0,e.recallPopup.show()},e.sendFeedback=function(){o((function(){if(validatePhone(e.phone)&&e.checkOldPhone(e.phone)){e.addYandexMetric(e.physicPage?"f_question_send_privet":"f_question_send");var r=clearPhone(e.phone);client.invokeApi("FeedBack/Recall",{method:"POST",contentType:"application/json",data:JSON.stringify({phone:r,name:"",isBusiness:e.isBusiness,url:window.location.href,utms:getUTMS()})}).done((function(r){try{console.log("ga event recall"),dataLayer&&dataLayer.push({event:"gaevent",eventCategory:"callback",eventAction:"callback_success"})}catch(e){}var i="Неизвестно";e.currentUser&&(e.currentUser.type!=userTypes.Carrier&&e.currentUser.type!=userTypes.SuperCarrier||(i="Перевозчик"),e.currentUser.type!=userTypes.Customer&&e.currentUser.type!=userTypes.SuperCustomer||(i="Заказчик",e.currentCustomer&&(e.currentCustomer.type==customerType.Company?i+=" Бизнес":i+=" Физик"))),$.post("/FeedBack/Recall",{url:window.location.href,message:e.err_message,userType:i,phone:e.phone},(function(e){})),o((function(){e.afterSendFeedback(!0)}),1)})).fail((function(){o((function(){e.afterSendFeedback(!1)}),1)}))}}),10)}}]),myApp.controller("footerCtrl",["$scope","$filter","$q","$timeout",function(e,r,o,i){var t=$.Deferred(),n=$.Deferred();function a(){i((function(){e.leftGroup=s(e.leftItems.slice(),0),e.rightGroup=s(e.rightItems.slice(),1)}),0)}function s(r,o){var i,t=[],n=!1,a=4;if(window.innerWidth<=e.maxMobile&&(n=!0,e.rightItems.length||(a=2)),n){var s=e.leftItems.concat(e.rightItems);return o?[s.slice(Math.ceil(s.length/2))]:[s.slice(0,Math.ceil(s.length/2))]}return window.innerWidth<=e.maxTablet&&o?[r]:(r.length>a?(i=r.length%2==0?r.length/2:Math.ceil(r.length/2),t.push(r.slice(0,i),r.slice(i))):t.push(r),t)}e.leftGroup=[],e.rightGroup=[],e.leftItems=[],e.rightItems=[],e.url=window.location.pathname.toLowerCase(),e.forCarriers=e.url==loginUrls[loginTypes.Carrier]||e.url==loginUrls[loginTypes.CarrierCompany],e.onResize=function(){e.leftGroup=s(e.leftItems.slice(),0),e.rightGroup=s(e.rightItems.slice(),1),a()},$(window).resize(e.onResize),$.ajax({type:"GET",url:"/GetBottomMenuItemsLeft",contentType:!1,processData:!1,success:function(e){t.resolve(e)},error:function(e){console.log(e),t.reject(e)}}),$.ajax({type:"GET",url:"/GetBottomMenuItemsRight",contentType:!1,processData:!1,success:function(e){n.resolve(e)},error:function(e){console.log(e),n.reject(e)}}),$.when(t,n).done((function(r,o){e.leftItems=JSON.parse(r),e.handleTarrifsUrl(),e.rightItems=JSON.parse(o),e.leftItems=e.leftItems.map((function(e){return _objectSpread(_objectSpread({},e),{},{t:e.text})})),e.rightItems=e.rightItems.map((function(e){return _objectSpread(_objectSpread({},e),{},{t:e.text})})),a()})),e.handleTarrifsUrl=function(){for(var r=0;r<e.leftItems.length;r++)"tarify"==e.leftItems[r].url&&(e.leftItems[r].url=e.composeTariffsUrl().slice(1))},e.$on("customerLoaded",(function(){i((function(){if(e.isNDSCounted&&e.currentCustomer&&(e.currentCustomer.contractType==customerContractType.CompanyTEO||e.currentCustomer.contractType==customerContractType.DirectContractTEO))for(var r=0;r<e.leftItems.length;r++)"insurance"==e.leftItems[r].url&&(e.leftItems[r].url="insurance_teo")}),10)}))}]);var menuUrls,menuUrlsSecondLevel,header__onLoad,menuTypes={Physical:1,Business:2,Carrier:3,Admin:4,CarrierCompany:5,Business2:6,Carrier2:7,CarrierCompany2:8,Business3:9,Business4:10},currentUrl=window.location.pathname.toLowerCase();!function(){var e;e={gruzoperevozki:[{name:"Газелью",url:otherPageUrls[otherPageTypes.Gazelles]},{name:"Фурами",url:otherPageUrls[otherPageTypes.Trucks]},{name:"Рефрижераторные",url:otherPageUrls[otherPageTypes.Refrigirators]},{name:"С гидробортом",url:"/tarify-dlya-biznesa/gruzoperevozki-gidrobort"},{name:"Манипулятором",url:null},{name:"В торговые сети",url:otherPageUrls[otherPageTypes.TradeDelivery]}],"/tarify-dlya-biznesa":[{hidden:"true",url:"/tarify-dlya-biznesa"},{name:"1 т",url:"/tarify-dlya-biznesa/gruzoperevozki-1-tonna"},{name:"1,5 т",url:"/tarify-dlya-biznesa/gruzoperevozki-1.5-tonny"},{name:"3 т",url:"/tarify-dlya-biznesa/gruzoperevozki-3-tonny"},{name:"5 т",url:"/tarify-dlya-biznesa/gruzoperevozki-5-tonn"},{name:"10 т",url:"/tarify-dlya-biznesa/gruzoperevozki-10-tonn"},{name:"20 т",url:"/tarify-dlya-biznesa/gruzoperevozki-20-tonn"},{name:"с НДС",url:"/tarify-dlya-biznesa/gruzoperevozki-s-nds"}]},_defineProperty(e,otherPageUrls[otherPageTypes.Marketplaces],[{hidden:"true",url:otherPageUrls[otherPageTypes.Marketplaces]},{name:"Ozon",url:otherPageUrls[otherPageTypes.Ozon]},{name:"Wildberries",url:otherPageUrls[otherPageTypes.Wildberries]},{name:"СберМегаМаркет",url:otherPageUrls[otherPageTypes.Sber]},{name:"Яндекс Маркет",url:otherPageUrls[otherPageTypes.Yandeks]},{name:"Lamoda",url:otherPageUrls[otherPageTypes.Lamoda]},{name:"AliExpress",url:otherPageUrls[otherPageTypes.AliExpress]},{name:"Детский мир",url:otherPageUrls[otherPageTypes.DetskijMir]}]),_defineProperty(e,"moving",[{name:"Банка",url:otherPageUrls[otherPageTypes.Bank]},{name:"Склада",url:otherPageUrls[otherPageTypes.Warehouse]},{name:"Магазина",url:otherPageUrls[otherPageTypes.Store]},{name:"Переезд компании",url:otherPageUrls[otherPageTypes.Company]},{name:"Офисный переезд",url:otherPageUrls[otherPageTypes.Office]}]),_defineProperty(e,"shipping",[{name:"Станков",url:otherPageUrls[otherPageTypes.Machine]},{name:"Серверов",url:otherPageUrls[otherPageTypes.Server]},{name:"Банкоматов",url:otherPageUrls[otherPageTypes.ATM]},{name:"Оргтехники и офисной техники",url:otherPageUrls[otherPageTypes.OfficeEquipment]},{name:"Торгового оборудования",url:otherPageUrls[otherPageTypes.CommercialEquipment]},{name:"Полиграфического оборудования",url:otherPageUrls[otherPageTypes.PrintingEquipment]},{name:"Транспортировка архивных документов",url:otherPageUrls[otherPageTypes.Archive]}]),_defineProperty(e,"uslugi",[{name:"Экспедирование грузов",url:"/ekspedirovanie"},{name:"Услуги грузчиков",url:"/gruzchiki"}]),_defineProperty(e,loginUrls[loginTypes.Physical],[{hidden:"true",url:loginUrls[loginTypes.Physical]},{name:"Квартирый переезд",url:otherPageUrls[otherPageTypes.Apartment]},{name:"Дачный переезд",url:otherPageUrls[otherPageTypes.Cottage]},{name:"Перевозка вещей",url:otherPageUrls[otherPageTypes.Thing]},{name:"Кровати",url:otherPageUrls[otherPageTypes.Bed]},{name:"Дивана",url:otherPageUrls[otherPageTypes.Sofa]},{name:"Шкафа",url:otherPageUrls[otherPageTypes.Cabinet]},{name:"Мебели",url:otherPageUrls[otherPageTypes.Furniture]},{name:"Перевозка бытовой техники",url:otherPageUrls[otherPageTypes.Household]},{name:"Стиральной машины",url:otherPageUrls[otherPageTypes.WashingMachine]},{name:"Холодильника",url:otherPageUrls[otherPageTypes.RefrigeratorsPhysic]}]),_defineProperty(e,"/tarify-gruzovoe-taxi",[{hidden:"true",url:"/tarify-gruzovoe-taxi"},{name:"1 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-1-tonna"},{name:"1,5 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-1.5-tonny"},{name:"3 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-3-tonny"},{name:"5 т",url:"/tarify-gruzovoe-taxi/gruzovye-avtomobili-5-tonn"}]),menuUrlsSecondLevel=e;var r=[];Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.MO?r=[{name:"По Москве и Московской области",url:"/moscow"}]:Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.LO?r=[{name:"По Санкт-Петербургу и Ленинградской области",url:"/spb"}]:Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.NO?r=[{name:"По Нижнему Новгороду и области",url:"/nn"}]:Global.TRANSPORT_REGION_SUBDOMAIN==transportRegion.SO&&(r=[{name:"По Екатеринбургу и области",url:"/ekb"}]),menuUrlsSecondLevel.gruzoperevozki=r.concat(menuUrlsSecondLevel.gruzoperevozki),(menuUrls=_objectSpread({},menuUrlsSecondLevel))[loginTypes.Company]=[loginUrls[loginTypes.Company]].concat(_toConsumableArray(menuUrls.gruzoperevozki.filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls["/tarify-dlya-biznesa"].filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls[otherPageUrls[otherPageTypes.Marketplaces]].filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls.moving.filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls.shipping.filter((function(e){return null!=e.url})).map((function(e){return e.url}))),_toConsumableArray(menuUrls.uslugi.filter((function(e){return null!=e.url})).map((function(e){return e.url})))),menuUrls[loginTypes.Physical]=[loginUrls[loginTypes.Physical]].concat(_toConsumableArray(menuUrls["/tarify-gruzovoe-taxi"].filter((function(e){return null!=e.url})).map((function(e){return e.url})))),menuUrls.carrierAndCompany=[loginUrls[loginTypes.Carrier],loginUrls[loginTypes.CarrierCompany]]}(),myApp.controller("menuCtrl",["$scope","$filter","$q","$timeout",function(e,r,o,i){e.url=window.location.pathname.toLowerCase(),e.isUserDropdownOpen=!1,e.isBurgerOpen=!1,e.menuUrls=menuUrls,e.forCarriers=e.url==loginUrls[menuTypes.Carrier]||e.url==loginUrls[menuTypes.CarrierCompany],e.notifyUrls=["/"].concat(_toConsumableArray(citiesAddresses),[otherPageUrls[otherPageTypes.TarrifsBusiness],otherPageUrls[otherPageTypes.Insurance],otherPageUrls[otherPageTypes.About],otherPageUrls[otherPageTypes.Contacts]]),e.notifyVisible=!1,e.closeHeaderNotify=function(){e.notifyVisible=!1},e.notifyDetails=function(){window.location.href=otherPageUrls[otherPageTypes.Refrigirators]},e.logoutWithTimeout=function(){i((function(){e.logout()}),0)},e.toggleUserDropdown=function(r,o){e.isUserDropdownOpen=r?!e.isUserDropdownOpen:o},e.getLkUrl=function(e){var r="";return e==loginTypes.Company||e==loginTypes.Physical?r="/CustomerOffice":e!=loginTypes.Carrier&&e!=loginTypes.CarrierCompany||(r="/CarrierOffice"),r},(header__onLoad=function(){"/user/forgotpassword"!=currentUrl&&"/user/verify"!=currentUrl||("true"==Global.Third.toLowerCase()?currentUrl=2==Global.Fourth?loginUrls[menuTypes.Carrier]:loginUrls[menuTypes.CarrierCompany]:"/user/verify"==currentUrl?2==Global.Fourth?(currentUrl=loginUrls[menuTypes.Physical],e.isBusiness=e.$parent.isBusiness=!1):(currentUrl=loginUrls[menuTypes.Business],e.isBusiness=e.$parent.isBusiness=!0):currentUrl=loginUrls[menuTypes.Business]),currentUrl==loginUrls[menuTypes.Business]||currentUrl==loginUrls[menuTypes.Business2]||currentUrl==loginUrls[menuTypes.Business3]||currentUrl==loginUrls[menuTypes.Business4]?(pageType=e.pageType=e.$parent.pageType=loginTypes.Company,e.isBusiness=e.$parent.isBusiness=!0):currentUrl==loginUrls[menuTypes.Carrier]||currentUrl==loginUrls[menuTypes.Carrier2]?(pageType=e.pageType=e.$parent.pageType=loginTypes.Carrier,currentUrl==loginUrls[menuTypes.Carrier2]&&(e.carrier2=e.$parent.carrier2=!0)):currentUrl==loginUrls[menuTypes.CarrierCompany]||currentUrl==loginUrls[menuTypes.CarrierCompany2]?(pageType=e.pageType=e.$parent.pageType=loginTypes.CarrierCompany,currentUrl==loginUrls[menuTypes.CarrierCompany2]&&(e.carrier2=e.$parent.carrier2=!0)):currentUrl==loginUrls[menuTypes.Admin]?pageType=e.pageType=e.$parent.pageType=loginTypes.Admin:currentUrl==loginUrls[menuTypes.Physical]&&(pageType=e.pageType=e.$parent.pageType=loginTypes.Physical)})(),e.isActive=function(e){return e===currentUrl},e.toggleSecondLevel=function(r){e[r]||(e.showMobileCompany=!1,e.showMobileCarrier=!1,e.showMobilePhysical=!1),e[r]=!e[r]},e.setActiveSubMenu=function(r){e.activeSubMenu=r},e.citiesMenuVisible=!1,e.showCities=function(){e.citiesMenuVisible=!0},e.toggleBurger=function(r){if(e.citiesMenuVisible=!1,e.isBurgerOpen=!e.isBurgerOpen,e.isBurgerOpen)for(var o in e.showMobileCompany=!1,e.showMobileCarrier=!1,e.showMobilePhysical=!1,e.showLoginOptions=!1,e.activeSubMenu=null,menuUrls[loginTypes.Company].indexOf(currentUrl)>-1&&(e.showMobileCompany=!0),menuUrls[loginTypes.Physical].indexOf(currentUrl)>-1&&(e.showMobilePhysical=!0),menuUrls.carrierAndCompany.indexOf(currentUrl)>-1&&(e.showMobileCarrier=!0),Object.keys(menuUrls).indexOf(currentUrl)>-1&&(e.activeSubMenu=currentUrl),menuUrlsSecondLevel){menuUrlsSecondLevel[o].filter((function(e){return null!=e.url})).map((function(e){return e.url})).indexOf(currentUrl)>-1&&(e.activeSubMenu=o)}else e.activeSubMenu=null},e.isActiveMenuItem=function(e,r){var o;return!!((o=r?menuUrls[e]:menuUrls[e].filter((function(e){return null!=e.url})).map((function(e){return e.url})))&&o.indexOf(currentUrl)>-1)}}]),function(){var e,r;myApp.controller("authorizationCtrl",["$scope","$filter","$timeout","$compile",function(o,i,t,n){o.debug=!1,o.isNullOrWhiteSpace=isNullOrWhiteSpace,o.smsTimeout=Global.SMSTimeout,o.emptyPhoneError="Введите номер мобильного телефона",o.wrongFormatPhoneError="Введен некорректный номер мобильного телефона",o.emptyEmailError=ErrorString.EmptyEmailError,o.wrongFormatEmailError=ErrorString.WrongFormatEmailError,o.emptyPasswordErrorLogin="Введите пароль",o.wrongFormatPasswordErrorLogin="Неверный формат пароля",o.registerBusinessError="",o.loginBusinessError="",o.recaptchaBusinessValid=!0,o.isPrivate=window.location.pathname.toLowerCase()!=o.loginUrls[o.loginTypes.Company],o.isRegistration=!0,o.phoneLoginPrivate="",o.isPhoneLoginPrivateValid=!1,o.isPhoneLoginPrivateFocused=!1,o.passwordLoginPrivate="",o.errorMessageLoginPrivate="",o.emailLoginBusiness="",o.isEmailLoginBusinessValid=!1,o.isEmailLoginBusinessFocused=!1,o.passwordLoginBusiness="",o.errorMessageLoginBusiness="",o.phoneRegistationPrivate="",o.isPhoneRegistationPrivateValid=!1,o.isPhoneRegistationPrivateFocused=!1,o.codeRegistationPrivate="",o.errorMessageRegistrationPrivate="",o.isSMSsentPrivate=!1,o.timeoutPrivate=0,o.emailRegistrationBusiness="",o.isEmailRegistrationBusinessValid=!1,o.isEmailRegistrationBusinessFocused=!1,o.phoneRegistrationBusiness="",o.isPhoneRegistrationBusinessValid=!1,o.isPhoneRegistrationBusinessFocused=!1,o.isSMSsentBusiness=!1,o.timeoutBusiness=0,o.fromShortForm=!1,o.debug&&(o.isPhoneRegistrationBusinessValid=!0,o.codeRegistrationBusinessInputEnabled=!0,o.isSMSsentBusiness=!0,o.codeRegistrationBusinessSent=!0,o.timeoutBusiness=29,o.phoneLoginPrivate="9779067856",o.codePrivateSent=!0,o.timeoutPrivate=29,o.isSMSsentPrivate=!0,o.codePrivateInputEnabled=!0),o.codeRegistrationBusiness="",o.errorMessageRegistrationBusiness="",o.createOrder=!1,o.url=window.location.pathname.toLowerCase(),o.pageType=loginUrls[o.url]||loginTypes.Physical,o.pageUrl="/",o.clearData=function(){o.codeRegistrationBusinessSent=!1,o.codeRegistrationBusinessInputEnabled=!1,o.phoneLoginPrivate="",o.isPhoneLoginPrivateValid=!1,o.passwordLoginPrivate="",o.emailLoginBusiness="",o.emailLoginErrorMessage="",o.isEmailLoginBusinessFocused=!1,o.isEmailLoginBusinessValid=!1,o.isPasswordLoginBusinessFocused=!1,o.isPasswordLoginBusinessValid=!1,o.passwordLoginBusiness="",o.passwordLoginBusinessErrorMessage="",o.loginBusinessError="",o.registerBusinessError="",o.codeRegistrationBusinessInputEnabled=!1,o.codePrivate="",o.codeRegistationPrivate="",o.isCodePrivateFocused=!1,o.isPhoneLoginPrivateFocused=!1,o.isPhoneRegistationPrivateValid=!1,o.phoneRegistationPrivate="",o.incorrectCodePrivate=!1,o.codeRegistrationBusiness="",o.codeRegistrationBusinessErrorMessage="",o.emailRegistrationBusiness="",o.emailRegistrationBusinessErrorMessage="",o.isCodeRegistrationBusinessValid=!1,o.isCodeRegistrationBusinessFocused=!1,o.isEmailRegistrationBusinessFocused=!1,o.isEmailRegistrationBusinessValid=!1,o.isPhoneRegistrationBusinessFocused=!1,o.isPhoneRegistrationBusinessValid=!1,o.phoneRegistrationBusiness="",o.phoneRegistrationBusinessErrorMessage="",o.clearErrors(),o.clearFocuses(),o.showSendMessage=!1,o.codePrivateSent=!1,o.phoneLoginPrivateErrorMessage="",o.timeoutPrivate=0,o.incorrectCodeBusiness=!1,o.recaptchaBusinessRendered=!1,o.recaptchaBusinessValid=!0,o.debug&&(o.isPhoneRegistrationBusinessValid=!0,o.codeRegistrationBusinessInputEnabled=!0,o.isSMSsentBusiness=!0,o.codeRegistrationBusinessSent=!0,o.timeoutBusiness=29,o.phoneLoginPrivate="9779067856",o.codePrivateSent=!0,o.timeoutPrivate=29,o.isSMSsentPrivate=!0,o.codePrivateInputEnabled=!0)},o.clearFocuses=function(){o.isPhoneLoginPrivateFocused=!1,o.isPhoneRegistrationBusinessFocused=!1,o.isPhoneRegistationPrivateFocused=!1,o.isEmailLoginBusinessFocused=!1,o.isEmailRegistrationBusinessFocused=!1},o.clearErrors=function(){o.errorMessageLoginPrivate="",o.errorMessageLoginBusiness="",o.errorMessageRegistrationPrivate="",o.errorMessageRegistrationBusiness=""},o.setRegistration=function(e){o.isRegistration=e,t((function(){o.isRegistration?(o.isPrivate?(o.phoneLoginPrivateInput.focus(),o.phoneLoginPrivate=o.phoneRegistationPrivate):(o.emailLoginBusinessInput.focus(),o.emailLoginBusiness=o.emailRegistrationBusiness),window.location.pathname.toLowerCase().indexOf("registration")<0&&!o.isPrivate&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/registration"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/registration"):history.pushState(null,null,"/registration"))):(o.isPrivate?(o.phoneRegistationPrivateInput.focus(),o.phoneRegistationPrivate=o.phoneLoginPrivate):(o.emailRegistrationBusinessInput.focus(),o.emailRegistrationBusiness=o.emailLoginBusiness),window.location.pathname.toLowerCase().indexOf("login")<0&&!o.isPrivate&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/login"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/login"):history.pushState(null,null,"/login"))),o.clearData()}),100)},o.showAuthorizationPopup=function(e){!o.authorizationPopup&&o.initAuthorizationPopup(),o.clearData(),e&&(o.isPrivate=e.isPrivate,o.fromShortForm=e.fromShortForm,o.isRegistration=e.isRegistration,o.createOrder=e.createOrder,o.runSubmitOrderCreate=e.runSubmitOrderCreate,o.showReview=e.showReview,o.orderNumber=e.orderNumber),addCaptcha(),o.authorizationPopup.show(),t((function(){!o.isPrivate&&e&&e.phone&&(o.phoneRegistrationBusiness=e.phone,o.onPhoneRegistrationBusinessChange()),o.isPrivate&&o.recaptchaPrivateRendered&&(o.recaptchaPrivateRendered=!1,o.recaptchaPrivate2Rendered=!1),o.isRegistration?o.isPrivate?o.phoneLoginPrivateInput.focus():o.emailLoginBusinessInput.focus():o.isPrivate?o.phoneRegistationPrivateInput.focus():o.emailRegistrationBusinessInput.focus()}),150)},o.hideAuthorizationPopup=function(){o.authorizationPopup.hide()},o.$on("showAuthorizationPopup",(function(e,r){o.showAuthorizationPopup(r)})),o.$on("hideAuthorizationPopup",(function(e,r){o.hideAuthorizationPopup(r)})),o.onPhoneLoginPrivateBlur=function(e){t((function(){o.phoneLoginPrivateErrorMessage="",o.isPhoneLoginPrivateFocused=!1,o.isPhoneLoginPrivateValid=validatePhone(o.phoneLoginPrivate),""!=o.phoneLoginPrivate&&(o.isPhoneLoginPrivateFocused=!o.isPhoneLoginPrivateValid),e&&!o.isPhoneLoginPrivateValid&&(""!=o.phoneLoginPrivate?o.phoneLoginPrivateErrorMessage=o.wrongFormatPhoneError:o.phoneLoginPrivateErrorMessage=o.emptyPhoneError),o.isPhoneLoginPrivateFocused=!o.isPhoneLoginPrivateValid}),1)},o.onEmailLoginBlur=function(e){t((function(){o.isEmailLoginBusinessFocused=!1,o.emailLoginErrorMessage="",o.isEmailLoginBusinessValid=validateEmail(o.emailLoginBusiness),e&&!o.isEmailLoginBusinessValid&&(""==o.emailLoginBusiness?o.emailLoginErrorMessage=o.emptyEmailError:o.emailLoginErrorMessage=o.wrongFormatEmailError),o.isEmailLoginBusinessFocused=!o.isEmailLoginBusinessValid}),1)},o.onPasswordLoginBusinessBlur=function(){t((function(){o.isPasswordLoginBusinessFocused=!1,o.passwordLoginBusinessErrorMessage="",o.passwordLoginBusiness=o.passwordLoginBusiness||"",o.isPasswordLoginBusinessValid=o.passwordLoginBusiness.length>4,o.isPasswordLoginBusinessValid||(""==o.passwordLoginBusiness?o.passwordLoginBusinessErrorMessage=o.emptyPasswordErrorLogin:o.passwordLoginBusinessErrorMessage=o.wrongFormatPasswordErrorLogin),o.isPasswordLoginBusinessFocused=!o.isPasswordLoginBusinessValid}),1)},o.onPhoneRegistrationPrivateChange=function(){t((function(){o.isPhoneRegistrationPrivateValid=validatePhone(o.phoneRegistrationPrivate)}),1)},o.onPhoneRegistationPrivateBlur=function(){t((function(){o.isPhoneRegistationPrivateFocused=!1,o.isPhoneRegistationPrivateValid=validatePhone(o.phoneRegistationPrivate),""!=o.phoneRegistationPrivate&&(o.isPhoneRegistationPrivateFocused=!o.isPhoneRegistationPrivateValid),o.isPhoneRegistationPrivateValid&&o.codeRegistationPrivateInput.focus()}),1)},o.onPhoneRegistrationBusinessChange=function(){t((function(){o.isPhoneRegistrationBusinessValid=validatePhone(o.phoneRegistrationBusiness)}),1)},o.onCodePrivateChange=function(){t((function(){o.codePrivate=clearNonNumeric(o.codePrivate),o.incorrectCodePrivate=!1}),1)},o.onCodePrivateBlur=function(e){t((function(){o.isCodePrivateValid=!0,o.isCodePrivateFocused=!1,o.errorMessageLoginPrivate="",(5!=o.codePrivate.length||o.incorrectCodePrivate)&&o.isPhoneLoginPrivateValid&&(o.isCodePrivateValid=!1,o.isCodePrivateFocused=!0,o.errorMessageLoginPrivate=o.incorrectCodePrivate?o.incorrectPasswordError:o.codePrivate?o.wrongFormatPasswordError:o.emptyPasswordError)}),1)},o.changeNumber=function(){o.codePrivateSent=!1,o.incorrectCodePrivate=!1,o.timeoutPrivate=0,o.isCodePrivateValid=!0,o.isCodePrivateFocused=!1,o.codePrivateSent=!1,o.codePrivate="",o.recaptchaPrivateRendered=!1,o.recaptchaPrivate2Rendered=!1},o.onCodeRegistrationBusinessChange=function(){t((function(){o.codeRegistrationBusiness=clearNonNumeric(o.codeRegistrationBusiness),o.incorrectCodeBusiness=!1}),1)},o.onCodeRegistrationBusinessBlur=function(){t((function(){o.isCodeRegistrationBusinessValid=!0,o.isCodeRegistrationBusinessFocused=!1,o.codeRegistrationBusinessErrorMessage="",!o.codeRegistrationBusinessInputEnabled&&o.isEmailRegistrationBusinessValid&&o.isPhoneRegistrationBusinessValid&&(o.codeRegistrationBusinessInputEnabled=!0),(5!=o.codeRegistrationBusiness.length||o.incorrectCodeBusiness)&&o.isPhoneRegistrationBusinessValid&&(o.isCodeRegistrationBusinessValid=!1,o.isCodeRegistrationBusinessFocused=!0,o.codeRegistrationBusinessErrorMessage=o.incorrectCodeBusiness?o.incorrectPasswordError:o.codeRegistrationBusiness?o.wrongFormatPasswordError:o.emptyPasswordError)}),1)},o.onPhoneRegistrationBusinessBlur=function(){t((function(){o.phoneRegistrationBusinessErrorMessage="",o.isPhoneRegistrationBusinessFocused=!1,o.isPhoneRegistrationBusinessValid=validatePhone(o.phoneRegistrationBusiness),o.isPhoneRegistrationBusinessValid&&o.codeRegistrationBusinessInput.focus(),""!=o.phoneRegistrationBusiness?o.phoneRegistrationBusinessErrorMessage=o.wrongFormatPhoneError:o.phoneRegistrationBusinessErrorMessage=o.emptyPhoneError,o.isPhoneRegistrationBusinessFocused=!o.isPhoneRegistrationBusinessValid}),1)},o.onEmailRegistrationBusinessBlur=function(e){t((function(){e=1==e,o.emailRegistrationBusinessErrorMessage="",o.isEmailRegistrationBusinessValid=!0,o.isEmailRegistrationBusinessFocused=!1,(o.emailRegistrationBusiness.indexOf("@@")>-1||e)&&(o.isEmailRegistrationBusinessValid=validateEmail(o.emailRegistrationBusiness),o.isEmailRegistrationBusinessValid||(o.isEmailRegistrationBusinessFocused=!0,""!=o.emailRegistrationBusiness?o.emailRegistrationBusinessErrorMessage=o.wrongFormatEmailError:o.emailRegistrationBusinessErrorMessage=o.emptyEmailError))}),1)},o.loginPrivate=function(e){if(console.log("loginPrivate"),o.onPhoneLoginPrivateBlur(!0),o.onCodePrivateBlur(!0),o.locked)return!1;o.locked=!0,t((function(){o.isPhoneLoginPrivateValid&&o.isCodePrivateValid?o.$emit("login",{login:clearPhone(o.phoneLoginPrivate),password:o.codePrivate,handleError:o.handleError,moveToPersonalArea:!0,createOrder:o.createOrder,pageType:loginTypes.Physical,onSuccess:o.onLoginSuccess.bind(null,!0)}):t((function(){o.isPhoneLoginPrivateFocused=!0,o.locked=!1}),10)}),10)},o.loginBusiness=function(e){console.log("loginBusiness"),o.onEmailLoginBlur(!0),o.onPasswordLoginBusinessBlur(),t((function(){o.isEmailLoginBusinessValid&&o.isPasswordLoginBusinessValid&&o.$emit("login",{login:o.emailLoginBusiness,password:o.passwordLoginBusiness,handleError:o.handleError,moveToPersonalArea:!0,createOrder:o.createOrder,runSubmitOrderCreate:o.runSubmitOrderCreate,showReview:o.showReview,orderNumber:o.orderNumber,pageType:loginTypes.Company})}),10)},o.onLoginSuccess=function(e){var r=e?"EnterRegPrivate":"BusinessGoRegisterForm",i=e?"RegPrivate":"BusinessGoRegister";o.addYandexMetric(o.fromShortForm?r:i)},o.registerBusiness=function(){o.onPhoneRegistrationBusinessChange(),o.onEmailRegistrationBusinessBlur(!0),o.onPhoneRegistrationBusinessBlur();var e=clearPhone(o.phoneRegistrationBusiness);o.isPhoneRegistrationBusinessValid&&o.isEmailRegistrationBusinessValid&&!o.codeRegistrationBusinessInputEnabled&&(o.showSendMessage=!0),o.codeRegistrationBusinessInputEnabled&&o.onCodeRegistrationBusinessBlur();var r={email:o.emailRegistrationBusiness,password:o.codeRegistrationBusiness,login:o.emailRegistrationBusiness,phone:e,PhoneConfirmationCode:o.codeRegistrationBusiness};validatePhone(e)||t((function(){o.isPhoneRegistrationBusinessFocused=!0}),10),validateEmail(o.emailRegistrationBusiness)||t((function(){o.isEmailRegistrationBusinessFocused=!0}),10),t((function(){o.isPhoneRegistrationBusinessValid&&o.isEmailRegistrationBusinessValid&&o.isCodeRegistrationBusinessValid&&o.register(r,customerType.Company,!0)}),100)},o.register=function(e,r,i,n){if(o.locked)return!1;o.locked=!0,o.showPreLoader=!0,t((function(){o.showPreLoader=!1}),1e4);var a="";try{ga.getAll().forEach((function(e){a=e.get("clientId"),console.log(a)}))}catch(e){}e=e||{};var s={addressJuridical:"",addressPhysical:"",addressPostal:"",bankAccount:"",bankBIK:"",bankCorrAccount:"",bankName:"",company:"",inn:"",innScan:"",kpp:"",ogrn:"",ogrnScan:"",rank:5,Type:r,UTMS:localStorage.utms,region:o.TRANSPORT_REGION_SUBDOMAIN};e.ga_Id=a,e.utms=getUTMS(),e.customerInfo=s,console.log(e),client.invokeApi("customer/create",{method:"post",contentType:"application/json",data:JSON.stringify(e)},!0).done((function(i){var n=i;e.id=n,localStorage.removeItem("utms");try{console.log("ga event registration customer"),dataLayer&&dataLayer.push({event:"gaevent",eventCategory:"login",eventAction:"registration_success"})}catch(e){}o.$emit("login",{login:e.login,password:e.password,handleError:o.handleError,moveToPersonalArea:!0,createOrder:o.createOrder,runSubmitOrderCreate:o.runSubmitOrderCreate,pageType:o.pageType,showReview:o.showReview,orderNumber:o.orderNumber,onSuccess:o.onLoginSuccess.bind(null,!1)}),r==customerType.Company&&o.hideAuthorizationPopup(),t((function(){o.locked=!1}),0)})).fail((function(r){if(client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},t((function(){o.showPreLoader=!1,o.locked=!1}),0),!n){var i=parseError(r);"Данный номер уже зарегистрирован"==i?t((function(){o.phoneLoginPrivate=e.login,o.onPhoneLoginPrivateBlur(),o.isPrivate=!0,o.isRegistration=!0,t((function(){o.passwordLoginPrivateInput.focus()}),200)}),1):"Выбранный почтовый ящик уже используется"==i?t((function(){o.emailLoginBusiness=e.login,o.onEmailLoginBlur(),o.isPrivate=!1,o.isRegistration=!0,t((function(){o.passwordLoginBusinessInput.focus()}),200)}),1):"Email уже используется"==i?t((function(){o.registerBusinessError=i,o.isEmailRegistrationBusinessValid=!1,o.isEmailRegistrationBusinessFocused=!0}),1):o.handleError(r)}}))},o.phoneIsEmpty=function(){return!(!o.isPrivate||!o.isRegistration||""!=o.phoneLoginPrivate)||(!(!o.isPrivate||o.isRegistration||""!=o.phoneRegistationPrivate)||!o.isPrivate&&!o.isRegistration&&""==o.phoneRegistrationBusiness)},o.sendCodeBusinessInternal=function(){t((function(){sendSMS({phone:o.phoneRegistrationBusiness,type:SMSType.Login},!0).done((function(){showToast({message:"На указанный номер телефона был отправлен смс-пароль",timeout:5e3}),t((function(){client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},o.recaptchaBusinessValid=!0,o.showSendMessage=!1,o.codeRegistrationBusinessSent=!0,o.codeRegistrationBusinessInputEnabled=!0,o.timeoutBusiness=o.smsTimeout,e&&clearInterval(e),r&&clearTimeout(r),e=setInterval((function(){t((function(){o.timeoutBusiness--}),0)}),1e3),r=setTimeout((function(){t((function(){o.codeRegistrationBusinessSent=!1}),0),clearInterval(e)}),1e3*o.smsTimeout)}),0)})).fail((function(){showError("При отправке сообщения произошла ошибка")}))}),0)},o.sendCodeRegistrationBusiness=function(){if(o.clearErrors(),o.phoneIsEmpty())return!1;if(!o.codeRegistrationBusinessSent&&o.isPhoneRegistrationBusinessValid){o.recaptchaBusinessRendered=!1,o.recaptchaBusinessValid=!1;var e=clearPhone(o.phoneRegistrationBusiness);o.addYandexMetric(o.fromShortForm?"CodeRequestForm":"CodeRequest"),client.invokeApi("User/CheckCodeRequest?phone="+e,{method:"post",contentType:"application/json"}).done((function(e){t((function(){e?o.sendCodeBusinessInternal():o.recaptchaBusinessRendered?grecaptcha.reset():(o.recaptchaBusinessRendered=!0,t((function(){grecaptcha.render("googleRecaptchaBusiness",{sitekey:Global.RecaptchaSiteKey,callback:o.sendCodeBusinessInternal,"error-callback":function(e){o.recaptchaBusinessValid=!1,console.log(e)}})}),1))}),1)}))}else o.onPhoneRegistrationBusinessBlur()},o.sendCodeInternal=function(){o.isSMSsentOC=!0,o.timeoutPrivate=o.smsTimeout,e&&clearInterval(e),r&&clearTimeout(r),sendSMS({phone:o.phoneLoginPrivate,type:SMSType.Login},!0).done((function(){t((function(){e=setInterval((function(){t((function(){o.timeoutPrivate--}),0)}),1e3),r=setTimeout((function(){t((function(){o.isSMSsentOC=!1,o.recaptchaPrivate2Rendered=!1}),0),clearInterval(e)}),1e3*o.smsTimeout),showToast({message:"На указанный номер телефона был отправлен смс-пароль",timeout:5e3}),client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},o.codePrivateSent=!0,o.codePrivateInputEnabled=!0}),1)})).fail((function(){showError("При отправке сообщения произошла ошибка")}))},o.sendCodePrivate=function(){o.onPhoneLoginPrivateBlur(!0),t((function(){if(o.isPhoneLoginPrivateValid){o.codePrivateSent?o.recaptchaPrivate2Rendered=!1:o.recaptchaPrivateRendered=!1;var e=clearPhone(o.phoneLoginPrivate);o.addYandexMetric(o.fromShortForm?"CodeSMSRequestPrivate":"CodeRequestPrivate"),client.invokeApi("User/CheckCodeRequest?phone="+e,{method:"post",contentType:"application/json"}).done((function(e){t((function(){e?o.sendCodeInternal():o.codePrivateSent?o.recaptchaPrivate2Rendered?grecaptcha.reset():(o.recaptchaPrivate2Rendered=!0,t((function(){grecaptcha.render("googleRecaptchaPrivate2",{sitekey:Global.RecaptchaSiteKey,callback:o.sendCodeInternal,"error-callback":function(e){console.log(e)}})}),1)):o.recaptchaPrivateRendered?grecaptcha.reset():(o.recaptchaPrivateRendered=!0,t((function(){grecaptcha.render("googleRecaptchaPrivate",{sitekey:Global.RecaptchaSiteKey,callback:o.sendCodeInternal,"error-callback":function(e){console.log(e)}})}),1))}),1)}))}}),100)},o.handleError=function(e){t((function(){if(o.showPreLoader=!1,o.locked=!1,o.clearErrors(),o.isPrivate)"Неправильный логин или пароль"==parseError(e)?(o.incorrectCodePrivate=!0,o.onCodePrivateBlur()):handleError(e);else if(o.isRegistration){"Неверный код подтверждения"==parseError(e)?(o.incorrectCodeBusiness=!0,o.onCodeRegistrationBusinessBlur()):handleError(e)}else o.isRegistration||(o.loginBusinessError=parseError(e),o.isPasswordLoginBusinessFocused=!0,o.isEmailLoginBusinessFocused=!0)}),1)},o.showForgotPasswordNewPopup=function(e){var r={isPrivate:e};r.login=e?clearPhone(o.phoneLoginPrivate):o.emailLoginBusiness,o.hideAuthorizationPopup(),o.$emit("mainShowForgotPasswordNewPopup",r)},o.authorizationPopup=void 0,o.initAuthorizationPopup=function(){o.authorizationPopup=modalWindow("#customer-auth-popup","auth-popup customer-auth-popup register-driver-popup",{clickBgClose:function(){return window.innerWidth>o.maxMobile},onShow:function(){o.isPrivate||(o.pageUrl=window.location.pathname,o.isRegistration?window.location.pathname.toLowerCase().indexOf("registration")<0&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/registration"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/registration"):history.pushState(null,null,"/registration")):window.location.pathname.toLowerCase().indexOf("login")<0&&(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder/login"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads/login"):history.pushState(null,null,"/login")))},onClose:function(){o.isPrivate||(window.location.pathname.toLowerCase().indexOf("createorder")>-1?history.pushState(null,null,"/createorder"):window.location.pathname.toLowerCase().indexOf("ads")>-1?history.pushState(null,null,"/ads"):history.pushState(null,null,"/")),o.$emit("mainAuthPopupClose")}})},o.initPopup=function(){t((function(){!o.authorizationPopup&&o.initAuthorizationPopup(),o.phoneLoginPrivateInput=$("#phoneLoginPrivate"),o.emailLoginBusinessInput=$("#emailLoginBusiness"),o.passwordBusinessInput=$("#passwordBusiness"),o.phoneRegistationPrivateInput=$("#phoneRegistationPrivate"),o.emailRegistrationBusinessInput=$("#emailRegistrationBusiness"),o.codeRegistationPrivateInput=$("#codeRegistationPrivate"),o.codeRegistrationBusinessInput=$("#codeRegistrationBusiness"),o.passwordLoginPrivateInput=$("#passwordLoginPrivate"),o.passwordLoginBusinessInput=$("#passwordLoginBusiness")}),200)},o.initPopup()}])}(),function(){var e,r;myApp.controller("registerDriverCtrl",["$scope","$filter","$timeout","$compile",function(o,i,t,n){o.isNullOrWhiteSpace=isNullOrWhiteSpace,o.smsTimeout=Global.SMSTimeout,o.isAuth=!1,o.remember=!0,o.emptyPhoneError="Введите номер мобильного телефона",o.wrongFormatPhoneError="Введен некорректный номер мобильного телефона",o.emptyEmailError=ErrorString.EmptyEmailError,o.wrongFormatEmailError=ErrorString.WrongFormatEmailError,o.incorrectCode=!1,o.connectionError="",o.email="",o.name="",o.phone="",o.code="",o.recaptchaCarrierValid=!0,o.timeoutP=0,o.emailLogin="",o.password="",o.isEmailValid=!1,o.isPhoneValid=!1,o.isEmailLoginValid=!1,o.isPasswordLoginValid=!1,o.isPasswordLoginFocused=!1,o.isCodeValid=!1,o.isEmailFocused=!1,o.isPhoneFocused=!1,o.isEmailLoginFocused=!1,o.isCodeFocused=!1,o.codeSent=!1,o.codeInputEnabled=!1,o.password="",o.errorMessage="",o.errorMessage="",o.emailErrorMessage="",o.emailLoginErrorMessage="",o.phoneErrorMessage="",o.codeErrorMessage="",o.url=window.location.pathname.toLowerCase(),o.pageType=loginUrls[o.url]||loginTypes.Company,o.clearData=function(){o.codeSent=!1,o.codeInputEnabled=!1,o.showSendMessage=!1,o.isAuth=!1,o.email="",o.name="",o.phone="",o.code="",o.emailLogin="",o.password="",o.isEmailValid=!1,o.isPhoneValid=!1,o.isEmailLoginValid=!1,o.isPasswordLoginValid=!1,o.isCodeValid=!1,o.isCodeFocused=!1,o.isEmailFocused=!1,o.isPhoneFocused=!1,o.isEmailLoginFocused=!1,o.isPasswordLoginFocused=!1,o.recaptchaCarrierRendered=!1,o.recaptchaBusinessRendered=!1,o.recaptchaCarrierValid=!0,o.recaptchaBusinessValid=!0,o.clearErrors()},o.clearErrors=function(){o.errorMessage="",o.connectionError="",o.emailErrorMessage="",o.phoneErrorMessage="",o.emailLoginErrorMessage="",o.codeErrorMessage="",o.incorrectCode=""},o.registerDriverPopup=void 0,o.initRegisterDriverElement=function(){o.registerDriverPopup=modalWindow("#regdriver-popup-cont","auth-popup register-driver-popup",{clickBgClose:function(){return window.innerWidth>o.maxMobile},onShow:function(){},onClose:function(){}})},t((function(){if(!o.registerDriverPopup&&o.initRegisterDriverElement(),isMobile){var e=document.getElementById("carrier-code"),r=document.querySelector(".register-driver-popup .mw-container");e.addEventListener("focus",(function(){var e=document.querySelector(".register-driver-popup  .mw-show .mws-content");null!=e&&setTimeout((function(){document.body.classList.add("input-number-pass-focus"),document.querySelector("html").classList.contains("ios")||(r.style.height=window.innerHeight+150+"px",e.scrollTop=150)}),150)})),e.addEventListener("blur",(function(){r.style.height="auto"})),document.addEventListener("click",(function(){"carrier-code"!=event.target.id&&e.blur()}))}}),200),o.showRegisterDriverPopup=function(e){!o.registerDriverPopup&&o.initRegisterDriverElement(),o.clearData(),addCaptcha(),e=e||{},o.isAuth=1==e.isAuth,o.pageType=e.pageType||o.pageType,o.registerDriverPopup.show()},o.hideRegisterDriverPopup=function(){o.registerDriverPopup.close()},o.$on("showRegisterDriverPopup",(function(e,r){o.showRegisterDriverPopup(r)})),o.setAuth=function(e){t((function(){var r=o.code,i=o.email;o.clearData(),o.isAuth=e,1==o.isAuth&&(o.emailLogin=i,o.password=r,o.emailLogin&&""!=o.emailLogin&&o.onEmailLoginBlur())}),0)},o.rememberclick=function(){o.remember=!o.remember},o.onPhoneChange=function(){t((function(){o.phoneErrorMessage="",o.isPhoneValid=validatePhone(o.phone),o.isPhoneFocused=!1,o.isPhoneValid||(o.isPhoneFocused=!0,""!=o.phone?o.phoneErrorMessage=o.wrongFormatPhoneError:o.phoneErrorMessage=o.emptyPhoneError)}),1)},o.checkFullPhone=function(){t((function(){o.isPhoneValid=validatePhone(o.phone)}),1)},o.onCodeChange=function(){o.code&&(o.code=o.code.replace(/[^0-9]/g,"")),o.incorrectCode=!1},o.onCodeBlur=function(){t((function(){o.isCodeValid=!0,o.isCodeFocused=!1,o.codeErrorMessage="",o.codeInputEnabled&&(5!=o.code.length||o.incorrectCode)&&o.isPhoneValid&&(o.isCodeValid=!1,o.isCodeFocused=!0,o.codeErrorMessage=o.incorrectCode?o.incorrectPasswordError:o.code?o.wrongFormatPasswordError:o.emptyPasswordError)}),1)},o.onEmailChange=function(e){t((function(){e=1==e,o.emailErrorMessage="",o.isEmailValid=!0,o.isEmailFocused=!1,(o.email.indexOf("@@")>-1||e)&&(o.isEmailValid=validateEmail(o.email),o.isEmailValid||(o.isEmailFocused=!0,""!=o.email?o.emailErrorMessage=o.wrongFormatEmailError:o.emailErrorMessage=o.emptyEmailError))}),1)},o.onEmailLoginChange=function(){t((function(){o.emailLoginErrorMessage="",o.isEmailLoginFocused=!1}),1)},o.onEmailLoginBlur=function(e){t((function(){o.emailLoginErrorMessage="",o.isEmailLoginFocused=!1,(o.emailLogin.indexOf("@@")>-1||e)&&(o.isEmailLoginValid=validateEmail(o.emailLogin),o.isEmailLoginValid||(o.isEmailLoginFocused=!0,""!=o.emailLogin?o.emailLoginErrorMessage=o.wrongFormatEmailError:o.emailLoginErrorMessage=o.emptyEmailError))}),1)},o.passwordLoginErrorMessage="",o.onPasswordLoginBlur=function(){t((function(){o.passwordLoginErrorMessage="",o.isPasswordLoginValid=!0,null!=o.password&&""!=o.password||(o.isPasswordLoginValid=!1,o.passwordLoginErrorMessage="Введите пароль"),o.isPasswordLoginFocused=!o.isPasswordLoginValid}),1)},o.registerDriver=function(){o.pageType==loginTypes.Carrier&&o.addYandexMetric("DriverRegStep0"),o.onEmailChange(!0),o.onPhoneChange(),o.isEmailValid&&o.isPhoneValid&&!o.codeInputEnabled&&(o.showSendMessage=!0),o.codeInputEnabled&&o.onCodeBlur(),t((function(){o.isEmailValid&&o.isPhoneValid&&o.isCodeValid&&o.register()}),100)},o.register=function(){if(o.locked)return!1;o.locked=!0;var e="";try{ga.getAll().forEach((function(r){e=r.get("clientId"),console.log(e)}))}catch(e){}var r=clearPhone(o.phone),i={email:o.email,password:o.code,name:"",login:o.email,phone:r,PhoneConfirmationCode:o.code};i=i||{};var n=transportRegion.MO;o.TRANSPORT_REGION_SUBDOMAIN==transportRegion.LO?n=transportRegion.LO:o.TRANSPORT_REGION_SUBDOMAIN==transportRegion.NO&&(n=transportRegion.NO);var a={addressJuridical:"",addressPhysical:"",addressPostal:"",bankAccount:"",bankBIK:"",bankCorrAccount:"",bankName:"",company:"",inn:"",innScan:"",kpp:"",ogrn:"",ogrnScan:"",rank:5,region:n,type:o.pageType==loginTypes.CarrierCompany?carrierType.Company:carrierType.Driver};i.ga_Id=e,i.driverInfo=i.carrierInfo=a,i.utms=getUTMS(),t((function(){o.isEmailValid&&o.isPhoneValid&&o.isCodeValid?client.invokeApi("carrier/Create",{method:"post",contentType:"application/json",data:JSON.stringify(i)},!0).done((function(e){o.emailLogin=o.email,o.password=o.code,o.isEmailLoginValid=!0,o.locked=!1;try{console.log("ga event registration carrier"),dataLayer&&dataLayer.push({event:"gaevent",eventCategory:"login",eventAction:"registration_success"})}catch(e){}o.login(),o.hideRegisterDriverPopup()})).fail((function(e){o.locked=!1,"Неверный код подтверждения"==parseError(e)?(o.incorrectCode=!0,o.onCodeBlur()):handleError(e)})):o.locked=!1}),100)},o.sendSmsCodeIntenal=function(){t((function(){o.recaptchaCarrierValid=!0,sendSMS({phone:o.phone,type:SMSType.Login}),client.currentUser={mobileServiceAuthenticationToken:localStorage.mobileServiceAuthenticationToken},o.showSendMessage=!1,o.codeSent=!0,o.codeInputEnabled=!0,t((function(){$("#carrier-code").focus()}),200),e&&clearInterval(e),r&&clearTimeout(r),o.timeoutP=o.smsTimeout,e=setInterval((function(){t((function(){o.timeoutP--}),0)}),1e3),r=setTimeout((function(){t((function(){o.codeSent=!1}),0),clearInterval(e)}),1e3*o.smsTimeout)}),0)},o.sendCode=function(){if(o.pageType==loginTypes.Carrier&&o.addYandexMetric("CodeRequestDriver"),o.isPhoneValid){o.recaptchaCarrierRendered=!1,o.recaptchaCarrierValid=!1;var e=clearPhone(o.phone);client.invokeApi("User/CheckCodeRequest?phone="+e,{method:"post",contentType:"application/json"}).done((function(e){t((function(){e?o.sendSmsCodeIntenal():o.recaptchaCarrierRendered?grecaptcha.reset():(o.recaptchaCarrierRendered=!0,t((function(){grecaptcha.render("googleRecaptchaCarrier",{sitekey:Global.RecaptchaSiteKey,callback:o.sendSmsCodeIntenal,"error-callback":function(e){o.recaptchaCarrierValid=!1,console.log(e)}})}),1))}),1)}))}},o.showForgotPasswordNewPopup=function(){var e={login:o.emailLogin};o.hideRegisterDriverPopup(),o.$emit("mainShowForgotPasswordNewPopup",e)},o.login=function(){o.onEmailLoginBlur(!0),o.onPasswordLoginBlur(),t((function(){o.isEmailLoginValid&&o.isPasswordLoginValid&&o.$emit("login",{login:o.emailLogin,password:o.password,handleError:o.handleError,moveToPersonalArea:!0,pageType:o.pageType})}),100)},o.handleError=function(e){t((function(){o.connectionError=parseError(e),"5"!=e.status.toString()[0]&&("Email уже используется"==o.connectionError?(o.isEmailFocused=!0,o.isEmailValid=!1):(o.isPasswordLoginFocused=o.isEmailLoginFocused=o.isCodeFocused=!0,o.isPasswordLoginValid=o.isEmailLoginValid=o.isCodeValid=!1))}),1),t((function(){$(".popup-container-new.registration").css("height",634+$(".registration-error").height())}),100)}}])}(),myApp.controller("forgotPasswordNewCtrl",["$scope","$filter","$timeout","$compile",function(e,r,o,i){e.isNullOrWhiteSpace=isNullOrWhiteSpace,e.emptyEmailError=ErrorString.EmptyEmailError,e.wrongFormatEmailError=ErrorString.WrongFormatEmailError,e.sent=!1,e.email="",e.isEmailFocused=!1,e.isEmailValid=!1,e.brokenRepairPassLink=!1,e.errorMessage="",e.clearData=function(){e.email="",e.isEmailFocused=!1,e.isEmailValid=!1,e.sent=!1,e.errorMessage="",e.connectionError=""},o((function(){e.forgotPasswordNewPopup=modalWindow("#forgot-password-new","auth-popup forgot-password-popup",{clickBgClose:function(){return window.innerWidth>e.maxMobile},onClose:function(){e.brokenRepairPassLink&&(window.location.href=window.location.origin+"/",setTimeout((function(){document.location.href="/"}),20))}}),e.emailInput=$("#email-input-new")}),0),e.setAuthType=function(r){e.isPrivate=r},e.showForgotPasswordNewPopup=function(r){(r=r||{}).login=r.login||"",e.isStepsPage=r.steps,e.restoreText=e.isStepsPage?"аккаунта":"пароля",e.restoreButtonText=e.isStepsPage?"аккаунт":"пароль",1!=r.isPrivate&&(r.isPrivate=!1),e.brokenRepairPassLink=!0===r.brokenRepairPassLink,e.clearData(),o((function(){e.email=""+r.login,r.login&&e.onEmailChange()}),1),e.forgotPasswordNewPopup.show(),e.emailInput.focus(),console.log("forgot popup is visible")},e.hideForgotPasswordNewPopup=function(){e.forgotPasswordNewPopup.close()},e.$on("showForgotPasswordNewPopup",(function(r,o){e.clearData(),e.showForgotPasswordNewPopup(o)})),e.onEmailChange=function(){o((function(){e.errorMessage="",e.connectionError="",e.isEmailValid=validateEmail(e.email),e.isEmailValid||(""!=e.email?e.errorMessage=e.wrongFormatEmailError:e.errorMessage=e.emptyEmailError)}),1)},e.onEmailBlur=function(r){o((function(){e.errorMessage="",e.isEmailFocused=!1,(e.email.indexOf("@@")>-1||r)&&(e.isEmailValid=validateEmail(e.email),e.isEmailValid||(e.isEmailFocused=!0,""!=e.email?e.errorMessage=e.wrongFormatEmailError:e.errorMessage=e.emptyEmailError))}),1)},e.remembered=function(){e.hideForgotPasswordNewPopup(),e.$emit("rememberedCarrierPassword")},e.startTimer=function(){e.counter=30,e.showCounter=!0;var r=setInterval((function(){o((function(){e.counter--,0==e.counter&&(clearInterval(r),e.showCounter=!1)}),0)}),1e3)},e.forgot=function(){e.isEmailValid?(login=e.email,localStorage.third=btoa(login),client.invokeApi("User/ForgotUserPassword",{method:"post",parameters:{login:login}}).done((function(){o((function(){e.sent=!0,e.startTimer()}),1)})).fail((function(r){e.handleError(r)}))):(e.onEmailChange(),o((function(){e.isEmailFocused=!0}),10))},e.sendCode=function(){e.isPrivate&&(e.isPhoneValid?client.invokeApi("User/ForgotUserPassword",{method:"post",parameters:{login:clearPhone(e.phone)}}).done((function(){})).fail((function(r){e.errorMessage=parseError(r)})):e.errorMessage="Введен неверный номер телефона"),console.log("send code")},e.handleError=function(r){o((function(){e.connectionError=parseError(r),"5"!=r.status.toString()[0]?(e.isEmailFocused=!0,e.isEmailValid=!1):e.sentError=!0}),1)}}]);